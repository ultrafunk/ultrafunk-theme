import{$ as dt,A as de,B,C as ye,D as g,E as pe,F as ee,G as N,H as x,I as et,J as te,K as F,L as M,M as ge,N as tt,O as at,P as rt,Q as ae,R as lt,S as ot,T as Ne,U as nt,V as K,W as st,X as it,Y as _,Z as ct,_ as ut,a as Je,aa as fe,b as T,ba as yt,c as se,ca as pt,e as ie,ea as gt,f as $,fa as Ue,ga as ft,ha as w,ia as Et,ja as Ee,k as A,ka as kt,l as s,la as ve,m as Xe,ma as Tt,na as mt,o as y,oa as bt,p as he,qa as Pt,r as f,ra as G,s as ce,sa as Oe,t as ze,u as Qe,v as De,va as At,w as Ze,wa as H,ya as St,z as ue}from"../chunk-KHSC6XTF.js";var Re=T("eventlogger"),c={UNKNOWN:1e3,KEYBOARD:100,MOUSE:110,YOUTUBE:1,SOUNDCLOUD:2,ULTRAFUNK:50},u={UNKNOWN:-2e3,KEY_ARROW_LEFT:180,KEY_ARROW_RIGHT:181,MOUSE_CLICK:182,STATE_ERROR:-5,STATE_UNSTARTED:-1,STATE_ENDED:0,STATE_PLAYING:1,STATE_PAUSED:2,STATE_BUFFERING:3,STATE_CUED:5,RESUME_AUTOPLAY:50,PLAYER_ERROR:60,CROSSFADE_START:70},ta={eventSource:c.UNKNOWN,eventType:u.UNKNOWN,uId:null,timeStamp:0},Ye=class{constructor(t=10){this.log=[],this.maxEntries=t,this.lastPos=0,this.matchCount=0}add(t,a,i,d=Date.now()){let p=Object.create(ta);p.eventSource=t,p.eventType=a,p.uId=i,p.timeStamp=d,this.log.length<this.maxEntries?this.log.push(p):(this.log.shift(),this.log.push(p))}clear(){this.log=[]}initMatch(){this.lastPos=this.log.length-1,this.matchCount=0}matchesEvent(t,a,i,d=null){this.log[this.lastPos-t].eventSource===a&&this.log[this.lastPos-t].eventType===i&&this.log[this.lastPos-t].uId===d&&this.matchCount++}matchesDelta(t,a){this.log[this.lastPos].timeStamp-this.log[this.lastPos-t].timeStamp<=a&&this.matchCount++}isPatternMatch(t,a){return this.matchCount===t?(Re.log(`MATCH for: ${a}`),Re.logEventLog(this.log,c,u),!0):!1}},Me=class extends Ye{constructor(t){super(t)}doubleClicked(t,a,i){return this.initMatch(),this.lastPos>=1&&(this.matchesEvent(1,t,a),this.matchesEvent(0,t,a),this.matchesDelta(1,i)),this.isPatternMatch(3,`${Re.getObjectKeyForValue(c,t)} Double Clicked`)}},re=class extends Ye{constructor(t){super(t)}ytAutoplayBlocked(t,a){return this.initMatch(),this.lastPos>=3&&(this.matchesEvent(3,c.ULTRAFUNK,u.RESUME_AUTOPLAY,null),this.matchesEvent(2,c.YOUTUBE,u.STATE_UNSTARTED,t),this.matchesEvent(1,c.YOUTUBE,u.STATE_BUFFERING,t),this.matchesEvent(0,c.YOUTUBE,u.STATE_UNSTARTED,t),this.matchesDelta(3,a)),this.isPatternMatch(5,"YouTube Autoplay Blocked")}scAutoplayBlocked(t,a){return this.initMatch(),this.lastPos>=3&&(this.matchesEvent(3,c.ULTRAFUNK,u.RESUME_AUTOPLAY,null),this.matchesEvent(2,c.SOUNDCLOUD,u.STATE_PLAYING,t),this.matchesEvent(1,c.SOUNDCLOUD,u.STATE_PAUSED,t),this.matchesEvent(0,c.SOUNDCLOUD,u.STATE_PAUSED,t),this.matchesDelta(3,a)),this.isPatternMatch(5,"SoundCloud Autoplay Blocked")}scWidgetPlayBlocked(t,a){return this.initMatch(),this.lastPos>=2&&(this.matchesEvent(2,c.SOUNDCLOUD,u.STATE_PLAYING,t),this.matchesEvent(1,c.SOUNDCLOUD,u.STATE_PAUSED,t),this.matchesEvent(0,c.SOUNDCLOUD,u.STATE_PAUSED,t),this.matchesDelta(2,a)),this.isPatternMatch(4,"SoundCloud WidgetPlay Blocked")}scPlayDoubleTrigger(t,a){return this.initMatch(),this.lastPos>=2&&(this.matchesEvent(2,c.ULTRAFUNK,u.CROSSFADE_START,null),this.matchesEvent(1,c.SOUNDCLOUD,u.STATE_PLAYING,t),this.matchesEvent(0,c.SOUNDCLOUD,u.STATE_PLAYING,t),this.matchesDelta(1,a)),this.isPatternMatch(4,"SoundCloud Play Double Trigger")}};var He={};Je(He,{getStatus:()=>Se,init:()=>wa,nextTrack:()=>Ke,prevTrack:()=>wt,toggleMute:()=>Bt,togglePlayPause:()=>Ae});var le=T("playback-events"),Te={snackbarId:0,nowPlayingIcons:null},Be={nowPlayingIconsSelector:"h2.entry-title"},l={LOADING:"loading",READY:"ready",MEDIA_LOADING:"mediaLoading",MEDIA_PLAYING:"mediaPlaying",MEDIA_PAUSED:"mediaPaused",MEDIA_ENDED:"mediaEnded",MEDIA_TIME_REMAINING:"mediaTimeRemaining",MEDIA_SHOW:"mediaShow",MEDIA_UNAVAILABLE:"mediaUnavailable",CONTINUE_AUTOPLAY:"continueAutoplay",RESUME_AUTOPLAY:"resumeAutoplay",AUTOPLAY_BLOCKED:"autoplayBlocked",PLAYBACK_BLOCKED:"playbackBlocked"},_e={[l.LOADING]:[aa],[l.READY]:[ra],[l.MEDIA_LOADING]:[la],[l.MEDIA_PLAYING]:[oa],[l.MEDIA_PAUSED]:[na],[l.MEDIA_ENDED]:[It],[l.MEDIA_TIME_REMAINING]:[sa],[l.MEDIA_SHOW]:[ia],[l.CONTINUE_AUTOPLAY]:[ca],[l.RESUME_AUTOPLAY]:[ua],[l.AUTOPLAY_BLOCKED]:[da],[l.PLAYBACK_BLOCKED]:[ya],[l.MEDIA_UNAVAILABLE]:[pa]};function Lt(){le.log("init()"),Te.nowPlayingIcons=document.querySelectorAll(Be.nowPlayingIconsSelector)}function V(e,t){e in _e&&_e[e].push(t)}function k(e,t=null,a=null){_e[e].forEach(i=>{i({event:e,data:t,callback:a})})}function aa(e){B(e.data.loadingPercent)}function ra(e){U(e),e?.data.resetProgressBar&&B(0)}function la(){}function oa(e){if(U(e),ce(Te.snackbarId),e.data.numTracks>1){let t=document.querySelector(`#${e.data.trackId} ${Be.nowPlayingIconsSelector}`);ht(t),H(t,"playing-paused","now-playing-icon"),s.gallery.animateNowPlayingIcon&&t.classList.add("playing-animate")}}function na(e){U(e),e.data.numTracks>1&&document.querySelector(`#${e.data.trackId} ${Be.nowPlayingIconsSelector}`).classList.add("playing-paused")}function It(e){U(e),B(0),e!==null&&e.data.numTracks>1&&ht()}function sa(){}function ia(e){U(e),It(null),e.data.scrollToMedia&&w(e.data.trackId)}function ca(e){U(e),J(A.nextPage,!0)}function ua(e){let t=JSON.parse(sessionStorage.getItem($.UF_AUTOPLAY));if(sessionStorage.removeItem($.UF_AUTOPLAY),U(e),le.log(`RESUME_AUTOPLAY: ${t!==null?JSON.stringify(t):"NO"}`),t!==null){let a=document.getElementById(t.trackId)?.querySelector("iframe").id;e.callback.resumeAutoplay(t,a)}}function da(e){U(e),Te.snackbarId=f("Autoplay blocked, Play to continue",0,"play",()=>e.callback.togglePlayPause())}function ya(e){U(e),f("Unable to play track, skipping to next",5,"Stop",()=>{},()=>we(e))}function pa(e){U(e),ga(e.data.trackId)?f("YouTube Premium track, skipping",5,"help",()=>window.location.href="/channel/premium/",()=>we(e)):(f("Unable to play track, skipping to next",5,"Stop",()=>{},()=>we(e)),se("EVENT_MEDIA_UNAVAILABLE",e.data))}function U(e=null){le.isDebug()&&e!==null&&le.log(e)}function ht(e){Te.nowPlayingIcons.forEach(t=>{t!==e&&t.classList.remove("now-playing-icon","playing-animate","playing-paused")})}function we(e){e.data.currentTrack<e.data.numTracks?e.callback.skipToTrack(e.data.currentTrack+1,!0):A.nextPage!==null&&J(A.nextPage,!0)}function ga(e){let t=document.getElementById(e);return t!==null?t.classList.contains("uf_channel-premium"):!1}function J(e,t=!1){le.log(`autoplayNavTo(): ${e} - continueAutoplay: ${t}`),e&&(sessionStorage.setItem($.UF_AUTOPLAY,JSON.stringify({autoplay:t,trackId:null,position:0})),St(e))}var Dt={updateTimerInterval:250,maxBufferingDelay:3},C=(()=>{let e=-1,t=0,a=!0,i=null,d=null,p=null;return document.addEventListener("visibilitychange",()=>{a=document.visibilityState==="visible"}),{init:O,start:h,stop:b,updateCallback:R};function O(S,D,Y){i=S,d=D,p=Y}function h(){b(!1),e=setInterval(()=>{a&&i.current.getPosition(R)},Dt.updateTimerInterval)}function b(S=!1){e!==-1&&(clearInterval(e),e=-1),S&&(R(0),k(l.MEDIA_ENDED,d())),t=0,x(!1)}function R(S,D=0){let Y=Math.round(S/1e3);ye(S,Y,D),Y>0&&D>0&&(Z(Y,D),ea(Y,D))}function Z(S,D){if(s.playback.autoplay===!1&&s.playback.timeRemainingWarning&&t!==S){let Y=D-S;t=S,Y<=s.playback.timeRemainingSeconds?(x(!0),k(l.MEDIA_TIME_REMAINING,{timeRemainingSeconds:Y})):x(!1)}}function ea(S,D){s.playback.masterMute===!1&&s.playback.autoplay&&s.gallery.autoCrossfade&&D-S===s.gallery.autoCrossfadeLength+Dt.maxBufferingDelay&&i.getCurrentTrack()+1<=i.getNumTracks()&&p(Ee.AUTO,{name:"Auto Crossfade",length:s.gallery.autoCrossfadeLength,curve:s.gallery.autoCrossfadeCurve})}})();var E=T("embedded-players"),v=new re(10),o={players:{},playbackState:null,eventHandler:null,loadEventsTotal:0,loadEventsCount:1},$e={youTubeIframeIdRegEx:/youtube-uid/i,soundCloudIframeIdRegEx:/soundcloud-uid/i,maxPlaybackStartDelay:3};function Ut(e,t,a){o.players=e,o.playbackState=t,o.eventHandler=a,o.loadEventsTotal=3+parseInt(document.body.getAttribute("data-gallery-track-count")),ka(),ha()}function me(){return{loadingPercent:100*(o.loadEventsCount++/o.loadEventsTotal)}}function vt(){o.loadEventsCount>=o.loadEventsTotal?o.eventHandler(l.READY,{resetProgressBar:!0}):o.eventHandler(l.LOADING,me())}function fa(){document.querySelectorAll("single-track").forEach(t=>{let a=t.querySelector("iframe"),i=null;if($e.youTubeIframeIdRegEx.test(a.id)){let d=new YT.Player(a.id,{events:{onReady:Ta,onStateChange:ma,onError:Ia}});i=new kt(t.id,a.id,d,t.getAttribute("data-track-source-data"))}else if($e.soundCloudIframeIdRegEx.test(a.id)){let d=SC.Widget(a.id);i=new ve(t.id,a.id,d,a.src),d.bind(SC.Widget.Events.READY,()=>{i.setThumbnail(t.querySelector(".track-share-control span")),Da()}),d.bind(SC.Widget.Events.PLAY,Na),d.bind(SC.Widget.Events.PAUSE,Ua),d.bind(SC.Widget.Events.FINISH,va),d.bind(SC.Widget.Events.ERROR,Oa)}i!==null&&(i.setTitle(t.getAttribute("data-track-title")),i.setArtist(t.getAttribute("data-track-artist")),o.players.add(i))})}function be(e,t){E.log("onPlayerError()"),E.log(e);let a=e instanceof ve?c.SOUNDCLOUD:c.YOUTUBE;o.players.isCurrent(e.getUid())===!1&&o.players.stop(),v.add(a,u.PLAYER_ERROR,e.getUid()),o.eventHandler(l.MEDIA_UNAVAILABLE,Ea(e,t))}function Ea(e,t){let a=e.getArtist()||"N/A",i=e.getTitle()||"N/A";return{currentTrack:o.players.trackFromUid(e.getUid()),numTracks:o.players.getNumTracks(),trackId:e.getTrackId(),mediaTitle:`${a} - ${i}`,mediaUrl:t}}function ka(){E.log("initYouTubeAPI()"),o.eventHandler(l.LOADING,me()),window.onYouTubeIframeAPIReady=function(){E.log("onYouTubeIframeAPIReady()"),o.eventHandler(l.LOADING,me()),fa()};let e=document.createElement("script");e.id="youtube-iframe-api",e.src="https://www.youtube.com/iframe_api";let t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}function Ta(){E.log("onYouTubePlayerReady()"),vt()}function ma(e){switch(v.add(c.YOUTUBE,e.data,e.target.h.id),e.data){case YT.PlayerState.UNSTARTED:ba(e);break;case YT.PlayerState.BUFFERING:Pa(e);break;case YT.PlayerState.PLAYING:Aa(e);break;case YT.PlayerState.PAUSED:Sa(e);break;case YT.PlayerState.CUED:Ca(e);break;case YT.PlayerState.ENDED:La(e);break}}function ba(e){E.log(`onYouTubePlayerStateChange: UNSTARTED (uID: ${e.target.h.id})`),v.ytAutoplayBlocked(e.target.h.id,3e3)&&o.eventHandler(l.AUTOPLAY_BLOCKED)}function Pa(e){if(E.log(`onYouTubePlayerStateChange: BUFFERING (uID: ${e.target.h.id})`),o.players.crossfade.isFading()===!1){let t=o.players.playerFromUid(e.target.h.id);t.mute(s.playback.masterMute),t.setVolume(s.playback.masterVolume),o.eventHandler(l.MEDIA_LOADING)}}function Aa(e){E.log(`onYouTubePlayerStateChange: PLAYING   (uID: ${e.target.h.id})`),o.playbackState.syncAll(e.target.h.id,o.playbackState.STATE.PLAY),o.players.current.setDuration(Math.round(e.target.getDuration())),C.start()}function Sa(e){E.log(`onYouTubePlayerStateChange: PAUSED    (uID: ${e.target.h.id})`),o.players.isCurrent(e.target.h.id)?(o.playbackState.syncAll(e.target.h.id,o.playbackState.STATE.PAUSE),C.stop(!1)):o.players.crossfade.stop()}function Ca(e){E.log(`onYouTubePlayerStateChange: CUED      (uID: ${e.target.h.id})`)}function La(e){E.log(`onYouTubePlayerStateChange: ENDED     (uID: ${e.target.h.id})`),o.players.isCurrent(e.target.h.id)?(C.stop(!0),o.eventHandler(l.MEDIA_ENDED)):o.players.crossfade.stop()}function Ia(e){E.log("onYouTubePlayerError: "+e.data);let t=o.players.playerFromUid(e.target.h.id);t.setPlayable(!1),be(t,e.target.getVideoUrl())}function ha(){E.log("initSoundCloudAPI()"),o.eventHandler(l.LOADING,me())}function Da(){E.log("onSoundCloudPlayerEventReady()"),vt()}function Na(e){E.log(`onSoundCloudPlayerEvent: PLAY   (uID: ${e.soundId})`),v.add(c.SOUNDCLOUD,u.STATE_PLAYING,e.soundId),o.players.crossfade.isFading()&&o.players.isCurrent(e.soundId)?v.scPlayDoubleTrigger(e.soundId,$e.maxPlaybackStartDelay*1e3)&&o.playbackState.syncAll(e.soundId,o.playbackState.STATE.PLAY):(o.playbackState.syncAll(e.soundId,o.playbackState.STATE.PLAY),o.players.current.mute(s.playback.masterMute),o.players.current.setVolume(s.playback.masterVolume)),o.players.current.getEmbeddedPlayer().getDuration(t=>{o.players.current.setDuration(Math.round(t/1e3)),C.start()})}function Ua(e){E.log(`onSoundCloudPlayerEvent: PAUSE  (uID: ${e.soundId})`),v.add(c.SOUNDCLOUD,u.STATE_PAUSED,e.soundId),v.scAutoplayBlocked(e.soundId,3e3)?(C.stop(!1),o.eventHandler(l.AUTOPLAY_BLOCKED)):v.scWidgetPlayBlocked(e.soundId,3e4)?(C.stop(!1),o.eventHandler(l.PLAYBACK_BLOCKED,{currentTrack:o.players.trackFromUid(e.soundId),numTracks:o.players.getNumTracks()})):o.players.isCurrent(e.soundId)?o.players.current.getPosition(t=>{t>0&&(o.playbackState.syncAll(e.soundId,o.playbackState.STATE.PAUSE),C.stop(!1))}):o.players.crossfade.stop()}function va(e){E.log(`onSoundCloudPlayerEvent: FINISH (uID: ${e.soundId})`),o.players.isCurrent(e.soundId)?(C.stop(!0),o.eventHandler(l.MEDIA_ENDED)):o.players.crossfade.stop()}function Oa(){this.getCurrentSound(e=>{let t=o.players.playerFromUid(e.id);E.log(`onSoundCloudPlayerEvent: ERROR for track: ${o.players.trackFromUid(e.id)}. ${t.getArtist()} - ${t.getTitle()} - [${t.getUid()} / ${t.getIframeId()}]`),t.setPlayable(!1)})}var Fe=T("crossfade-controls"),Pe={players:{}},L={},q={crossfadePresetSelector:".crossfade-preset-control",crossfadePresetData:"data-crossfade-preset",crossfadeToSelector:".crossfade-fadeto-control"};function Rt(e,t){Fe.log("init()"),Pe.players=e,L.crossfadePreset=new he(q.crossfadePresetSelector),L.crossfadeTo=new he(q.crossfadeToSelector),L.crossfadePreset.length>1&&L.crossfadeTo.length>1&&(L.crossfadePreset.forEach(a=>Mt(a,s.gallery.trackCrossfadeDefPreset)),L.crossfadeTo.clickCallback=t)}function Yt(){Fe.log("ready()"),L.crossfadePreset.length>1&&L.crossfadeTo.length>1&&(L.crossfadePreset.forEach(e=>{e.addEventListener("click",Ya),H(e,y.DISABLED.CLASS,y.ENABLED.CLASS)}),L.crossfadeTo.forEach(e=>e.addEventListener("click",Ma)),V(l.MEDIA_PLAYING,Ot),V(l.MEDIA_PAUSED,Ot))}function Mt(e,t){e.setAttribute(q.crossfadePresetData,t),e.textContent=`${t+1}`,e.title=`Preset: ${ie.crossfade[t].name}`}function Ya(e){let t=parseInt(e.target.getAttribute(q.crossfadePresetData));Mt(e.target,t+1<ie.crossfade.length?t+1:0)}function Ma(e){if(g()&&Pe.players.crossfade.isFading()===!1){let t=e.target.closest("single-track");if(t!==null){let a=t.querySelector("iframe"),i=parseInt(t.querySelector(q.crossfadePresetSelector).getAttribute(q.crossfadePresetData));H(t.querySelector(`div${q.crossfadeToSelector}`),y.ENABLED.CLASS,y.DISABLED.CLASS),L.crossfadeTo.clickCallback(Pe.players.uIdFromIframeId(a.id),ie.crossfade[i])}}}function Ot(){let e=g(),t=e?Pe.players.getTrackData().currentTrack:-1;Fe.log(`updateCrossfadeToState() - playingState: ${e} - currentTrack: ${t}`),L.crossfadeTo.forEach((a,i)=>{t===i+1?H(a,e?y.ENABLED.CLASS:y.DISABLED.CLASS,e?y.DISABLED.CLASS:y.ENABLED.CLASS):H(a,e?y.DISABLED.CLASS:y.ENABLED.CLASS,e?y.ENABLED.CLASS:y.DISABLED.CLASS)})}var P=T("gallery-player"),r={eventLog:null,players:{}},_t={minCrossfadeToTime:5,maxBufferingDelay:3};function wa(){P.log("init()"),r.eventLog=v,Lt(),r.players=bt(),r.players.init(xt),ue(r.players,xa),Rt(r.players,Fa),C.init(r.players,Se,Vt),Ut(r.players,$t,Ka)}function Ae(){g()?(N(),r.players.current.pause()):(ee(),r.players.current.play(be))}function wt(){P.log(`prevTrack() - prevTrack: ${r.players.getCurrentTrack()-1} - numTracks: ${r.players.getNumTracks()}`),r.players.getCurrentTrack()>0&&r.players.current.getPosition(e=>{e>5e3?(r.players.current.seekTo(0),C.updateCallback(0)):(r.players.getCurrentTrack()>1&&r.players.stop(),r.players.prevTrack(g())&&te())})}function Ke(e=!1){let t=r.players.getCurrentTrack()+1>r.players.getNumTracks();P.log(`nextTrack() - isMediaEnded: ${e} - isLastTrack: ${t} - autoplay: ${s.playback.autoplay}`),!Ba(e,t)&&(t===!1?(r.players.stop(),e&&s.playback.autoplay===!1?N():r.players.nextTrack(g())&&F()):e&&(N(),s.playback.autoplay?k(l.CONTINUE_AUTOPLAY):r.players.stop()))}function Ba(e,t){if(e&&s.playback.autoplay){let a=ge();if(P.log(`repeatPlayback(): ${P.getObjectKeyForValue(M,a)}`),a===M.ONE)return r.players.current.seekTo(0),r.players.current.play(),!0;if(t&&a===M.ALL)return r.players.stop(),r.players.setPlayerIndex(0),xt(!0),!0}return!1}function xa(e){r.players.current.seekTo(e)}function Bt(){s.playback.masterMute=s.playback.masterMute!==!0,r.players.mute()}function Va(e,t=!0){P.log(`cueTrack(): ${e}`),r.players.setPlayerIndex(r.players.indexMap.get(e)),k(l.MEDIA_SHOW,{scrollToMedia:t,trackId:r.players.current.getTrackId()}),F()}function xt(e,t=!0){k(l.MEDIA_SHOW,{scrollToMedia:t,trackId:r.players.current.getTrackId()}),e&&r.players.current.play(be)}function Ge(e,t=!0){P.log(`skipToTrack(): ${e} - ${t}`),t===!0&&g()===!1&&(r.eventLog.clear(),r.eventLog.add(c.ULTRAFUNK,u.RESUME_AUTOPLAY,null),r.players.jumpToTrack(e,t)&&F())}function $a(e,t=null){P.log(`resumeAutoplay(): ${e.autoplay}${t!==null?" - "+t:""}`),t!==null?e.autoplay?Ge(r.players.trackFromUid(t),!0):Va(t):e.autoplay&&(r.eventLog.add(c.ULTRAFUNK,u.RESUME_AUTOPLAY,null),Ae())}function Se(){return{isPlaying:g(),currentTrack:r.players.getCurrentTrack(),position:0,numTracks:r.players.getNumTracks(),trackId:r.players.current.getTrackId(),iframeId:r.players.current.getIframeId()}}function Fa(e,t){r.players.isCurrent(e)===!1&&r.players.current.getDuration()>0&&(P.log(`crossfadeToClick():
      fadeOut: ${r.players.current.getArtist()} - "${r.players.current.getTitle()}" (${r.players.current.getUid()})
      fadeIn.: ${r.players.playerFromUid(e).getArtist()} - "${r.players.playerFromUid(e).getTitle()}" (${e})`),s.playback.masterMute===!1&&s.playback.autoplay===!1&&r.players.current.getPosition(a=>{r.players.current.getDuration()-a/1e3>=_t.minCrossfadeToTime+_t.maxBufferingDelay&&Vt(Ee.TRACK,t,e)}))}function Vt(e,t,a=null){r.eventLog.add(c.ULTRAFUNK,u.CROSSFADE_START,null);let i=r.players.crossfade.init(e,t,a);i!==null&&$t.syncControls(i.fadeOutPlayer,i.fadeInPlayer)}function Ka(e,t=null){switch(P.isDebug()&&e!==l.LOADING&&e!==l.MEDIA_LOADING&&(P.log(`embeddedEventHandler(): ${e}`),t!==null&&P.log(t)),e){case l.LOADING:k(l.LOADING,t);break;case l.MEDIA_LOADING:pe();break;case l.READY:de(wt,Ae,Ke,Bt),Yt(),k(l.READY,t),k(l.RESUME_AUTOPLAY,null,{resumeAutoplay:$a});break;case l.MEDIA_ENDED:Ke(!0);break;case l.AUTOPLAY_BLOCKED:N(),k(l.AUTOPLAY_BLOCKED,null,{togglePlayPause:Ae});break;case l.PLAYBACK_BLOCKED:N(),k(l.PLAYBACK_BLOCKED,t,{skipToTrack:Ge});break;case l.MEDIA_UNAVAILABLE:N(),k(l.MEDIA_UNAVAILABLE,t,{skipToTrack:Ge});break}}var $t=(()=>{let e={PLAY:1,PAUSE:2},t=function i(d,p){if(P.log(`playbackState.syncAll() - previousTrack: ${r.players.getPlayerIndex()+1} - nextTrack: ${r.players.indexMap.get(d)+1} - syncState: ${P.getObjectKeyForValue(e,p)}`),r.players.isCurrent(d))p===e.PLAY?(r.players.crossfade.start(),ee(),k(l.MEDIA_PLAYING,Se())):p===e.PAUSE&&(r.players.crossfade.stop(),N(),k(l.MEDIA_PAUSED,Se()));else{let O=r.players.getPlayerIndex(),h=r.players.indexMap.get(d);r.players.stop(),r.players.setPlayerIndex(h),a(O,h),i(d,p)}};function a(i,d){d>i?F():te()}return{STATE:e,syncAll:t,syncControls:a}})();var je={};Je(je,{getStatus:()=>Ja,init:()=>Ha,nextTrack:()=>Gt,prevTrack:()=>Kt,toggleMute:()=>We,togglePlayPause:()=>qe});var Ga={updateTimerInterval:250},oe=(()=>{let e=-1,t=0,a=!0,i=null;return document.addEventListener("visibilitychange",()=>{a=document.visibilityState==="visible"}),{ready(b){i=b},start:d,stop:p,update:O};function d(){p(),e=setInterval(()=>{a&&g()&&O(i.embedded.getCurrentTime(),i.getDuration())},Ga.updateTimerInterval)}function p(b=!1){e!==-1&&(clearInterval(e),e=-1),b&&O(0,0),t=0,x(!1)}function O(b,R){if(b!==void 0){let Z=Math.round(b);ye(b*1e3,Z,R),Z>0&&R>0&&h(Z,R)}}function h(b,R){s.playback.autoplay===!1&&s.playback.timeRemainingWarning&&t!==b&&(t=b,R-b<=s.playback.timeRemainingSeconds?x(!0):x(!1))}})();var I=T("list-player"),X=new re(10),n={player:null,autoplayData:null,playerReady:!1,firstStatePlaying:!0,currentTrackId:null,currentSnackbarId:0};function Ha(){I.log("init()"),at(j),Wa()!==null?Xa():f("No playable YouTube tracks!",0,"help",()=>window.location.href="/help/#list-player")}function Wa(){if(n.currentTrackId=K(),n.autoplayData=JSON.parse(sessionStorage.getItem($.UF_AUTOPLAY)),sessionStorage.removeItem($.UF_AUTOPLAY),n.currentTrackId!==null){if(n.autoplayData!==null&&n.autoplayData.trackId!==null){let e=n.autoplayData.trackId.match(mt);if(e!==null){let t=ae(`[data-track-source-uid="${e[0]}"]`);t!==null&&(n.currentTrackId=t.id)}else if(n.autoplayData.trackId.match(/^track-(?!0)\d{1,9}$/i)!==null){let t=ae(`[data-track-id="${n.autoplayData.trackId}"]`);t!==null?Ne(t)===fe.YOUTUBE?n.currentTrackId=t.id:f("Cannot play SoundCloud track",5,"help",()=>window.location.href="/help/#list-player"):f("Unable to cue track (not found)",5)}}st(n.currentTrackId)}return I.log(`cueInitialTrack() - currentTrackId: ${n.currentTrackId} - autoplayData: ${n.autoplayData!==null?JSON.stringify(n.autoplayData):"N/A"}`),n.currentTrackId}function j(e,t=!0,a=!1){let i=Ne(ot(e));if(I.log(`setCurrentTrack() - nextTrackType: ${I.getObjectKeyForValue(fe,i)} - nextTrackId: ${e} - playNextTrack: ${t} - isPointerClick: ${a}`),i===fe.SOUNDCLOUD&&a){f("Cannot play SoundCloud track",5,"help",()=>window.location.href="/help/#list-player");return}e===n.currentTrackId?qe():(g()&&n.player.embedded.stopVideo(),n.currentTrackId=e,ct(e,a),Ft(t))}function Ft(e){let t=dt();e?(n.player.embedded.loadVideoById(t),_(y.PLAYING),et()):(n.player.embedded.cueVideoById(t),_(y.PAUSED))}function qe(){n.currentTrackId===null?j(ae("div.track-entry.current").id):g()?n.player.embedded.pauseVideo():n.player.play(Ce)}function We(e=!1){e===!1&&(s.playback.masterMute=s.playback.masterMute!==!0),s.playback.masterMute?n.player.embedded.mute():n.player.embedded.unMute()}function Kt(){let e=nt(),t=n.player.embedded.getCurrentTime();e!==null&&t<=5?(j(e,g()),te()):t!==0&&(n.player.embedded.seekTo(0),oe.update(0,0))}function Gt(){let e=K();e!==null&&(j(e,g()),F())}async function Ht(e=!1,t=!1){let a=t?M.OFF:ge(),i=K();if(I.log(`advanceToNextTrack() autoplay: ${e} - isPlaybackError: ${t} - nextTrackId: ${i} - repeatMode: ${I.getObjectKeyForValue(M,a)}`),e&&a===M.ONE)n.player.embedded.seekTo(0),n.player.play(Ce);else if(e&&i===null&&a===M.ALL)j(K(null)),w(0);else if(i===null)if(s.list.showLoadMoreTracks){let d=await it();e&&d&&j(K())}else J(A.nextPage,e);else e?j(i):_(y.PAUSED)}function qa(){g()===!1&&n.autoplayData!==null&&(X.add(c.ULTRAFUNK,u.RESUME_AUTOPLAY,null),X.add(c.YOUTUBE,-1,K())),g()===!1&&Ht(!0,!0)}function ja(){n.currentTrackId=null,_(y.PAUSED)}function Ja(){let e=ae("div.track-entry.current");if(e!==null){let t=lt("div.track-entry"),a=Array.prototype.indexOf.call(t,e);return{isPlaying:g(),currentTrack:a+1,position:Math.ceil(n.player.embedded.getCurrentTime()),numTracks:n.player.getNumTracks(),trackId:t[a].getAttribute("data-track-id"),iframeId:"youtube-player"}}return{isPlaying:!1,currentTrack:1,position:0,trackId:0}}function Xa(){I.log("initYouTubeAPI()"),window.onYouTubeIframeAPIReady=function(){I.log("onYouTubeIframeAPIReady()");let a=new YT.Player("youtube-player",{events:{onReady:za,onStateChange:Qa,onError:Ce}});n.player=new Tt(a),ue(n.player,i=>n.player.embedded.seekTo(i)),B(33)};let e=document.createElement("script");e.id="youtube-iframe-api",e.src="https://www.youtube.com/iframe_api";let t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}function za(){I.log("onYouTubePlayerReady()"),n.autoplayData?.autoplay===!0&&X.add(c.ULTRAFUNK,u.RESUME_AUTOPLAY,null),de(Kt,qe,Gt,We),B(66),oe.ready(n.player),rt(n.player),We(!0),k(l.READY,{resetProgressBar:!1}),Ft(n.autoplayData?.autoplay===!0)}function Qa(e){switch(I.log(`onYouTubePlayerStateChange(): ${e.data} - trackId: ${n.currentTrackId}`),X.add(c.YOUTUBE,e.data,n.currentTrackId),e.data!==YT.PlayerState.PLAYING&&N(),e.data){case YT.PlayerState.UNSTARTED:X.ytAutoplayBlocked(n.currentTrackId,3e3)&&(_(y.PAUSED),n.currentSnackbarId=f("Autoplay blocked, Play to continue",0,"play",()=>n.player.play(Ce))),n.playerReady===!1&&(n.playerReady=!0,B(0));break;case YT.PlayerState.CUED:n.player.setPlayerState(e.data);break;case YT.PlayerState.BUFFERING:pe(),_(y.LOADING);break;case YT.PlayerState.PLAYING:Za(e),oe.start(),ee(),_(y.PLAYING);break;case YT.PlayerState.PAUSED:_(y.PAUSED);break;case YT.PlayerState.ENDED:oe.stop(!0),Ht(s.playback.autoplay);break}}function Za(e){ce(n.currentSnackbarId),n.player.setDuration(Math.round(e.target.getDuration())),n.firstStatePlaying&&(n.firstStatePlaying=!1,n.autoplayData=null,setTimeout(()=>{s.playback.autoplay&&g()&&Math.round(window.pageYOffset)<=1&&At(Pt.SITE_MAX_WIDTH_MOBILE)&&w(0)},6e3))}function Ce(e){I.log(`onYouTubePlayerError(): ${e.data} - trackId: ${n.currentTrackId}`),ut("Error!"),X.add(c.YOUTUBE,u.PLAYER_ERROR,n.currentTrackId),f("Unable to play track, skipping to next",5,"Stop",ja,qa),se("EVENT_MEDIA_UNAVAILABLE",{mediaUrl:n.player.embedded.getVideoUrl(),mediaTitle:`${n.player.getArtist()} - ${n.player.getTitle()}`})}var z=T("screen-wakelock"),Le={wakeLock:null};function Wt(){return"wakeLock"in navigator&&"request"in navigator.wakeLock}async function qt(){Wt()?document.visibilityState==="visible"&&await Jt()!==!0&&z.log("enable(): Screen Wake Lock request failed"):(z.log("enable(): Screen Wake Lock is not supported"),f("Keep Screen On is not supported",5,"Disable",()=>s.mobile.keepScreenOn=!1))}function jt(){z.log("stateVisible()"),Wt()&&Le.wakeLock===null&&Jt()}async function Jt(){try{return Le.wakeLock=await navigator.wakeLock.request("screen"),z.log("request(): Screen Wake Lock is Enabled"),Le.wakeLock.addEventListener("release",()=>{z.log("request(): Screen Wake Lock was Released"),Le.wakeLock=null}),!0}catch(e){z.error(`request(): ${e.name} - ${e.message}`)}return!1}var Qt=T("playback-interaction"),Xt=new Me(10),m={player:null,isPlaybackReady:!1},tr={doubleClickDelay:500};document.addEventListener("DOMContentLoaded",()=>{Qt.log("DOMContentLoaded"),Xe(),yt()?m.player=He:pt()&&(m.player=je),m.player!==null&&ar(),Ze(m.player?.getStatus)});function ar(){Qt.log("initShared()"),rr(),m.player.init(),ne.init(),Zt.init(),lr()}function rr(){V(l.READY,nr),V(l.MEDIA_SHOW,zt),V(l.MEDIA_ENDED,zt),V(l.MEDIA_TIME_REMAINING,sr)}function lr(){G(".playback-shuffle-control span","click",ft),Oe("span.navbar-arrow-back","click",Q,A.prevPage),Oe("span.navbar-arrow-fwd","click",Q,A.nextPage),G("nav.post-navigation .nav-previous a","click",Q,A.prevPage),G("nav.post-navigation .nav-next a","click",Q,A.nextPage),document.addEventListener("keydown",or),window.addEventListener("blur",ir)}function or(e){if(m.isPlaybackReady&&Zt.allow()&&e.repeat===!1&&e.ctrlKey===!1&&e.altKey===!1){switch(e.code){case"Backquote":e.preventDefault(),w(m.player.getStatus().trackId);break}switch(e.key){case" ":e.preventDefault(),m.player.togglePlayPause();break;case"Home":case"End":case"PageUp":case"PageDown":Et(e);break;case"ArrowLeft":e.preventDefault(),e.shiftKey===!0?Q(null,A.prevPage):m.player.prevTrack();break;case"ArrowRight":e.preventDefault(),e.shiftKey===!0?Q(null,A.nextPage):m.player.nextTrack();break;case"A":De.toggle();break;case"f":case"F":e.preventDefault(),ne.toggle(document.getElementById(m.player.getStatus().iframeId));break;case"m":case"M":e.preventDefault(),m.player.toggleMute(),f(s.playback.masterMute?"Volume is muted (<b>m</b> to unmute)":"Volume is unmuted (<b>m</b> to mute)",3);break;case"p":case"P":ze.toggle();break;case"r":case"R":f(`${tt().title} (<b>r</b> to change)`,3);break;case"x":case"X":Qe.toggle();break}}}function nr(){G(".playback-details-control","click",cr),G(".playback-thumbnail-control","click",ur),G(".playback-timer-control","click",dr),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&s.mobile.keepScreenOn&&jt()}),s.mobile.keepScreenOn&&qt(),m.isPlaybackReady=!0}function zt(){s.playback.autoExitFullscreen&&ne.exit()}function sr(e){s.playback.autoExitFsOnWarning&&e.data.timeRemainingSeconds<=s.playback.timeRemainingSeconds&&ne.exit()}function ir(){Ue()||setTimeout(()=>{document.activeElement instanceof HTMLIFrameElement&&setTimeout(()=>{document.activeElement.blur(),document.activeElement instanceof HTMLIFrameElement&&document.activeElement.blur()},250)},0)}function cr(){w(m.player.getStatus().trackId),Ie("showTrackDetailsHint","<b>Tip:</b> Click or tap Artist &amp; Title to show current track")}function ur(){gt()?(Xt.add(c.MOUSE,u.MOUSE_CLICK,null),Ie("showGalleryTrackThumbnailHint","<b>Tip:</b> Double click or tap Track Thumbnail for full screen"),Xt.doubleClicked(c.MOUSE,u.MOUSE_CLICK,tr.doubleClickDelay)&&ne.enter(document.getElementById(m.player.getStatus().iframeId))):Ue()&&(w(0),Ie("showListTrackThumbnailHint","<b>Tip:</b> Click or tap Track Thumbnail to show player"))}function dr(){De.toggle(),Ie("showTrackTimerHint","<b>Tip:</b> Click or tap Track Timer to toggle Autoplay On / Off")}function Ie(e,t,a=0){s.tips[e]&&(f(t,a),s.tips[e]=!1)}function Q(e,t){e?.preventDefault(),J(t,m.player.getStatus().isPlaying)}var ne=(()=>{let e=new Event("fullscreenElement"),t=null;return{init:a,enter:d,exit:p,toggle:O};function a(){document.addEventListener("fullscreenchange",i),document.addEventListener("webkitfullscreenchange",i)}function i(){t=document.fullscreenElement!==null?document.fullscreenElement.id:null,e.fullscreenTarget=t,document.dispatchEvent(e)}function d(h){h.requestFullscreen()}function p(){t!==null&&(document.exitFullscreen(),t=null)}function O(h){t===null?d(h):p()}})(),Zt=(()=>{let e=!1;return{allow(){return e},init:t};function t(){e=s.playback.keyboardShortcuts,document.addEventListener("allowKeyboardShortcuts",()=>{s.playback.keyboardShortcuts&&(e=!0)}),document.addEventListener("denyKeyboardShortcuts",()=>{s.playback.keyboardShortcuts&&(e=!1)})}})();
//# sourceMappingURL=interaction.js.map
