import{$ as ct,A as de,B as pe,C as z,D as _,E as k,F as ze,G as Q,H as V,I as Qe,J as oe,K as $,L as x,M as ye,N as Ze,O as et,P as tt,Q as ne,R as at,S as rt,T as Ue,U as ot,V as F,W as nt,X as lt,Y as K,Z as st,_ as it,a as qe,b as m,c as ie,ca as ge,da as ut,e as ce,ea as dt,f as X,ga as pt,ha as fe,ia as yt,ja as G,k as I,ka as w,l,la as gt,m as He,ma as Ee,na as ft,oa as Et,p as b,pa as Oe,q as ue,qa as kt,r as je,ra as Tt,s as Je,t as ve,ta as mt,u as Xe,ua as W,v as r,va as Re,w as y,x as p,y as E,ya as bt,z as Ne,za as q}from"../chunk-MJSJOIS5.js";var Ye=m("eventlogger"),u={UNKNOWN:1e3,KEYBOARD:100,MOUSE:110,YOUTUBE:1,SOUNDCLOUD:2,ULTRAFUNK:50},d={UNKNOWN:-2e3,KEY_ARROW_LEFT:180,KEY_ARROW_RIGHT:181,MOUSE_CLICK:182,STATE_ERROR:-5,STATE_UNSTARTED:-1,STATE_ENDED:0,STATE_PLAYING:1,STATE_PAUSED:2,STATE_BUFFERING:3,STATE_CUED:5,RESUME_AUTOPLAY:50,PLAYER_ERROR:60,CROSSFADE_START:70},zt={eventSource:u.UNKNOWN,eventType:d.UNKNOWN,uId:null,timeStamp:0},ke=class{constructor(t=10){this.log=[],this.maxEntries=t,this.lastPos=0,this.matchCount=0}add(t,a,s,c=Date.now()){let f=Object.create(zt);f.eventSource=t,f.eventType=a,f.uId=s,f.timeStamp=c,this.log.length<this.maxEntries?this.log.push(f):(this.log.shift(),this.log.push(f))}clear(){this.log=[]}initMatch(){this.lastPos=this.log.length-1,this.matchCount=0}matchesEvent(t,a,s,c=null){this.log[this.lastPos-t].eventSource===a&&this.log[this.lastPos-t].eventType===s&&this.log[this.lastPos-t].uId===c&&this.matchCount++}matchesDelta(t,a){this.log[this.lastPos].timeStamp-this.log[this.lastPos-t].timeStamp<=a&&this.matchCount++}isPatternMatch(t,a){return this.matchCount===t?(Ye.log(`MATCH for: ${a}`),Ye.logEventLog(this.log,u,d),!0):!1}},Te=class extends ke{constructor(t){super(t)}doubleClicked(t,a,s){return this.initMatch(),this.lastPos>=1&&(this.matchesEvent(1,t,a),this.matchesEvent(0,t,a),this.matchesDelta(1,s)),this.isPatternMatch(3,`${Ye.getObjectKeyForValue(u,t)} Double Clicked`)}},Z=class extends ke{constructor(t){super(t)}ytAutoplayBlocked(t,a){return this.initMatch(),this.lastPos>=3&&(this.matchesEvent(3,u.ULTRAFUNK,d.RESUME_AUTOPLAY,null),this.matchesEvent(2,u.YOUTUBE,d.STATE_UNSTARTED,t),this.matchesEvent(1,u.YOUTUBE,d.STATE_BUFFERING,t),this.matchesEvent(0,u.YOUTUBE,d.STATE_UNSTARTED,t),this.matchesDelta(3,a)),this.isPatternMatch(5,"YouTube Autoplay Blocked")}scAutoplayBlocked(t,a){return this.initMatch(),this.lastPos>=3&&(this.matchesEvent(3,u.ULTRAFUNK,d.RESUME_AUTOPLAY,null),this.matchesEvent(2,u.SOUNDCLOUD,d.STATE_PLAYING,t),this.matchesEvent(1,u.SOUNDCLOUD,d.STATE_PAUSED,t),this.matchesEvent(0,u.SOUNDCLOUD,d.STATE_PAUSED,t),this.matchesDelta(3,a)),this.isPatternMatch(5,"SoundCloud Autoplay Blocked")}scWidgetPlayBlocked(t,a){return this.initMatch(),this.lastPos>=2&&(this.matchesEvent(2,u.SOUNDCLOUD,d.STATE_PLAYING,t),this.matchesEvent(1,u.SOUNDCLOUD,d.STATE_PAUSED,t),this.matchesEvent(0,u.SOUNDCLOUD,d.STATE_PAUSED,t),this.matchesDelta(2,a)),this.isPatternMatch(4,"SoundCloud WidgetPlay Blocked")}scPlayDoubleTrigger(t,a){return this.initMatch(),this.lastPos>=2&&(this.matchesEvent(2,u.ULTRAFUNK,d.CROSSFADE_START,null),this.matchesEvent(1,u.SOUNDCLOUD,d.STATE_PLAYING,t),this.matchesEvent(0,u.SOUNDCLOUD,d.STATE_PLAYING,t),this.matchesDelta(1,a)),this.isPatternMatch(4,"SoundCloud Play Double Trigger")}};var $e={};qe($e,{getStatus:()=>he,init:()=>Ra,nextTrack:()=>Be,prevTrack:()=>Ot,toggleMute:()=>Rt,togglePlayPause:()=>Ce});var Pt={updateTimerInterval:250,maxBufferingDelay:3},v=(()=>{let e=-1,t=0,a=!0,s=null,c=null;return{init:f,start:O,stop:A,updateCallback:J};function f(T,L){s=T,c=L,document.addEventListener("visibilitychange",()=>{a=document.visibilityState==="visible"})}function O(){A(!1),e=setInterval(()=>{a&&s.current.getPosition(J)},Pt.updateTimerInterval)}function A(){e!==-1&&(clearInterval(e),e=-1),t=0,V(!1)}function J(T,L=0){let M=Math.round(T/1e3);_(T,M,L),M>0&&L>0&&(h(M,L),Y(M,L))}function h(T,L){if(l.playback.autoplay===!1&&l.playback.timeRemainingWarning&&t!==T){let M=L-T;t=T,M<=l.playback.timeRemainingSeconds?(V(!0),p(r.MEDIA_TIME_REMAINING,{timeRemainingSeconds:M})):V(!1)}}function Y(T,L){l.playback.masterMute===!1&&l.playback.autoplay&&l.gallery.autoCrossfade&&L-T===l.gallery.autoCrossfadeLength+Pt.maxBufferingDelay&&s.getCurrentTrack()+1<=s.getNumTracks()&&c(Ee.AUTO,{name:"Auto Crossfade",length:l.gallery.autoCrossfadeLength,curve:l.gallery.autoCrossfadeCurve})}})();var P=m("embedded-players"),R=new Z(10),i={players:{},playbackState:null,embeddedEvent:null,loadEventsTotal:0,loadEventsCount:1},xe={youTubeIframeIdRegEx:/youtube-uid/i,soundCloudIframeIdRegEx:/soundcloud-uid/i,maxPlaybackStartDelay:3};function St(e,t,a){i.players=e,i.playbackState=t,i.embeddedEvent=a,i.loadEventsTotal=3+parseInt(document.body.getAttribute("data-gallery-track-count")),ta(),da()}function be(){return{loadingPercent:100*(i.loadEventsCount++/i.loadEventsTotal)}}function At(){i.loadEventsCount>=i.loadEventsTotal?i.embeddedEvent(r.READY,{resetProgressBar:!0}):p(r.LOADING,be())}function Zt(){document.querySelectorAll("single-track").forEach(t=>{let a=t.querySelector("iframe"),s=null;if(xe.youTubeIframeIdRegEx.test(a.id)){let c=new YT.Player(a.id,{events:{onReady:aa,onStateChange:ra,onError:ua}});s=new Et(t.id,a.id,c,t.getAttribute("data-track-source-data"))}else if(xe.soundCloudIframeIdRegEx.test(a.id)){let c=SC.Widget(a.id);s=new Oe(t.id,a.id,c,a.src),c.bind(SC.Widget.Events.READY,()=>{s.setThumbnail(t.querySelector(".track-share-control span")),pa()}),c.bind(SC.Widget.Events.PLAY,ya),c.bind(SC.Widget.Events.PAUSE,ga),c.bind(SC.Widget.Events.FINISH,fa),c.bind(SC.Widget.Events.ERROR,Ea)}s!==null&&(s.setTitle(t.getAttribute("data-track-title")),s.setArtist(t.getAttribute("data-track-artist")),s.setDuration(parseInt(t.getAttribute("data-track-duration"))),i.players.add(s))})}function Pe(e,t){P.log("onPlayerError()"),P.log(e);let a=e instanceof Oe?u.SOUNDCLOUD:u.YOUTUBE;i.players.isCurrent(e.getUid())===!1&&i.players.stop(),R.add(a,d.PLAYER_ERROR,e.getUid()),i.embeddedEvent(r.MEDIA_UNAVAILABLE,ea(e,t))}function ea(e,t){let a=e.getArtist()||"N/A",s=e.getTitle()||"N/A";return{currentTrack:i.players.trackFromUid(e.getUid()),numTracks:i.players.getNumTracks(),trackId:e.getTrackId(),mediaTitle:`${a} - ${s}`,mediaUrl:t}}function ta(){P.log("initYouTubeAPI()"),p(r.LOADING,be()),window.onYouTubeIframeAPIReady=function(){P.log("onYouTubeIframeAPIReady()"),p(r.LOADING,be()),Zt()};let e=document.createElement("script");e.id="youtube-iframe-api",e.src="https://www.youtube.com/iframe_api";let t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}function aa(){P.log("onYouTubePlayerReady()"),At()}function ra(e){switch(R.add(u.YOUTUBE,e.data,e.target.h.id),e.data){case YT.PlayerState.UNSTARTED:oa(e);break;case YT.PlayerState.BUFFERING:na(e);break;case YT.PlayerState.PLAYING:la(e);break;case YT.PlayerState.PAUSED:sa(e);break;case YT.PlayerState.CUED:ia(e);break;case YT.PlayerState.ENDED:ca(e);break}}function oa(e){P.log(`onYouTubePlayerStateChange: UNSTARTED (uID: ${e.target.h.id})`),R.ytAutoplayBlocked(e.target.h.id,3e3)&&i.embeddedEvent(r.AUTOPLAY_BLOCKED)}function na(e){if(P.log(`onYouTubePlayerStateChange: BUFFERING (uID: ${e.target.h.id})`),i.players.crossfade.isFading()===!1){let t=i.players.playerFromUid(e.target.h.id);t.mute(l.playback.masterMute),t.setVolume(l.playback.masterVolume),p(r.MEDIA_LOADING)}}function la(e){P.log(`onYouTubePlayerStateChange: PLAYING   (uID: ${e.target.h.id})`),i.playbackState.syncAll(e.target.h.id,i.playbackState.STATE.PLAY),i.players.current.setDuration(Math.round(e.target.getDuration())),v.start()}function sa(e){P.log(`onYouTubePlayerStateChange: PAUSED    (uID: ${e.target.h.id})`),i.players.isCurrent(e.target.h.id)?(i.playbackState.syncAll(e.target.h.id,i.playbackState.STATE.PAUSE),v.stop()):i.players.crossfade.stop()}function ia(e){P.log(`onYouTubePlayerStateChange: CUED      (uID: ${e.target.h.id})`)}function ca(e){P.log(`onYouTubePlayerStateChange: ENDED     (uID: ${e.target.h.id})`),i.players.isCurrent(e.target.h.id)?(v.stop(),i.embeddedEvent(r.MEDIA_ENDED)):i.players.crossfade.stop()}function ua(e){P.log("onYouTubePlayerError: "+e.data);let t=i.players.playerFromUid(e.target.h.id);t.setPlayable(!1),Pe(t,e.target.getVideoUrl())}function da(){P.log("initSoundCloudAPI()"),p(r.LOADING,be())}function pa(){P.log("onSoundCloudPlayerEventReady()"),At()}function ya(e){P.log(`onSoundCloudPlayerEvent: PLAY   (uID: ${e.soundId})`),R.add(u.SOUNDCLOUD,d.STATE_PLAYING,e.soundId),i.players.crossfade.isFading()&&i.players.isCurrent(e.soundId)?R.scPlayDoubleTrigger(e.soundId,xe.maxPlaybackStartDelay*1e3)&&i.playbackState.syncAll(e.soundId,i.playbackState.STATE.PLAY):(i.playbackState.syncAll(e.soundId,i.playbackState.STATE.PLAY),i.players.current.mute(l.playback.masterMute),i.players.current.setVolume(l.playback.masterVolume)),i.players.current.getEmbeddedPlayer().getDuration(t=>{i.players.current.setDuration(Math.round(t/1e3)),v.start()})}function ga(e){P.log(`onSoundCloudPlayerEvent: PAUSE  (uID: ${e.soundId})`),R.add(u.SOUNDCLOUD,d.STATE_PAUSED,e.soundId),R.scAutoplayBlocked(e.soundId,3e3)?(v.stop(),i.embeddedEvent(r.AUTOPLAY_BLOCKED)):R.scWidgetPlayBlocked(e.soundId,3e4)?(v.stop(),i.embeddedEvent(r.PLAYBACK_BLOCKED,{currentTrack:i.players.trackFromUid(e.soundId),numTracks:i.players.getNumTracks()})):i.players.isCurrent(e.soundId)?i.players.current.getPosition(t=>{t>0&&(i.playbackState.syncAll(e.soundId,i.playbackState.STATE.PAUSE),v.stop())}):i.players.crossfade.stop()}function fa(e){P.log(`onSoundCloudPlayerEvent: FINISH (uID: ${e.soundId})`),i.players.isCurrent(e.soundId)?(v.stop(),i.embeddedEvent(r.MEDIA_ENDED)):i.players.crossfade.stop()}function Ea(){this.getCurrentSound(e=>{let t=i.players.playerFromUid(e.id);P.log(`onSoundCloudPlayerEvent: ERROR for track: ${i.players.trackFromUid(e.id)}. ${t.getArtist()} - ${t.getTitle()} - [${t.getUid()} / ${t.getIframeId()}]`),t.setPlayable(!1)})}var N=m("gallery-events"),Se={snackbarId:0,nowPlayingIcons:null},_e={nowPlayingIconsSelector:"h2.entry-title"};function Ct(){N.log("init()"),Se.nowPlayingIcons=document.querySelectorAll(_e.nowPlayingIconsSelector),y(r.MEDIA_PLAYING,Ta),y(r.MEDIA_PAUSED,ma),y(r.MEDIA_ENDED,ba),y(r.MEDIA_SHOW,Pa),y(r.CONTINUE_AUTOPLAY,Sa),y(r.RESUME_AUTOPLAY,Aa),y(r.AUTOPLAY_BLOCKED,Ca),y(r.PLAYBACK_BLOCKED,ha),y(r.MEDIA_UNAVAILABLE,Ia)}function Ta(e){if(N.log(e),ue(Se.snackbarId),e.data.numTracks>1){let t=document.querySelector(`#${e.data.trackId} ${_e.nowPlayingIconsSelector}`);ht(t),q(t,"playing-paused","now-playing-icon"),l.gallery.animateNowPlayingIcon&&t.classList.add("playing-animate")}}function ma(e){N.log(e),e.data.numTracks>1&&document.querySelector(`#${e.data.trackId} ${_e.nowPlayingIconsSelector}`).classList.add("playing-paused")}function ba(e){N.log(e),e!==null&&e.data.numTracks>1&&ht()}function Pa(e){N.log(e),z(0),e.data.scrollToMedia&&w(e.data.trackId)}function Sa(e){N.log(e),G(I.nextPage,!0)}function Aa(e){let t=JSON.parse(sessionStorage.getItem(X.UF_AUTOPLAY));if(sessionStorage.removeItem(X.UF_AUTOPLAY),N.log(e),N.log(`RESUME_AUTOPLAY: ${t!==null?JSON.stringify(t):"NO"}`),t!==null){let a=document.getElementById(t.trackId)?.querySelector("iframe").id;e.callback.resumeAutoplay(t,a)}}function Ca(e){N.log(e),Se.snackbarId=b("Autoplay blocked, Play to continue",0,"play",()=>e.callback.togglePlayPause())}function ha(e){N.log(e),b("Unable to play track, skipping to next",5,"Stop",()=>{},()=>we(e))}function Ia(e){N.log(e),La(e.data.trackId)?b("YouTube Premium track, skipping",5,"help",()=>window.location.href="/channel/premium/",()=>we(e)):(b("Unable to play track, skipping to next",5,"Stop",()=>{},()=>we(e)),ie("EVENT_MEDIA_UNAVAILABLE",e.data))}function ht(e){Se.nowPlayingIcons.forEach(t=>{t!==e&&t.classList.remove("now-playing-icon","playing-animate","playing-paused")})}function we(e){e.data.currentTrack<e.data.numTracks?e.callback.skipToTrack(e.data.currentTrack+1,!0):I.nextPage!==null&&G(I.nextPage,!0)}function La(e){let t=document.getElementById(e);return t!==null?t.classList.contains("uf_channel-premium"):!1}var Ve=m("crossfade-controls"),Ae={players:{}},D={},H={crossfadePresetSelector:".crossfade-preset-control",crossfadePresetData:"data-crossfade-preset",crossfadeToSelector:".crossfade-fadeto-control"};function Lt(e,t){Ve.log("init()"),Ae.players=e,D.crossfadePreset=new Ne(H.crossfadePresetSelector),D.crossfadeTo=new Ne(H.crossfadeToSelector),D.crossfadePreset.length>1&&D.crossfadeTo.length>1&&(D.crossfadePreset.forEach(a=>Dt(a,l.gallery.trackCrossfadeDefPreset)),D.crossfadeTo.clickCallback=t),y(r.READY,va)}function va(){Ve.log("ready()"),D.crossfadePreset.length>1&&D.crossfadeTo.length>1&&(D.crossfadePreset.forEach(e=>{e.addEventListener("click",Na),q(e,E.DISABLED.CLASS,E.ENABLED.CLASS)}),D.crossfadeTo.forEach(e=>e.addEventListener("click",Ua)),y(r.MEDIA_PLAYING,It),y(r.MEDIA_PAUSED,It))}function Dt(e,t){e.setAttribute(H.crossfadePresetData,t),e.textContent=`${t+1}`,e.title=`Preset: ${ce.crossfade[t].name}`}function Na(e){let t=parseInt(e.target.getAttribute(H.crossfadePresetData));Dt(e.target,t+1<ce.crossfade.length?t+1:0)}function Ua(e){if(k()&&Ae.players.crossfade.isFading()===!1){let t=e.target.closest("single-track");if(t!==null){let a=t.querySelector("iframe"),s=parseInt(t.querySelector(H.crossfadePresetSelector).getAttribute(H.crossfadePresetData));q(t.querySelector(`div${H.crossfadeToSelector}`),E.ENABLED.CLASS,E.DISABLED.CLASS),D.crossfadeTo.clickCallback(Ae.players.uIdFromIframeId(a.id),ce.crossfade[s])}}}function It(){let e=k(),t=e?Ae.players.getTrackData().currentTrack:-1;Ve.log(`updateCrossfadeToState() - playingState: ${e} - currentTrack: ${t}`),D.crossfadeTo.forEach((a,s)=>{t===s+1?q(a,e?E.ENABLED.CLASS:E.DISABLED.CLASS,e?E.DISABLED.CLASS:E.ENABLED.CLASS):q(a,e?E.DISABLED.CLASS:E.ENABLED.CLASS,e?E.ENABLED.CLASS:E.DISABLED.CLASS)})}var vt=m("gallery-players"),Nt=()=>{let e=null,t=null,a=[],s=new Map,c=0;return{indexMap:s,get crossfade(){return t},get current(){return a[c]},get next(){return a[c+1]},getPlayerIndex(){return c},setPlayerIndex(g){c=g},getNumTracks(){return a.length},getCurrentTrack(){return c+1},playerFromUid(g){return a[s.get(g)]},trackFromUid(g){return s.get(g)+1},isCurrent(g){return g===this.current.getUid()},init:f,add:O,uIdFromIframeId:A,stop:J,mute:h,getTrackData:Y,prevTrack:T,nextTrack:L,jumpToTrack:M};function f(g){vt.log("init()"),e=g,t=ft(this),y(r.MEDIA_PLAYING,()=>t.start()),y(r.MEDIA_PAUSED,()=>t.stop())}function O(g){vt.log(g),a.push(g),s.set(g.getUid(),a.length-1)}function A(g){return a.find(De=>De.iframeId===g).getUid()}function J(){this.current.stop(),t.stop()}function h(){this.current.mute(l.playback.masterMute),t.mute(l.playback.masterMute)}function Y(){return{currentTrack:this.getCurrentTrack(),numTracks:this.getNumTracks(),artist:this.current.getArtist(),title:this.current.getTitle(),duration:this.current.getDuration(),thumbnail:{src:this.current.getThumbnailSrc(),class:this.current.getThumbnailClass()}}}function T(g){return c>0?(c--,e(g),!0):!1}function L(g){return c++,c<this.getNumTracks()?(e(g),!0):!1}function M(g,De,Xt=!0){return g>0&&g<=this.getNumTracks()?(c=g-1,e(De,Xt),!0):!1}};var C=m("gallery-playback"),o={eventLog:null,players:{}},Ut={minCrossfadeToTime:5,maxBufferingDelay:3};function Ra(){C.log("init()"),o.eventLog=R,Ct(),o.players=Nt(),o.players.init(Yt),de(o.players,Ma),Lt(o.players,_a),v.init(o.players,xt),St(o.players,wt,Va)}function Ce(){k()?(Q(),o.players.current.pause()):(ze(),o.players.current.play(Pe))}function Ot(){C.log(`prevTrack() - prevTrack: ${o.players.getCurrentTrack()-1} - numTracks: ${o.players.getNumTracks()}`),o.players.getCurrentTrack()>0&&o.players.current.getPosition(e=>{e>5e3?(o.players.current.seekTo(0),_(0,0,o.players.current.getDuration())):(o.players.getCurrentTrack()>1&&o.players.stop(),o.players.prevTrack(k())&&oe())})}function Be(e=!1){let t=o.players.getCurrentTrack()+1>o.players.getNumTracks();C.log(`nextTrack() - isMediaEnded: ${e} - isLastTrack: ${t} - autoplay: ${l.playback.autoplay}`),!Ya(e,t)&&(t===!1?(o.players.stop(),e&&l.playback.autoplay===!1?Q():o.players.nextTrack(k())&&$()):e&&(Q(),l.playback.autoplay?p(r.CONTINUE_AUTOPLAY):o.players.stop()))}function Ya(e,t){if(e&&l.playback.autoplay){let a=ye();if(C.log(`repeatPlayback(): ${C.getObjectKeyForValue(x,a)}`),a===x.ONE)return o.players.current.seekTo(0),o.players.current.play(),!0;if(t&&a===x.ALL)return o.players.stop(),o.players.setPlayerIndex(0),Yt(!0),!0}return!1}function Ma(e){o.players.current.seekTo(e)}function Rt(){l.playback.masterMute=l.playback.masterMute!==!0,o.players.mute()}function xa(e,t=!0){C.log(`cueTrack(): ${e}`),o.players.setPlayerIndex(o.players.indexMap.get(e)),p(r.MEDIA_SHOW,{scrollToMedia:t,trackId:o.players.current.getTrackId()}),$()}function Yt(e,t=!0){p(r.MEDIA_SHOW,{scrollToMedia:t,trackId:o.players.current.getTrackId()}),e&&o.players.current.play(Pe)}function Mt(e,t=!0){C.log(`skipToTrack(): ${e} - ${t}`),t===!0&&k()===!1&&(o.eventLog.clear(),o.eventLog.add(u.ULTRAFUNK,d.RESUME_AUTOPLAY,null),o.players.jumpToTrack(e,t)&&$())}function wa(e,t=null){C.log(`resumeAutoplay(): ${e.autoplay}${t!==null?" - "+t:""}`),t!==null?e.autoplay?Mt(o.players.trackFromUid(t),!0):xa(t):e.autoplay&&(o.eventLog.add(u.ULTRAFUNK,d.RESUME_AUTOPLAY,null),Ce())}function he(){return{isPlaying:k(),currentTrack:o.players.getCurrentTrack(),position:0,numTracks:o.players.getNumTracks(),trackId:o.players.current.getTrackId(),iframeId:o.players.current.getIframeId()}}function _a(e,t){o.players.isCurrent(e)===!1&&o.players.current.getDuration()>0&&(C.log(`crossfadeToClick():
      fadeOut: ${o.players.current.getArtist()} - "${o.players.current.getTitle()}" (${o.players.current.getUid()})
      fadeIn.: ${o.players.playerFromUid(e).getArtist()} - "${o.players.playerFromUid(e).getTitle()}" (${e})`),l.playback.masterMute===!1&&l.playback.autoplay===!1&&o.players.current.getPosition(a=>{o.players.current.getDuration()-a/1e3>=Ut.minCrossfadeToTime+Ut.maxBufferingDelay&&xt(Ee.TRACK,t,e)}))}function xt(e,t,a=null){o.eventLog.add(u.ULTRAFUNK,d.CROSSFADE_START,null);let s=o.players.crossfade.init(e,t,a);s!==null&&wt.syncControls(s.fadeOutPlayer,s.fadeInPlayer)}function Va(e,t=null){switch(C.log(`embeddedEventHandler() - event: ${C.getObjectKeyForValue(r,e)}`),t!==null&&C.log(t),e){case r.MEDIA_ENDED:p(r.MEDIA_ENDED,he()),Be(!0);break;case r.READY:pe(Ot,Ce,Be,Rt),p(r.READY,t),p(r.RESUME_AUTOPLAY,null,{resumeAutoplay:wa});break;case r.AUTOPLAY_BLOCKED:p(r.AUTOPLAY_BLOCKED,null,{togglePlayPause:Ce});break;case r.PLAYBACK_BLOCKED:case r.MEDIA_UNAVAILABLE:p(e,t,{skipToTrack:Mt});break}}var wt=(()=>{let e={PLAY:1,PAUSE:2},t=function s(c,f){if(C.log(`playbackState.syncAll() - previousTrack: ${o.players.getPlayerIndex()+1} - nextTrack: ${o.players.indexMap.get(c)+1} - syncState: ${C.getObjectKeyForValue(e,f)}`),o.players.isCurrent(c))f===e.PLAY?p(r.MEDIA_PLAYING,he()):f===e.PAUSE&&p(r.MEDIA_PAUSED,he());else{let O=o.players.getPlayerIndex(),A=o.players.indexMap.get(c);o.players.stop(),o.players.setPlayerIndex(A),a(O,A),s(c,f)}};function a(s,c){c>s?$():oe()}return{STATE:e,syncAll:t,syncControls:a}})();var We={};qe(We,{getStatus:()=>qa,init:()=>Fa,nextTrack:()=>Bt,prevTrack:()=>Vt,toggleMute:()=>Ke,togglePlayPause:()=>Ge});var Ba={updateTimerInterval:250},Fe=(()=>{let e=-1,t=0,a=!0,s=null;return{ready:c,start:f,stop:O,update:A};function c(h){s=h,y(r.MEDIA_PLAYING,()=>f()),document.addEventListener("visibilitychange",()=>{a=document.visibilityState==="visible"})}function f(){O(),e=setInterval(()=>{a&&k()&&A(s.embedded.getCurrentTime(),s.getDuration())},Ba.updateTimerInterval)}function O(){e!==-1&&(clearInterval(e),e=-1),t=0,V(!1)}function A(h,Y){if(h!==void 0){let T=Math.round(h);_(h*1e3,T,Y),T>0&&Y>0&&J(T,Y)}}function J(h,Y){if(l.playback.autoplay===!1&&l.playback.timeRemainingWarning&&t!==h){let T=Y-h;t=h,T<=l.playback.timeRemainingSeconds?(V(!0),p(r.MEDIA_TIME_REMAINING,{timeRemainingSeconds:T})):V(!1)}}})();var U=m("list-playback"),te=new Z(10),n={player:null,autoplayData:null,playerReady:!1,firstStatePlaying:!0,currentTrackId:null,currentSnackbarId:0};function Fa(){U.log("init()"),et(j),Ka()!==null?Ha():b("No playable YouTube tracks!",0,"help",()=>window.location.href="/help/#list-player")}function Ka(){if(n.currentTrackId=F(),n.autoplayData=JSON.parse(sessionStorage.getItem(X.UF_AUTOPLAY)),sessionStorage.removeItem(X.UF_AUTOPLAY),n.currentTrackId!==null){if(n.autoplayData!==null&&n.autoplayData.trackId!==null){let e=n.autoplayData.trackId.match(Tt);if(e!==null){let t=ne(`[data-track-source-uid="${e[0]}"]`);t!==null&&(n.currentTrackId=t.id)}else if(n.autoplayData.trackId.match(/^track-(?!0)\d{1,9}$/i)!==null){let t=ne(`[data-track-id="${n.autoplayData.trackId}"]`);t!==null?Ue(t)===ge.YOUTUBE?n.currentTrackId=t.id:b("Cannot play SoundCloud track",5,"help",()=>window.location.href="/help/#list-player"):b("Unable to cue track (not found)",5)}}nt(n.currentTrackId)}return U.log(`cueInitialTrack() - currentTrackId: ${n.currentTrackId} - autoplayData: ${n.autoplayData!==null?JSON.stringify(n.autoplayData):"N/A"}`),n.currentTrackId}function j(e,t=!0,a=!1){let s=Ue(rt(e));if(U.log(`setCurrentTrack() - nextTrackType: ${U.getObjectKeyForValue(ge,s)} - nextTrackId: ${e} - playNextTrack: ${t} - isPointerClick: ${a}`),s===ge.SOUNDCLOUD&&a){b("Cannot play SoundCloud track",5,"help",()=>window.location.href="/help/#list-player");return}e===n.currentTrackId?Ge():(k()&&n.player.embedded.stopVideo(),n.currentTrackId=e,st(e,a),_t(t))}function _t(e){let t=ct();e?(n.player.embedded.loadVideoById(t),K(E.PLAYING),Qe()):(n.player.embedded.cueVideoById(t),K(E.PAUSED))}function Ge(){n.currentTrackId===null?j(ne("div.track-entry.current").id):k()?n.player.embedded.pauseVideo():n.player.play(Ie)}function Ke(e=!1){e===!1&&(l.playback.masterMute=l.playback.masterMute!==!0),l.playback.masterMute?n.player.embedded.mute():n.player.embedded.unMute()}function Vt(){let e=ot(),t=n.player.embedded.getCurrentTime();e!==null&&t<=5?(j(e,k()),oe()):t!==0&&(n.player.embedded.seekTo(0),_(0,0,n.player.getDuration()))}function Bt(){let e=F();e!==null&&(j(e,k()),$())}async function $t(e=!1,t=!1){let a=t?x.OFF:ye(),s=F();if(U.log(`advanceToNextTrack() autoplay: ${e} - isPlaybackError: ${t} - nextTrackId: ${s} - repeatMode: ${U.getObjectKeyForValue(x,a)}`),e&&a===x.ONE)n.player.embedded.seekTo(0),n.player.play(Ie);else if(e&&s===null&&a===x.ALL)j(F(null)),w(0);else if(s===null)if(l.list.showLoadMoreTracks){let c=await lt();e&&c&&j(F())}else G(I.nextPage,e);else e?j(s):K(E.PAUSED)}function Ga(){k()===!1&&n.autoplayData!==null&&(te.add(u.ULTRAFUNK,d.RESUME_AUTOPLAY,null),te.add(u.YOUTUBE,-1,F())),k()===!1&&$t(!0,!0)}function Wa(){n.currentTrackId=null,K(E.PAUSED)}function qa(){let e=ne("div.track-entry.current");if(e!==null){let t=at("div.track-entry"),a=Array.prototype.indexOf.call(t,e);return{isPlaying:k(),currentTrack:a+1,position:Math.ceil(n.player.embedded.getCurrentTime()),numTracks:n.player.getNumTracks(),trackId:t[a].getAttribute("data-track-id"),iframeId:"youtube-player"}}return{isPlaying:!1,currentTrack:1,position:0,trackId:0}}function Ha(){U.log("initYouTubeAPI()"),window.onYouTubeIframeAPIReady=function(){U.log("onYouTubeIframeAPIReady()");let a=new YT.Player("youtube-player",{events:{onReady:ja,onStateChange:Ja,onError:Ie}});n.player=new kt(a),de(n.player,s=>n.player.embedded.seekTo(s)),z(33)};let e=document.createElement("script");e.id="youtube-iframe-api",e.src="https://www.youtube.com/iframe_api";let t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}function ja(){U.log("onYouTubePlayerReady()"),n.autoplayData?.autoplay===!0&&te.add(u.ULTRAFUNK,d.RESUME_AUTOPLAY,null),pe(Vt,Ge,Bt,Ke),z(66),Fe.ready(n.player),tt(n.player),Ke(!0),p(r.READY,{resetProgressBar:!1}),_t(n.autoplayData?.autoplay===!0)}function Ja(e){switch(U.log(`onYouTubePlayerStateChange(): ${e.data} - trackId: ${n.currentTrackId}`),te.add(u.YOUTUBE,e.data,n.currentTrackId),e.data!==YT.PlayerState.PLAYING&&Q(),e.data){case YT.PlayerState.UNSTARTED:Xa();break;case YT.PlayerState.CUED:n.player.setPlayerState(e.data);break;case YT.PlayerState.BUFFERING:p(r.MEDIA_LOADING);break;case YT.PlayerState.PLAYING:za(e),p(r.MEDIA_PLAYING);break;case YT.PlayerState.PAUSED:K(E.PAUSED);break;case YT.PlayerState.ENDED:Fe.stop(),p(r.MEDIA_ENDED),$t(l.playback.autoplay);break}}function Xa(){te.ytAutoplayBlocked(n.currentTrackId,3e3)&&(K(E.PAUSED),n.currentSnackbarId=b("Autoplay blocked, Play to continue",0,"play",()=>n.player.play(Ie))),n.playerReady===!1&&(n.playerReady=!0,z(0))}function za(e){ue(n.currentSnackbarId),n.player.setDuration(Math.round(e.target.getDuration())),n.firstStatePlaying&&(n.firstStatePlaying=!1,n.autoplayData=null,setTimeout(()=>{l.playback.autoplay&&k()&&Math.round(window.pageYOffset)<=1&&bt(mt.SITE_MAX_WIDTH_MOBILE)&&w(0)},6e3))}function Ie(e){U.log(`onYouTubePlayerError(): ${e.data} - trackId: ${n.currentTrackId}`),it("Error!"),te.add(u.YOUTUBE,d.PLAYER_ERROR,n.currentTrackId),b("Unable to play track, skipping to next",5,"Stop",Wa,Ga),ie("EVENT_MEDIA_UNAVAILABLE",{mediaUrl:n.player.embedded.getVideoUrl(),mediaTitle:`${n.player.getArtist()} - ${n.player.getTitle()}`})}var ae=m("screen-wakelock"),Le={wakeLock:null};function Ft(){return"wakeLock"in navigator&&"request"in navigator.wakeLock}async function Kt(){Ft()?document.visibilityState==="visible"&&await Wt()!==!0&&ae.log("enable(): Screen Wake Lock request failed"):(ae.log("enable(): Screen Wake Lock is not supported"),b("Keep Screen On is not supported",5,"Disable",()=>l.mobile.keepScreenOn=!1))}function Gt(){ae.log("stateVisible()"),Ft()&&Le.wakeLock===null&&Wt()}async function Wt(){try{return Le.wakeLock=await navigator.wakeLock.request("screen"),ae.log("request(): Screen Wake Lock is Enabled"),Le.wakeLock.addEventListener("release",()=>{ae.log("request(): Screen Wake Lock was Released"),Le.wakeLock=null}),!0}catch(e){ae.error(`request(): ${e.name} - ${e.message}`)}return!1}var jt=m("playback-interaction"),qt=new Te(10),S={player:null,isPlaybackReady:!1},Za={doubleClickDelay:500};document.addEventListener("DOMContentLoaded",()=>{jt.log("DOMContentLoaded"),He(),ut()?S.player=$e:dt()&&(S.player=We),S.player!==null&&er(),Xe(S.player?.getStatus)});function er(){jt.log("initShared()"),tr(),S.player.init(),se.init(),Jt.init(),ar()}function tr(){y(r.READY,or),y(r.MEDIA_SHOW,Ht),y(r.MEDIA_ENDED,Ht),y(r.MEDIA_TIME_REMAINING,nr)}function ar(){W(".playback-shuffle-control span","click",yt),Re("span.navbar-arrow-back","click",re,I.prevPage),Re("span.navbar-arrow-fwd","click",re,I.nextPage),W("nav.track-navigation .nav-previous a","click",re,I.prevPage),W("nav.track-navigation .nav-next a","click",re,I.nextPage),document.addEventListener("keydown",rr),window.addEventListener("blur",lr)}function rr(e){if(S.isPlaybackReady&&Jt.allow()&&e.repeat===!1&&e.ctrlKey===!1&&e.altKey===!1){switch(e.code){case"Backquote":e.preventDefault(),w(S.player.getStatus().trackId);break}switch(e.key){case" ":e.preventDefault(),S.player.togglePlayPause();break;case"Home":case"End":case"PageUp":case"PageDown":gt(e);break;case"ArrowLeft":e.preventDefault(),e.shiftKey===!0?re(null,I.prevPage):S.player.prevTrack();break;case"ArrowRight":e.preventDefault(),e.shiftKey===!0?re(null,I.nextPage):S.player.nextTrack();break;case"A":ve.toggle();break;case"f":case"F":e.preventDefault(),se.toggle(document.getElementById(S.player.getStatus().iframeId));break;case"m":case"M":e.preventDefault(),S.player.toggleMute(),b(l.playback.masterMute?"Volume is muted (<b>m</b> to unmute)":"Volume is unmuted (<b>m</b> to mute)",3);break;case"p":case"P":je.toggle();break;case"r":case"R":b(`${Ze().title} (<b>r</b> to change)`,3);break;case"x":case"X":Je.toggle();break}}}function or(){W(".playback-details-control","click",sr),W(".playback-thumbnail-control","click",ir),W(".playback-timer-control","click",cr),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&l.mobile.keepScreenOn&&Gt()}),l.mobile.keepScreenOn&&Kt(),S.isPlaybackReady=!0}function Ht(){l.playback.autoExitFullscreen&&se.exit()}function nr(e){l.playback.autoExitFsOnWarning&&e.data.timeRemainingSeconds<=l.playback.timeRemainingSeconds&&se.exit()}function lr(){fe()||setTimeout(()=>{document.activeElement instanceof HTMLIFrameElement&&setTimeout(()=>{document.activeElement.blur(),document.activeElement instanceof HTMLIFrameElement&&document.activeElement.blur()},250)},0)}function sr(){w(S.player.getStatus().trackId),fe()&&l.list.showUpNextModal?le("showUpNextModalHint","<b>Tip:</b> Click or tap Artist &amp; Title to show Up Next queue"):le("showTrackDetailsHint","<b>Tip:</b> Click or tap Artist &amp; Title to show current track")}function ir(){pt()?(qt.add(u.MOUSE,d.MOUSE_CLICK,null),le("showGalleryTrackThumbnailHint","<b>Tip:</b> Double click or tap Track Thumbnail for full screen"),qt.doubleClicked(u.MOUSE,d.MOUSE_CLICK,Za.doubleClickDelay)&&se.enter(document.getElementById(S.player.getStatus().iframeId))):fe()&&(w(0),le("showListTrackThumbnailHint","<b>Tip:</b> Click or tap Track Thumbnail to show player"))}function cr(){ve.toggle(),le("showTrackTimerHint","<b>Tip:</b> Click or tap Track Timer to toggle Autoplay On / Off")}function le(e,t,a=0){l.tips[e]&&(b(t,a),l.tips[e]=!1)}function re(e,t){e?.preventDefault(),G(t,S.player.getStatus().isPlaying)}var se=(()=>{let e=new Event("fullscreenElement"),t=null;return{init:a,enter:c,exit:f,toggle:O};function a(){document.addEventListener("fullscreenchange",s),document.addEventListener("webkitfullscreenchange",s)}function s(){t=document.fullscreenElement!==null?document.fullscreenElement.id:null,e.fullscreenTarget=t,document.dispatchEvent(e)}function c(A){A.requestFullscreen()}function f(){t!==null&&(document.exitFullscreen(),t=null)}function O(A){t===null?c(A):f()}})(),Jt=(()=>{let e=!1;return{allow(){return e},init:t};function t(){e=l.playback.keyboardShortcuts,document.addEventListener("allowKeyboardShortcuts",()=>{l.playback.keyboardShortcuts&&(e=!0)}),document.addEventListener("denyKeyboardShortcuts",()=>{l.playback.keyboardShortcuts&&(e=!1)})}})();
//# sourceMappingURL=interaction.js.map
