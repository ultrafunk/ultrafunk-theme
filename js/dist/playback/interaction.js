import{$ as ie,A as L,Aa as Ke,B as Ce,Ba as $e,C as Le,Ca as K,Da as Fe,E as w,Ea as R,Fa as Ge,Ga as _,Ha as We,Ia as qe,J as I,Ja as ue,Ka as Xe,La as P,Ma as $,Na as He,O as oe,Oa as Je,Pa as F,S as ve,W as De,X as s,Y as u,Z as g,_ as b,a as Dt,aa as Ne,ba as Ie,c as f,ca as Ue,d as Ae,da as Oe,ea as B,fa as O,ga as v,ha as Re,ia as X,j as W,ja as H,k as le,ka as _e,la as Ye,ma as x,pa as Me,s as m,sa as J,t as o,ta as j,u as Pe,ua as Ve,va as we,w as A,wa as Be,x as Se,xa as xe,y as q,z as he,za as ce}from"../chunk-UY5MHT5J.js";var G=f("eventlogger"),c={UNKNOWN:-1e4,KEYBOARD:100,MOUSE:110,YOUTUBE:1,SOUNDCLOUD:2,ULTRAFUNK:50},y={UNKNOWN:-1e4,KEY_ARROW_LEFT:180,KEY_ARROW_RIGHT:181,MOUSE_CLICK:182,STATE_ERROR:-5,STATE_UNSTARTED:-1,STATE_ENDED:0,STATE_PLAYING:1,STATE_PAUSED:2,STATE_BUFFERING:3,STATE_CUED:5,RESUME_AUTOPLAY:50,PLAYER_ERROR:60,CROSSFADE_START:70},Nt={eventSource:c.UNKNOWN,eventType:y.UNKNOWN,uId:null,timestamp:0},z=class{#e=[];#r=0;#a=0;#t=0;constructor(t=10){this.#r=t}add(t,a,l=null,p=Date.now()){let d=Object.create(Nt);d.eventSource=t,d.eventType=a,d.uId=l,d.timestamp=p,this.#e.length<this.#r?this.#e.push(d):(this.#e.shift(),this.#e.push(d))}clear(){this.#e=[]}getLastPos(){return this.#t}initMatch(){this.#t=this.#e.length-1,this.#a=0}matchesEvent(t,a,l,p=null){this.#e[this.#t-t].eventSource===a&&this.#e[this.#t-t].eventType===l&&this.#e[this.#t-t].uId===p&&this.#a++}matchesDelta(t,a){this.#e[this.#t].timestamp-this.#e[this.#t-t].timestamp<=a&&this.#a++}isPatternMatch(t,a){return this.#a===t?(G.log(`MATCH for: ${a}`),this.logEventMatch(),!0):!1}logEventMatch(){let t=[];for(let a=0;a<this.#e.length;a++){let l={eventSource:G.getKeyForValue(c,this.#e[a].eventSource),eventType:G.getKeyForValue(y,this.#e[a].eventType),uId:this.#e[a].uId,timestamp:this.#e[a].timestamp};t.push(l)}G.log(t)}},Q=class extends z{doubleClicked(t,a,l){return this.initMatch(),this.getLastPos()>=1&&(this.matchesEvent(1,t,a),this.matchesEvent(0,t,a),this.matchesDelta(1,l)),this.isPatternMatch(3,`${G.getKeyForValue(c,t)} Double Clicked`)}},Z=class extends z{scAutoplayBlocked(t,a){return this.initMatch(),this.getLastPos()>=3&&(this.matchesEvent(3,c.ULTRAFUNK,y.RESUME_AUTOPLAY,null),this.matchesEvent(2,c.SOUNDCLOUD,y.STATE_PLAYING,t),this.matchesEvent(1,c.SOUNDCLOUD,y.STATE_PAUSED,t),this.matchesEvent(0,c.SOUNDCLOUD,y.STATE_PAUSED,t),this.matchesDelta(3,a)),this.isPatternMatch(5,"SoundCloud Autoplay Blocked")}scWidgetPlayBlocked(t,a){return this.initMatch(),this.getLastPos()>=2&&(this.matchesEvent(2,c.SOUNDCLOUD,y.STATE_PLAYING,t),this.matchesEvent(1,c.SOUNDCLOUD,y.STATE_PAUSED,t),this.matchesEvent(0,c.SOUNDCLOUD,y.STATE_PAUSED,t),this.matchesDelta(2,a)),this.isPatternMatch(4,"SoundCloud WidgetPlay Blocked")}scPlayDoubleTrigger(t,a){return this.initMatch(),this.getLastPos()>=2&&(this.matchesEvent(2,c.ULTRAFUNK,y.CROSSFADE_START,null),this.matchesEvent(1,c.SOUNDCLOUD,y.STATE_PLAYING,t),this.matchesEvent(0,c.SOUNDCLOUD,y.STATE_PLAYING,t),this.matchesDelta(1,a)),this.isPatternMatch(4,"SoundCloud Play Double Trigger")}};var Te={};Dt(Te,{getStatus:()=>re,init:()=>ua,nextTrack:()=>fe,pause:()=>ct,play:()=>M,prevTrack:()=>pt,setVolume:()=>da,toggleMute:()=>yt,togglePlayPause:()=>ut});var ye=class extends Ve{#e=null;#r=null;#a(t,a=0){let l=Math.round(t/1e3);B(t,l,a),l>0&&a>0&&(super.updateOncePerSecond(l,a),this.#s(l,a))}#t(){return o.playback.autoplay&&o.gallery.autoCrossfade}#s(t,a){o.playback.masterMute===!1&&this.#t()&&a-t===o.gallery.autoCrossfadeLength+this.config.maxBufferingDelay&&this.#e.getCurrentTrackNum()+1<=this.#e.getNumTracks()&&this.#r(q.AUTO,{name:"Auto Crossfade",length:o.gallery.autoCrossfadeLength,curve:o.gallery.autoCrossfadeCurve})}init(t,a){super.init(),this.#e=t,this.#r=a}updateTimer(){(this.isVisible||this.#t())&&this.#e.current.getPosition((t,a)=>this.#a(t,a))}updateVolumeMute(){this.#e.crossfade.isFading()===!1&&this.#e.current.getVolume(t=>Fe(Math.round(t),this.#e.current.isMuted()))}},h=new ye;var E=f("embedded-players"),D=new Z(10),n={players:{},playbackState:null,embeddedEvent:null,loadEventsTotal:0,loadEventsCount:1},It={maxPlaybackStartDelay:3};function ze(e,t,a){n.players=e,n.playbackState=t,n.embeddedEvent=a,n.loadEventsTotal=3+parseInt(document.body.getAttribute("data-gallery-track-count")),Rt(),Ft()}function ee(){return{loadingPercent:100*(n.loadEventsCount++/n.loadEventsTotal)}}function Qe(){n.loadEventsCount>=n.loadEventsTotal?n.embeddedEvent(s.PLAYBACK_READY,{resetProgressBar:!0}):g(s.PLAYBACK_LOADING,ee())}function Ut(){let e=document.querySelectorAll("single-track, gallery-track");e.forEach(t=>{let a=parseInt(t.getAttribute("data-track-type")),l=t.querySelector("iframe"),p=null;if(a===L.YOUTUBE)e.length===1&&l===null?p=je("youtube-player",t,!0):p=je(l.id,t,!1),p.setDuration(parseInt(t.getAttribute("data-track-duration")));else if(a===L.SOUNDCLOUD){let d=SC.Widget(l.id);p=new Le(t.id,l.id,d),d.bind(SC.Widget.Events.READY,()=>Gt(l.id,t,p,d)),d.bind(SC.Widget.Events.PLAY,()=>Wt(l.id)),d.bind(SC.Widget.Events.PAUSE,()=>qt(l.id)),d.bind(SC.Widget.Events.FINISH,()=>Xt(l.id)),d.bind(SC.Widget.Events.ERROR,()=>Ht(l.id))}p!==null&&(p.setArtistTitle(t.getAttribute("data-track-artist"),t.getAttribute("data-track-title")),n.players.add(p))})}function je(e,t,a=!1){let l=t.getAttribute("data-track-source-uid"),p=new YT.Player(e,{events:{onReady:d=>_t(d,e),onStateChange:d=>Yt(d,e),onError:d=>$t(d,e),onAutoplayBlocked:()=>n.embeddedEvent(s.AUTOPLAY_BLOCKED)},playerVars:{disablekb:1},...a&&{videoId:l}});return new Ce(t.id,e,p,l)}function ge(e,t){E.log("onPlayerError()"),E.log(e);let a=e.getTrackType()===L.YOUTUBE?c.YOUTUBE:c.SOUNDCLOUD;n.players.isCurrent(e.getIframeId())===!1&&n.players.stop(),D.add(a,y.PLAYER_ERROR,e.getIframeId()),n.embeddedEvent(s.MEDIA_UNAVAILABLE,Ot(e,t))}function Ot(e,t){let a=e.getArtist()||"N/A",l=e.getTitle()||"N/A";return{currentTrack:n.players.trackNumFromIframeId(e.getIframeId()),numTracks:n.players.getNumTracks(),trackId:e.getTrackId(),trackType:e.getTrackType(),mediaTitle:`${a} - ${l}`,mediaUrl:t}}function Rt(){E.log("initYouTubeAPI()"),g(s.PLAYBACK_LOADING,ee()),window.onYouTubeIframeAPIReady=function(){E.log("onYouTubeIframeAPIReady()"),g(s.PLAYBACK_LOADING,ee()),Ut()};let e=document.createElement("script");e.id="youtube-iframe-api",e.src="https://www.youtube.com/iframe_api";let t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}function _t(e,t){let a=n.players.playerFromIframeId(t);e.target.getPlayerState()===-1?(E.warn(`onYouTubePlayerReady() - MEDIA_UNAVAILABLE: ${t} => ${a.getSourceUid()} => ${a.getArtist()} - "${a.getTitle()}"`),a.setIsPlayable(!1)):E.log(`onYouTubePlayerReady(): ${t} => ${a.getSourceUid()} => ${a.getArtist()} - ${a.getTitle()}`),Qe()}function Yt(e,t){switch(D.add(c.YOUTUBE,e.data,t),e.data){case YT.PlayerState.UNSTARTED:Mt(t);break;case YT.PlayerState.BUFFERING:Vt(t);break;case YT.PlayerState.PLAYING:wt(t);break;case YT.PlayerState.PAUSED:Bt(t);break;case YT.PlayerState.CUED:xt(t);break;case YT.PlayerState.ENDED:Kt(t);break}}function Mt(e){E.log(`onYouTubePlayerStateChange: UNSTARTED (iframeId: ${e})`)}function Vt(e){if(E.log(`onYouTubePlayerStateChange: BUFFERING (iframeId: ${e})`),n.players.crossfade.isFading()===!1){let t=n.players.playerFromIframeId(e);t.mute(o.playback.masterMute),t.setVolume(o.playback.masterVolume),g(s.MEDIA_LOADING)}}function wt(e){E.log(`onYouTubePlayerStateChange: PLAYING   (iframeId: ${e})`),n.playbackState.sync(e,n.playbackState.STATE.PLAY),h.start()}function Bt(e){E.log(`onYouTubePlayerStateChange: PAUSED    (iframeId: ${e})`),n.players.isCurrent(e)?(n.playbackState.sync(e,n.playbackState.STATE.PAUSE),h.stop()):n.players.crossfade.stop()}function xt(e){E.log(`onYouTubePlayerStateChange: CUED      (iframeId: ${e})`)}function Kt(e){E.log(`onYouTubePlayerStateChange: ENDED     (iframeId: ${e})`),n.players.isCurrent(e)?(h.stop(),n.embeddedEvent(s.MEDIA_ENDED)):n.players.crossfade.stop()}function $t(e,t){let a=n.players.playerFromIframeId(t);E.log(`onYouTubePlayerError(${e.data!==null?e.data:"null"}) - iframeId: ${t} - isCued: ${a.isCued()} - isPlayable: ${a.isPlayable()}`),e.data!==null&&a.isCued()?(a.setIsCued(!1),a.setIsPlayable(!1)):e.data!==null&&a.isPlayable()&&(a.setIsPlayable(!1),ge(a,e.target.getVideoUrl()))}function Ft(){E.log("initSoundCloudAPI()"),g(s.PLAYBACK_LOADING,ee())}function Gt(e,t,a,l){E.log(`onSoundCloudPlayerEventReady(): ${e} => ${a.getArtist()} - ${a.getTitle()}`),a.setThumbnail(t),l.getDuration(p=>{a.setDuration(Math.round(p/1e3)),t.setAttribute("data-track-duration",a.getDuration()),Qe()})}function Wt(e){E.log(`onSoundCloudPlayerEvent: PLAY   (iframeId: ${e})`),D.add(c.SOUNDCLOUD,y.STATE_PLAYING,e),n.players.crossfade.isFading()&&n.players.isCurrent(e)?D.scPlayDoubleTrigger(e,It.maxPlaybackStartDelay*1e3)&&n.playbackState.sync(e,n.playbackState.STATE.PLAY):(n.playbackState.sync(e,n.playbackState.STATE.PLAY),n.players.current.mute(o.playback.masterMute),n.players.current.setVolume(o.playback.masterVolume)),h.start()}function qt(e){E.log(`onSoundCloudPlayerEvent: PAUSE  (iframeId: ${e})`),D.add(c.SOUNDCLOUD,y.STATE_PAUSED,e),D.scAutoplayBlocked(e,3e3)?(h.stop(),n.embeddedEvent(s.AUTOPLAY_BLOCKED)):D.scWidgetPlayBlocked(e,3e4)?(h.stop(),n.embeddedEvent(s.PLAYBACK_BLOCKED,{currentTrack:n.players.trackNumFromIframeId(e),numTracks:n.players.getNumTracks()})):n.players.isCurrent(e)?n.players.current.getPosition(t=>{t>0&&(n.playbackState.sync(e,n.playbackState.STATE.PAUSE),h.stop())}):n.players.crossfade.stop()}function Xt(e){E.log(`onSoundCloudPlayerEvent: FINISH (iframeId: ${e})`),n.players.isCurrent(e)?(h.stop(),n.embeddedEvent(s.MEDIA_ENDED)):n.players.crossfade.stop()}function Ht(e){let t=n.players.playerFromIframeId(e);E.warn(`onSoundCloudPlayerEventError() - MEDIA_UNAVAILABLE: ${t.getIframeId()} => ${t.getArtist()} - "${t.getTitle()}"`),t.setIsPlayable(!1)}var C=f("gallery-events"),te={snackbarId:0,nowPlayingIcons:null},Ee={nowPlayingIconsSelector:"h2.track-artist-title"};function Ze(){C.log("init()"),te.nowPlayingIcons=document.querySelectorAll(Ee.nowPlayingIconsSelector),u(s.MEDIA_PLAYING,jt),u(s.MEDIA_PAUSED,zt),u(s.MEDIA_ENDED,Qt),u(s.MEDIA_CUE_TRACK,Zt),u(s.CONTINUE_AUTOPLAY,ea),u(s.RESUME_AUTOPLAY,ta),u(s.AUTOPLAY_BLOCKED,aa),u(s.PLAYBACK_BLOCKED,ra),u(s.MEDIA_UNAVAILABLE,sa)}function jt(e){if(C.log(e),Se(te.snackbarId),e.data.numTracks>1){let t=document.querySelector(`#${e.data.trackId} ${Ee.nowPlayingIconsSelector}`);et(t),I(t,"playing-paused","now-playing-icon"),o.gallery.animateNowPlayingIcon&&t.classList.add("playing-animate")}}function zt(e){C.log(e),e.data.numTracks>1&&document.querySelector(`#${e.data.trackId} ${Ee.nowPlayingIconsSelector}`).classList.add("playing-paused")}function Qt(e){C.log(e),e!==null&&e.data.numTracks>1&&et()}function Zt(e){C.log(e),e.data.scrollToMedia&&R(e.data.trackId)}function ea(e){C.log(e),$()&&e.data.trackType===L.YOUTUBE?F(P.NEXT,!0):K(m.nextPage,!0)}function ta(e){let t=JSON.parse(sessionStorage.getItem(le.UF_AUTOPLAY));if(sessionStorage.removeItem(le.UF_AUTOPLAY),C.log(e),C.log(`RESUME_AUTOPLAY: ${t!==null?JSON.stringify(t):"NO"}`),t!==null){let a=document.getElementById(t.trackId)?.querySelector("iframe").id??null;a===null&&t.trackId!==null?A({message:"Unable to cue track (not found)",duration:5}):e.callback.resumeAutoplay(t,a)}else e.callback.resumeAutoplay()}function aa(e){C.log(e),te.snackbarId=A({message:"Autoplay blocked, Play to continue",duration:0,actionText:"play",actionClickCallback:()=>e.callback.play()})}function ra(e){C.log(e),A({message:"Unable to play track, skipping to next",duration:5,actionText:"Stop",afterCloseCallback:()=>tt(e)})}function sa(e){C.log(e),A({message:"Unable to play track, skipping to next",duration:5,actionText:"Stop",afterCloseCallback:()=>tt(e)})}function et(e){te.nowPlayingIcons.forEach(t=>{t!==e&&t.classList.remove("now-playing-icon","playing-animate","playing-paused")})}function tt(e){e.data.currentTrack<e.data.numTracks?e.callback.skipToTrack(e.data.currentTrack+1,!0):$()&&e.data.trackType===L.YOUTUBE?F(P.NEXT,o.playback.autoplay):m.nextPage!==null&&K(m.nextPage,!0)}var rt=f("gallery-controls"),ae={uiElements:null,players:{}},S={},U={crossfadePresetSelector:"button.crossfade-preset-toggle",crossfadePresetData:"data-crossfade-preset",crossfadeToSelector:"button.crossfade-fadeto-button"};function st(e,t){rt.log("init()"),ae.players=e,ae.uiElements=new ke("div.track-meta",!0),S.crossfadePreset=ie(U.crossfadePresetSelector),S.crossfadeTo=ie(U.crossfadeToSelector),S.crossfadePreset.length>1&&S.crossfadeTo.length>1&&(S.crossfadePreset.forEach(a=>nt(a,o.gallery.trackCrossfadeDefPreset)),S.crossfadeTo.clickCallback=t),u(s.PLAYBACK_READY,la)}function la(){S.crossfadePreset.length>1&&S.crossfadeTo.length>1&&(S.crossfadePreset.forEach(e=>{e.addEventListener("click",oa),I(e,b.DISABLED.CLASS,b.ENABLED.CLASS)}),S.crossfadeTo.forEach(e=>e.addEventListener("click",ia)),u(s.MEDIA_PLAYING,at),u(s.MEDIA_PAUSED,at))}var ke=class extends x{elementClicked(){if(this.clicked("button.track-share-button"))return J(this.closest("single-track, gallery-track"));if(this.clicked("button.track-details-button"))return j(this.closest("single-track, gallery-track"));if(this.clicked("span.track-artists-links"))return oe(this.event);if(this.clicked("span.track-channels-links"))return oe(this.event)}};function nt(e,t){e.setAttribute(U.crossfadePresetData,t),e.textContent=`${t+1}`,e.title=`Preset: ${W.crossfade[t].name}`}function oa(e){let t=parseInt(e.target.getAttribute(U.crossfadePresetData));nt(e.target,t+1<W.crossfade.length?t+1:0)}function ia(e){if(v()&&ae.players.crossfade.isFading()===!1){let t=e.target.closest("gallery-track");if(t!==null){let a=t.querySelector("iframe"),l=parseInt(t.querySelector(U.crossfadePresetSelector).getAttribute(U.crossfadePresetData));I(t.querySelector(U.crossfadeToSelector),b.ENABLED.CLASS,b.DISABLED.CLASS),S.crossfadeTo.clickCallback(a.id,W.crossfade[l])}}}function at(){let e=v(),t=e?ae.players.getTrackData().currentTrack:-1;rt.log(`updateCrossfadeToState() - playingState: ${e} - currentTrack: ${t}`),S.crossfadeTo.forEach((a,l)=>{t===l+1?I(a,e?b.ENABLED.CLASS:b.DISABLED.CLASS,e?b.DISABLED.CLASS:b.ENABLED.CLASS):I(a,e?b.DISABLED.CLASS:b.ENABLED.CLASS,e?b.ENABLED.CLASS:b.DISABLED.CLASS)})}var lt=f("gallery-players"),ot=()=>{let e=null,t=[],a=new Map,l=0;return{indexMap:a,get crossfade(){return e},get current(){return t[l]},get next(){return t[l+1]},setPlayerIndex(k){l=k},getTrackType(){return this.current.getTrackType()},getNumTracks(){return t.length},getCurrentTrackNum(){return l+1},playerFromIframeId(k){return t[a.get(k)]},trackNumFromIframeId(k){return a.get(k)+1},isCurrent(k){return k===this.current.getIframeId()},init:p,add:d,stop:Pt,mute:St,getTrackData:ht,prevTrack:Ct,nextTrack:Lt,gotoTrackNum:vt};function p(){lt.log("init()"),e=he(this),u(s.MEDIA_PLAYING,()=>e.start()),u(s.MEDIA_PAUSED,()=>e.stop())}function d(k){lt.log(k),t.push(k),a.set(k.getIframeId(),t.length-1)}function Pt(){this.current.stop(),e.stop()}function St(){this.current.mute(o.playback.masterMute),e.mute(o.playback.masterMute)}function ht(k=0){return{currentTrack:this.getCurrentTrackNum(),numTracks:this.getNumTracks(),artist:this.current.getArtist(),title:this.current.getTitle(),position:k,duration:this.current.getDuration(),thumbnail:{src:this.current.getThumbnailSrc(),class:this.current.getThumbnailClass()}}}function Ct(){return l>0?(l--,!0):!1}function Lt(){return l++,l<this.getNumTracks()}function vt(k){return k>0&&k<=this.getNumTracks()?(l=k-1,!0):!1}};var T=f("gallery-playback"),r={eventLog:null,players:{}},it={minCrossfadeToTime:5,maxBufferingDelay:3};function ua(){T.log("init()"),r.eventLog=D,Ze(),r.players=ot(),r.players.init(),Ie(e=>r.players.getTrackData(e),ya),st(r.players,Ta),h.init(r.players,dt),ze(r.players,ba,ma)}function M(){Re(),r.players.current.play(ge)}function ct(){X(),r.players.current.pause()}function ut(){v()?ct():M()}function pt(){T.log(`prevTrack() - prevTrack: ${r.players.getCurrentTrackNum()-1} - numTracks: ${r.players.getNumTracks()}`),r.players.getCurrentTrackNum()>0&&r.players.current.getPosition(e=>{e>5e3?(r.players.current.seekTo(0),B(0,0,r.players.current.getDuration())):(r.players.getCurrentTrackNum()>1&&r.players.stop(),r.players.prevTrack()?Y(v()):g(s.MEDIA_PREV_TRACK))})}function fe(e=!1){let t=r.players.getCurrentTrackNum()+1>r.players.getNumTracks();T.log(`nextTrack() - isMediaEnded: ${e} - isLastTrack: ${t} - autoplay: ${o.playback.autoplay}`),!pa(e,t)&&(t===!1?(r.players.stop(),e&&o.playback.autoplay===!1?X():r.players.nextTrack()&&Y(v())):t===!0&&e===!1?g(s.MEDIA_NEXT_TRACK):e&&(X(),o.playback.autoplay?g(s.CONTINUE_AUTOPLAY,{trackType:r.players.current.getTrackType()}):r.players.stop()))}function pa(e,t){if(e&&o.playback.autoplay){let a=_e();if(T.log(`repeatPlayback(): ${T.getKeyForValue(H,a)}`),a===H.ONE)return r.players.current.seekTo(0),M(),!0;if(t&&a===H.ALL)return r.players.stop(),r.players.setPlayerIndex(0),Y(!0),!0}return!1}function ya(e){r.players.current.seekTo(e)}function da(){r.players.current.setVolume(o.playback.masterVolume)}function yt(){o.playback.masterMute=o.playback.masterMute!==!0,r.players.mute()}function ga(e,t,a=!0){T.log(`cueOrPlayTrackById() - iframeId: ${e} - autoplay: ${t.autoplay} - position: ${t.position}`),r.players.setPlayerIndex(r.players.indexMap.get(e)),g(s.MEDIA_CUE_TRACK,{scrollToMedia:a,trackId:r.players.current.getTrackId()}),t.autoplay?r.players.current.playTrackById(t.position):(r.players.current.cueTrackById(t.position),t.position!==0&&B(t.position*1e3,t.position,r.players.current.getDuration())),O(t.position)}function Y(e,t=!0){g(s.MEDIA_CUE_TRACK,{scrollToMedia:t,trackId:r.players.current.getTrackId()}),e&&M(),O()}function Ea(e,t=!0){T.log(`skipToTrack() - trackNum: ${e} - playMedia: ${t}`),t===!0&&v()===!1&&(r.eventLog.add(c.ULTRAFUNK,y.RESUME_AUTOPLAY),r.players.gotoTrackNum(e)&&Y(t))}function ka(e=null,t=null){e!==null&&t!==null?ga(t,e):e!==null&&e.autoplay?(T.log("resumeAutoplay(): Play first track"),r.eventLog.add(c.ULTRAFUNK,y.RESUME_AUTOPLAY),M()):(T.log("resumeAutoplay(): Cue first track"),O())}function fa(e,t,a=!1){T.log(`cueOrPlaySingleTrackById() - playMedia: ${a}`),r.players.current.setIsCued(!1),r.players.current.setIsPlayable(!0),r.players.current.setSourceUid(t.uid),r.players.current.setArtistTitle(e.track_artist,e.track_title),r.players.current.setDuration(parseInt(e.track_duration)),r.players.current.setThumbnail(t),Oe(0),O(),a?r.players.current.playTrackById():r.players.current.cueTrackById()}function re(e=!1){let t={isPlaying:v(),currentTrack:r.players.getCurrentTrackNum(),trackType:r.players.current.getTrackType(),position:0,numTracks:r.players.getNumTracks(),trackId:r.players.current.getTrackId(),elementId:r.players.current.getTrackId(),iframeId:r.players.current.getIframeId()};return e&&r.players.current.getPosition(a=>(t.position=Math.round(a/1e3),t)),t}function Ta(e,t){r.players.isCurrent(e)===!1&&r.players.current.getDuration()>0&&(T.log(`crossfadeToClick():
      fadeOut: ${r.players.current.getArtist()} - "${r.players.current.getTitle()}" (${r.players.current.getIframeId()})
      fadeIn.: ${r.players.playerFromIframeId(e).getArtist()} - "${r.players.playerFromIframeId(e).getTitle()}" (${e})`),o.playback.masterMute===!1&&o.playback.autoplay===!1&&r.players.current.getPosition(a=>{r.players.current.getDuration()-a/1e3>=it.minCrossfadeToTime+it.maxBufferingDelay&&dt(q.TRACK,t,e)}))}function dt(e,t,a=null){r.eventLog.add(c.ULTRAFUNK,y.CROSSFADE_START),r.players.crossfade.init(e,t,a)&&(a===null?r.players.nextTrack()&&Y(!0):r.players.gotoTrackNum(r.players.trackNumFromIframeId(a))&&Y(!0,!1))}function ma(e,t=null){switch(T.log(`embeddedEventHandler() - event: ${T.getKeyForValue(s,e)}`),t!==null&&T.log(t),e){case s.MEDIA_ENDED:g(s.MEDIA_ENDED,re()),fe(!0);break;case s.PLAYBACK_READY:Ue(pt,ut,fe,yt),Je(fa),g(s.PLAYBACK_READY,t),g(s.RESUME_AUTOPLAY,null,{resumeAutoplay:ka});break;case s.AUTOPLAY_BLOCKED:g(s.AUTOPLAY_BLOCKED,null,{play:M});break;case s.PLAYBACK_BLOCKED:case s.MEDIA_UNAVAILABLE:g(e,t,{skipToTrack:Ea});break}}var ba=(()=>{let e={PLAY:1,PAUSE:2};return{STATE:e,sync:function a(l,p){T.log(`playbackState.sync() - previousTrack: ${r.players.getCurrentTrackNum()} - nextTrack: ${r.players.indexMap.get(l)+1} - syncState: ${T.getKeyForValue(e,p)}`),r.players.isCurrent(l)?p===e.PLAY?g(s.MEDIA_PLAYING,re()):p===e.PAUSE&&g(s.MEDIA_PAUSED,re()):(r.players.stop(),r.players.setPlayerIndex(r.players.indexMap.get(l)),O(),a(l,p))}}})();var ne=f("screen-wakelock"),se={wakeLock:null};function gt(){o.mobile.keepScreenOn&&document.addEventListener("click",Et)}function Et(){ne.log("enableScreenWakeLock()"),document.removeEventListener("click",Et),Pa(),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&o.mobile.keepScreenOn&&Aa()})}function Aa(){kt()&&se.wakeLock===null&&ft()}function kt(){return"wakeLock"in navigator&&"request"in navigator.wakeLock}async function Pa(){kt()?document.visibilityState==="visible"&&await ft()!==!0&&(ne.log("enableWakeLock(): Screen Wake Lock request failed"),A({message:"Keep Screen On failed",duration:5,actionText:"Disable",actionClickCallback:()=>o.mobile.keepScreenOn=!1})):(ne.log("enableWakeLock(): Screen Wake Lock is not supported"),A({message:"Keep Screen On is not supported",duration:5,actionText:"Disable",actionClickCallback:()=>o.mobile.keepScreenOn=!1}))}async function ft(){try{return se.wakeLock=await navigator.wakeLock.request("screen"),se.wakeLock.addEventListener("release",()=>{se.wakeLock=null}),!0}catch(e){ne.error(`requestWakeLock(): ${e.name} - ${e.message}`)}return!1}var V=f("playback-interaction"),Tt=new Q(10),i={player:null,isPlaybackReady:!1,siteNavUiElements:null,trackNavUiElements:null,keyboardShortcuts:null,broadcastChannel:null};document.addEventListener("DOMContentLoaded",()=>{Ae(),V.log("DOMContentLoaded"),Pe(),Be()?i.player=Te:xe()&&(i.player=we),i.player!==null&&(Sa(),o.experimental.enableLocalPlayback&&Me()),Xe(i.player?.getStatus)});function Sa(){V.log("initCommon()"),Ne(),ha(),i.player.init(),i.siteNavUiElements=new me("#site-navigation"),i.trackNavUiElements=new be("nav.single-track-nav .nav-links"),_.init(),i.keyboardShortcuts=ve(o.playback.keyboardShortcuts),i.broadcastChannel=new BroadcastChannel("playbackStatus"),Ca(),gt()}function ha(){u(s.PLAYBACK_READY,Ia),u(s.MEDIA_PLAYING,()=>i.broadcastChannel.postMessage(s.MEDIA_PLAYING)),u(s.MEDIA_CUE_TRACK,bt),u(s.MEDIA_ENDED,bt),u(s.MEDIA_TIME_REMAINING,Ua),u(s.MEDIA_PREV_TRACK,()=>N(null,P.PREV,m.prevPage)),u(s.MEDIA_NEXT_TRACK,()=>N(null,P.NEXT,m.nextPage))}function Ca(){w(".playback-shuffle-button span","click",$e),document.addEventListener("keydown",La),document.addEventListener("keydown",va),window.focus(),window.addEventListener("blur",()=>{setTimeout(()=>{document.activeElement instanceof HTMLIFrameElement&&window.focus()},250)}),i.broadcastChannel.addEventListener("message",e=>{V.log(`broadcastChannel('playbackStatus') message: ${e.data}`),e.data===s.MEDIA_PLAYING&&o.playback.pauseOnPlayerChange&&i.player.pause()})}function La(e){if(i.isPlaybackReady&&i.keyboardShortcuts.allow()&&e.ctrlKey===!1&&e.altKey===!1){switch(e.key){case"+":case"-":mt(e);break;case"ArrowUp":case"ArrowDown":e.shiftKey&&mt(e);break}if(e.repeat===!1){switch(e.code){case"Backquote":e.preventDefault(),R(i.player.getStatus().elementId);break}switch(e.key){case" ":e.preventDefault(),i.player.togglePlayPause();break;case"Home":case"End":case"PageUp":case"PageDown":Ge(e);break;case"ArrowLeft":Da(e);break;case"ArrowRight":Na(e);break;case"A":ue.toggle();break;case"f":case"F":e.preventDefault(),_.toggle(document.getElementById(i.player.getStatus().iframeId));break;case"i":e.preventDefault(),j(document.getElementById(i.player.getStatus().elementId));break;case"I":e.preventDefault(),J(document.getElementById(i.player.getStatus().elementId));break;case"m":case"M":e.preventDefault(),i.player.toggleMute(),A({message:o.playback.masterMute?"<b>Muted</b> (<b>m</b> to Unmute)":"<b>Unmuted</b> (<b>m</b> to Mute)",duration:3});break;case"p":case"P":We.toggle();break;case"r":case"R":A({message:`${Ye().title} (<b>r</b> to change)`,duration:3});break;case"x":case"X":qe.toggle();break}}}}function va(e){if(i.isPlaybackReady&&i.keyboardShortcuts.allow())switch(e.key){case"MediaPlayPause":De===!1&&(V.log("documentEventMediaKeyDown(): MediaPlayPause"),e.preventDefault(),i.player.togglePlayPause());break;case"MediaTrackPrevious":V.log("documentEventMediaKeyDown(): MediaTrackPrevious"),e.preventDefault(),i.player.prevTrack();break;case"MediaTrackNext":V.log("documentEventMediaKeyDown(): MediaTrackNext"),e.preventDefault(),i.player.nextTrack();break}}function Da(e){e.preventDefault(),e.shiftKey===!0?N(null,P.PREV,m.prevPage):i.player.prevTrack()}function Na(e){e.preventDefault(),e.shiftKey===!0?N(null,P.NEXT,m.nextPage):i.player.nextTrack()}function N(e,t,a){e?.preventDefault(),$()&&i.player.getStatus().trackType===L.YOUTUBE?He()===!1?F(t,i.player.getStatus().isPlaying):A({message:"Loading track, please wait...",duration:3}):At(null,a)}function mt(e){e.preventDefault(),o.playback.masterVolume=e.key==="+"||e.key==="ArrowUp"?o.playback.masterVolume<100?o.playback.masterVolume+5:100:o.playback.masterVolume>5?o.playback.masterVolume-5:5,i.player.setVolume()}function Ia(){w(".playback-thumbnail-control","click",Ra),w(".playback-details-control","click",Oa),w(".playback-timer-control","click",_a),i.isPlaybackReady=!0}function bt(){let e=ce()&&i.player.getStatus().numTracks>1;(o.playback.autoExitFullscreen||e)&&_.exit()}function Ua(e){let t=e.data.timeRemainingSeconds<=o.playback.timeRemainingSeconds;o.playback.autoExitFsOnWarning&&t&&_.exit()}function Oa(){R(i.player.getStatus().elementId)}function Ra(){ce()?(Tt.add(c.MOUSE,y.MOUSE_CLICK),Tt.doubleClicked(c.MOUSE,y.MOUSE_CLICK,500)&&_.enter(document.getElementById(i.player.getStatus().iframeId))):Ke()&&R(0)}function _a(){ue.toggle()}var me=class extends x{elementClicked(){if(this.clicked("a.navbar-prev-link"))return N(this.event,P.PREV,m.prevPage);if(this.clicked("a.navbar-next-link"))return N(this.event,P.NEXT,m.nextPage)}},be=class extends x{elementClicked(){if(this.clicked("div.nav-previous a"))return N(this.event,P.PREV,m.prevPage);if(this.clicked("div.nav-next a"))return N(this.event,P.NEXT,m.nextPage)}};function At(e,t){e?.preventDefault(),K(t,i.player.getStatus().isPlaying)}
//# sourceMappingURL=interaction.js.map
