import{$ as E,Aa as Ge,B as Le,Ba as We,Ca as qe,D as S,Da as Xe,E as Ie,Fa as ie,Ga as ce,H as I,Ha as He,Ia as _,Ja as Je,Ka as ue,La as ze,M as C,Ma as N,Na as Qe,Oa as D,Pa as Ze,Qa as je,Ra as de,S as ve,Sa as et,T as Ne,Ta as A,U as De,Ua as B,Va as tt,Wa as at,X as Ue,Xa as $,Y as s,Z as c,_ as p,a as It,aa as ne,ba as Me,c as g,ca as Re,d as Se,da as we,ea as Ye,fa as O,ga as v,ha as k,ia as Oe,j as F,ja as G,k as oe,ka as W,la as Ve,ma as xe,na as V,s as P,sa as q,t as o,ta as x,u as Ae,ua as _e,va as Be,w as T,wa as $e,x as le,xa as X,y as he,ya as Ke,z as Ce,za as Fe}from"../chunk-5JMNSASV.js";var Te={};It(Te,{getStatus:()=>ae,init:()=>la,nextTrack:()=>Ee,onAutoplayBlocked:()=>Z,onEmbeddedPlayersReady:()=>ke,onMediaEnded:()=>Q,onMediaUnavailable:()=>fe,pause:()=>kt,play:()=>M,prevTrack:()=>gt,setVolume:()=>ca,toggleMute:()=>mt,togglePlayPause:()=>ft});var pe=class extends _e{#e=null;#t=null;#r(t,a=0){let i=Math.round(t/1e3);O(t,i,a),i>0&&a>0&&(super.updateOncePerSecond(i,a),this.#s(i,a))}#a(){return o.playback.autoplay&&o.gallery.autoCrossfade}#s(t,a){o.playback.masterMute===!1&&this.#a()&&a-t===o.gallery.autoCrossfadeLength+this.config.maxBufferingDelay&&this.#e.getCurrentTrackNum()+1<=this.#e.getNumTracks()&&this.#t(X.AUTO,{name:"Auto Crossfade",length:o.gallery.autoCrossfadeLength,curve:o.gallery.autoCrossfadeCurve})}init(t,a){super.init(),this.#e=t,this.#t=a}updateTimer(){(this.isVisible||this.#a())&&this.#e.current.getPosition((t,a)=>this.#r(t,a))}updateVolumeMute(){k()&&this.#e.crossfade.isFading()===!1&&this.#e.current.getVolume(t=>Je(Math.round(t),this.#e.current.isMuted()))}},rt=new pe;var d=g("embedded-players"),f=new Fe(10),l={players:{},playbackState:null,loadEventsTotal:0,loadEventsCount:1},vt={maxPlaybackStartDelay:3};function ot(e,t){d.log("init()"),l.players=e,l.playbackState=t,l.loadEventsTotal=3+parseInt(document.body.getAttribute("data-gallery-track-count")),Ut(),$t()}function H(){return{loadingPercent:100*(l.loadEventsCount++/l.loadEventsTotal)}}function lt(){l.loadEventsCount>=l.loadEventsTotal?ke():p(s.PLAYBACK_LOADING,H())}function Nt(){let e=document.querySelectorAll("single-track, gallery-track");e.forEach(t=>{let a=Le(t),i=t.querySelector("iframe"),u=null;if(a===T.YOUTUBE)e.length===1&&i===null?u=st("youtube-player",t,!0):u=st(i.id,t,!1),u.setDuration(parseInt(t.getAttribute("data-track-duration")));else if(a===T.SOUNDCLOUD){let m=SC.Widget(i.id);u=new z(t.id,i.id,m),m.bind(SC.Widget.Events.READY,()=>Kt(i.id,t,u,m)),m.bind(SC.Widget.Events.PLAY,()=>Ft(i.id)),m.bind(SC.Widget.Events.PAUSE,()=>Gt(i.id)),m.bind(SC.Widget.Events.FINISH,()=>Wt(i.id)),m.bind(SC.Widget.Events.ERROR,()=>qt(i.id))}u!==null&&(u.setArtistAndTitle(t.getAttribute("data-track-artist"),t.getAttribute("data-track-title")),l.players.add(u))})}function st(e,t,a=!1){let i=t.getAttribute("data-track-source-uid"),u=new YT.Player(e,{events:{onReady:m=>Mt(m,e),onStateChange:m=>Rt(m,e),onError:m=>Bt(m,e),onAutoplayBlocked:()=>Z()},playerVars:{disablekb:1},...a&&{videoId:i}});return new J(t.id,e,u,i)}function K(e,t){d.log("onPlayerError()"),d.log(e);let a=e.getTrackType()===T.YOUTUBE?f.SOURCE.YOUTUBE:f.SOURCE.SOUNDCLOUD;l.players.isCurrent(e.getIframeId())===!1&&l.players.stop(),f.add(a,f.EVENT.PLAYER_ERROR,e.getIframeId()),fe(Dt(e,t))}function Dt(e,t){let a=e.getArtist()||"N/A",i=e.getTitle()||"N/A";return{currentTrack:l.players.trackNumFromIframeId(e.getIframeId()),numTracks:l.players.getNumTracks(),trackId:e.getTrackId(),trackType:e.getTrackType(),mediaTitle:`${a} - ${i}`,mediaUrl:t}}function Ut(){d.log("initYouTubeAPI()"),p(s.PLAYBACK_LOADING,H()),window.onYouTubeIframeAPIReady=()=>{d.log("onYouTubeIframeAPIReady()"),p(s.PLAYBACK_LOADING,H()),Nt()};let e=document.createElement("script");e.id="youtube-iframe-api",e.src="https://www.youtube.com/iframe_api";let t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}function Mt(e,t){let a=l.players.playerFromIframeId(t);e.target.getPlayerState()===-1?(d.warn(`onYouTubePlayerReady() - MEDIA_UNAVAILABLE: ${t} => ${a.getSourceUid()} => ${a.getArtist()} - "${a.getTitle()}"`),a.setIsPlayable(!1)):d.log(`onYouTubePlayerReady(): ${t} => ${a.getSourceUid()} => ${a.getArtist()} - ${a.getTitle()}`),lt()}function Rt(e,t){switch(f.add(f.SOURCE.YOUTUBE,e.data,t),e.data){case YT.PlayerState.UNSTARTED:wt(t);break;case YT.PlayerState.BUFFERING:Yt(t);break;case YT.PlayerState.PLAYING:Ot(t);break;case YT.PlayerState.PAUSED:Vt(t);break;case YT.PlayerState.CUED:xt(t);break;case YT.PlayerState.ENDED:_t(t);break}}function wt(e){d.log(`onYouTubePlayerStateChange: UNSTARTED (iframeId: ${e})`)}function Yt(e){if(d.log(`onYouTubePlayerStateChange: BUFFERING (iframeId: ${e})`),l.players.crossfade.isFading()===!1){let t=l.players.playerFromIframeId(e);t.mute(o.playback.masterMute),t.setVolume(o.playback.masterVolume),p(s.MEDIA_LOADING)}}function Ot(e){d.log(`onYouTubePlayerStateChange: PLAYING   (iframeId: ${e})`),l.playbackState.sync(e,l.playbackState.STATE.PLAY)}function Vt(e){d.log(`onYouTubePlayerStateChange: PAUSED    (iframeId: ${e})`),l.players.isCurrent(e)?l.playbackState.sync(e,l.playbackState.STATE.PAUSE):l.players.crossfade.stop()}function xt(e){d.log(`onYouTubePlayerStateChange: CUED      (iframeId: ${e})`)}function _t(e){d.log(`onYouTubePlayerStateChange: ENDED     (iframeId: ${e})`),l.players.isCurrent(e)?Q():l.players.crossfade.stop()}function Bt(e,t){let a=l.players.playerFromIframeId(t);d.log(`onYouTubePlayerError(${e.data!==null?e.data:"null"}) - iframeId: ${t} - isCued: ${a.isCued()} - isPlayable: ${a.isPlayable()}`),e.data!==null&&a.isCued()?(a.setIsCued(!1),a.setIsPlayable(!1)):e.data!==null&&a.isPlayable()&&(a.setIsPlayable(!1),K(a,e.target.getVideoUrl()))}function $t(){d.log("initSoundCloudAPI()"),p(s.PLAYBACK_LOADING,H())}function Kt(e,t,a,i){d.log(`onSoundCloudPlayerEventReady(): ${e} => ${a.getArtist()} - ${a.getTitle()}`),a.setThumbnail(t),i.getDuration(u=>{a.setDuration(Math.round(u/1e3)),t.setAttribute("data-track-duration",a.getDuration()),lt()})}function Ft(e){d.log(`onSoundCloudPlayerEvent: PLAY   (iframeId: ${e})`),f.add(f.SOURCE.SOUNDCLOUD,f.EVENT.STATE_PLAYING,e),l.players.crossfade.isFading()&&l.players.isCurrent(e)?f.scPlayDoubleTrigger(e,vt.maxPlaybackStartDelay*1e3)&&l.playbackState.sync(e,l.playbackState.STATE.PLAY):(l.playbackState.sync(e,l.playbackState.STATE.PLAY),l.players.current.mute(o.playback.masterMute),l.players.current.setVolume(o.playback.masterVolume))}function Gt(e){d.log(`onSoundCloudPlayerEvent: PAUSE  (iframeId: ${e})`),f.add(f.SOURCE.SOUNDCLOUD,f.EVENT.STATE_PAUSED,e),f.scAutoplayBlocked(e,3e3)?Z():l.players.isCurrent(e)?l.players.current.getPosition(t=>{t>0&&l.playbackState.sync(e,l.playbackState.STATE.PAUSE)}):l.players.crossfade.stop()}function Wt(e){d.log(`onSoundCloudPlayerEvent: FINISH (iframeId: ${e})`),l.players.isCurrent(e)?Q():l.players.crossfade.stop()}function qt(e){let t=l.players.playerFromIframeId(e);d.warn(`onSoundCloudPlayerEventError() - MEDIA_UNAVAILABLE: ${t.getIframeId()} => ${t.getArtist()} - "${t.getTitle()}"`),t.setIsPlayable(!1)}var Xt=g("gallery-players"),J=class extends le{constructor(t,a,i,u){super(T.YOUTUBE,t,a,i),this.setThumbnail(he(u)),this.setSourceUid(u)}pause(){this.embedded.pauseVideo()}stop(){this.embedded.stopVideo()}cueTrackById(t=0){this.embedded.cueVideoById(this.getSourceUid(),t),this.setIsCued(!0)}playTrackById(t=0){this.embedded.loadVideoById(this.getSourceUid(),t)}play(){this.isPlayable()?this.embedded.playVideo():K(this,this.embedded.getVideoUrl())}getVolume(t){t(this.embedded.getVolume())}mute(t){t?this.embedded.mute():this.embedded.unMute()}isMuted(){return this.embedded.isMuted()}getPosition(t){t(this.embedded.getCurrentTime()*1e3,this.duration)}},z=class extends le{#e=$e.MAX;#t=!1;constructor(t,a,i){super(T.SOUNDCLOUD,t,a,i)}setThumbnail(t){this.embedded.getCurrentSound(a=>{super.setThumbnail(Ce(a)),t?.setAttribute("data-track-thumbnail-url",this.getThumbnailSrc())})}cueTrackById(t=0){this.seekTo(t),this.setIsCued(!0)}playTrackById(t=0){this.seekTo(t),this.play(),this.setIsCued(!1)}pause(){this.embedded.pause()}play(){this.isPlayable()?this.embedded.getCurrentSound(t=>{t.playable===!0?this.embedded.play():K(this,t.permalink_url)}):K(this,"https://soundcloud.com")}stop(){this.pause(),super.seekTo(0)}seekTo(t){super.seekTo(t*1e3)}getVolume(t){this.#t===!1&&this.embedded.getVolume(a=>t(a))}setVolume(t){t!==0&&(this.#e=t),(this.#t===!1||t===0)&&super.setVolume(t)}mute(t){this.#t=!!t,t?this.setVolume(0):this.setVolume(this.#e)}isMuted(){return this.#t}getPosition(t){this.embedded.getPosition(a=>t(a,this.duration))}},j=class{indexMap=new Map;crossfade=null;#e=[];#t=0;constructor(){this.crossfade=Ke(this),c(s.MEDIA_PLAYING,()=>this.crossfade.start()),c(s.MEDIA_PAUSED,()=>this.crossfade.stop())}get current(){return this.#e[this.#t]}get next(){return this.#e[this.#t+1]}setPlayerIndex(t){this.#t=t}getTrackType(){return this.current.getTrackType()}getNumTracks(){return this.#e.length}getCurrentTrackNum(){return this.#t+1}playerFromIframeId(t){return this.#e[this.indexMap.get(t)]}trackNumFromIframeId(t){return this.indexMap.get(t)+1}isCurrent(t){return t===this.current.getIframeId()}add(t){Xt.log(t),this.#e.push(t),this.indexMap.set(t.getIframeId(),this.#e.length-1)}stop(){this.current.stop(),this.crossfade.stop()}mute(){this.current.mute(o.playback.masterMute),this.crossfade.mute(o.playback.masterMute)}getTrackData(t=0){return{currentTrack:this.getCurrentTrackNum(),numTracks:this.getNumTracks(),artist:this.current.getArtist(),title:this.current.getTitle(),position:t,duration:this.current.getDuration(),thumbnail:{src:this.current.getThumbnailSrc(),class:this.current.getThumbnailClass()}}}prevTrack(){return this.#t>0?(this.#t--,!0):!1}nextTrack(){return this.#t++,this.#t<this.getNumTracks()}gotoTrackNum(t){return t>0&&t<=this.getNumTracks()?(this.#t=t-1,!0):!1}};var h=g("gallery-events"),ee={snackbarId:0,nowPlayingIcons:null},ge={nowPlayingIconsSelector:"h2.track-artist-title"};function nt(){h.log("init()"),ee.nowPlayingIcons=document.querySelectorAll(ge.nowPlayingIconsSelector),c(s.MEDIA_PLAYING,Ht),c(s.MEDIA_PAUSED,Jt),c(s.MEDIA_ENDED,zt),c(s.MEDIA_CUE_TRACK,Qt),c(s.CONTINUE_AUTOPLAY,Zt),c(s.RESUME_AUTOPLAY,jt),c(s.AUTOPLAY_BLOCKED,ea),c(s.MEDIA_UNAVAILABLE,ta)}function Ht(e){if(h.log(e),Ie(ee.snackbarId),e.data.numTracks>1){let t=document.querySelector(`#${e.data.trackId} ${ge.nowPlayingIconsSelector}`);it(t),C(t,"playing-paused","now-playing-icon"),o.gallery.animateNowPlayingIcon&&t.classList.add("playing-animate")}}function Jt(e){h.log(e),e.data.numTracks>1&&document.querySelector(`#${e.data.trackId} ${ge.nowPlayingIconsSelector}`).classList.add("playing-paused")}function zt(e){h.log(e),e!==null&&e.data.numTracks>1&&it()}function Qt(e){h.log(e),e.data.scrollToMedia&&N(e.data.trackId)}function Zt(e){h.log(e),B()&&e.data.trackType===T.YOUTUBE?$(A.NEXT,!0):_(P.nextPage,!0)}function jt(e){let t=JSON.parse(sessionStorage.getItem(oe.UF_AUTOPLAY));if(sessionStorage.removeItem(oe.UF_AUTOPLAY),h.log(e),h.log(`RESUME_AUTOPLAY: ${t!==null?JSON.stringify(t):"NO"}`),t!==null){let a=document.getElementById(t.trackId)?.querySelector("iframe").id??null;a===null&&t.trackId!==null?S({message:"Unable to cue track (not found)",duration:5}):e.callback.resumeAutoplay(t,a)}else e.callback.resumeAutoplay()}function ea(e){h.log(e),ee.snackbarId=S({message:"Autoplay blocked, Play to continue",duration:0,actionText:"play",actionClickCallback:()=>e.callback.play()})}function ta(e){h.log(e),S({message:"Error playing track, skipping to next",duration:4,actionText:"Stop",afterCloseCallback:()=>aa(e)})}function it(e){ee.nowPlayingIcons.forEach(t=>{t!==e&&t.classList.remove("now-playing-icon","playing-animate","playing-paused")})}function aa(e){e.data.currentTrack<e.data.numTracks?e.callback.skipToTrack(e.data.currentTrack+1,!0):B()&&e.data.trackType===T.YOUTUBE?$(A.NEXT,o.playback.autoplay):P.nextPage!==null&&_(P.nextPage,!0)}var ut=g("gallery-controls"),te={uiElements:null,players:{}},b={},L={crossfadePresetSelector:"button.crossfade-preset-toggle",crossfadePresetData:"data-crossfade-preset",crossfadeToSelector:"button.crossfade-fadeto-button"};function dt(e,t){ut.log("init()"),te.players=e,te.uiElements=new me("div.track-meta",!0),b.crossfadePreset=ne(L.crossfadePresetSelector),b.crossfadeTo=ne(L.crossfadeToSelector),b.crossfadePreset.length>1&&b.crossfadeTo.length>1&&(b.crossfadePreset.forEach(a=>pt(a,o.gallery.trackCrossfadeDefPreset)),b.crossfadeTo.clickCallback=t),c(s.PLAYBACK_READY,ra)}function ra(){b.crossfadePreset.length>1&&b.crossfadeTo.length>1&&(b.crossfadePreset.forEach(e=>{e.addEventListener("click",sa),C(e,E.DISABLED.CLASS,E.ENABLED.CLASS)}),b.crossfadeTo.forEach(e=>e.addEventListener("click",oa)),c(s.MEDIA_PLAYING,ct),c(s.MEDIA_PAUSED,ct))}var me=class extends V{elementClicked(t){switch(t){case"track-share-play":q(this.closest("single-track, gallery-track"));break;case"track-details":x(this.closest("single-track, gallery-track"));break;case"track-artist-link":case"track-channel-link":ve(this.event);break}}};function pt(e,t){e.setAttribute(L.crossfadePresetData,t),e.textContent=`${t+1}`,e.title=`Preset: ${F.crossfade[t].name}`}function sa(e){let t=parseInt(e.target.getAttribute(L.crossfadePresetData));pt(e.target,t+1<F.crossfade.length?t+1:0)}function oa(e){if(k()&&te.players.crossfade.isFading()===!1){let t=e.target.closest("gallery-track");if(t!==null){let a=t.querySelector("iframe"),i=parseInt(t.querySelector(L.crossfadePresetSelector).getAttribute(L.crossfadePresetData));C(t.querySelector(L.crossfadeToSelector),E.ENABLED.CLASS,E.DISABLED.CLASS),b.crossfadeTo.clickCallback(a.id,F.crossfade[i])}}}function ct(){let e=k()?te.players.getTrackData().currentTrack:-1;ut.log(`updateCrossfadeToState() - playingState: ${k()} - currentTrack: ${e}`),b.crossfadeTo.forEach((t,a)=>{e===a+1?C(t,k()?E.ENABLED.CLASS:E.DISABLED.CLASS,k()?E.DISABLED.CLASS:E.ENABLED.CLASS):C(t,k()?E.DISABLED.CLASS:E.ENABLED.CLASS,k()?E.ENABLED.CLASS:E.DISABLED.CLASS)})}var y=g("gallery-playback"),r={eventLog:null,players:{}},yt={minCrossfadeToTime:5,maxBufferingDelay:3};function la(){y.log("init()"),r.eventLog=f,nt(),r.players=new j,Re(e=>r.players.getTrackData(e),ia),dt(r.players,ka),rt.init(r.players,Et),ot(r.players,fa)}function M(){Oe(),r.players.current.play()}function kt(){G(),r.players.current.pause()}function ft(){k()?kt():M()}function gt(){y.log(`prevTrack() - prevTrack: ${r.players.getCurrentTrackNum()-1} - numTracks: ${r.players.getNumTracks()}`),r.players.getCurrentTrackNum()>0&&r.players.current.getPosition(e=>{e>5e3?(r.players.current.seekTo(0),O(0,0,r.players.current.getDuration())):(r.players.getCurrentTrackNum()>1&&r.players.stop(),r.players.prevTrack()?U(k()):p(s.MEDIA_PREV_TRACK))})}function Ee(e=!1){let t=r.players.getCurrentTrackNum()+1>r.players.getNumTracks();y.log(`nextTrack() - isMediaEnded: ${e} - isLastTrack: ${t} - autoplay: ${o.playback.autoplay}`),!na(e,t)&&(t===!1?(r.players.stop(),e&&o.playback.autoplay===!1?G():r.players.nextTrack()&&U(k())):t===!0&&e===!1?p(s.MEDIA_NEXT_TRACK):e&&(G(),o.playback.autoplay?p(s.CONTINUE_AUTOPLAY,{trackType:r.players.current.getTrackType()}):r.players.stop()))}function na(e,t){if(e&&o.playback.autoplay){let a=Ve();if(y.log(`repeatPlayback(): ${y.getKeyForValue(W,a)}`),a===W.ONE)return r.players.current.seekTo(0),M(),!0;if(t&&a===W.ALL)return r.players.stop(),r.players.setPlayerIndex(0),U(!0),!0}return!1}function ia(e){r.players.current.seekTo(e)}function ca(){r.players.current.setVolume(o.playback.masterVolume)}function mt(){o.playback.masterMute=o.playback.masterMute!==!0,r.players.mute()}function ua(e,t,a=!0){y.log(`cueOrPlayTrackById() - iframeId: ${e} - autoplay: ${t.autoplay} - position: ${t.position}`),r.players.setPlayerIndex(r.players.indexMap.get(e)),p(s.MEDIA_CUE_TRACK,{scrollToMedia:a,trackId:r.players.current.getTrackId()}),t.autoplay?r.players.current.playTrackById(t.position):(r.players.current.cueTrackById(t.position),t.position!==0&&O(t.position*1e3,t.position,r.players.current.getDuration())),v(t.position)}function U(e,t=!0){p(s.MEDIA_CUE_TRACK,{scrollToMedia:t,trackId:r.players.current.getTrackId()}),e&&M(),v()}function da(e,t=!0){y.log(`skipToTrack() - trackNum: ${e} - playMedia: ${t}`),t===!0&&k()===!1&&(r.eventLog.add(r.eventLog.SOURCE.ULTRAFUNK,r.eventLog.EVENT.RESUME_AUTOPLAY),r.players.gotoTrackNum(e)&&U(t))}function pa(e=null,t=null){e!==null&&t!==null?(e.autoplay&&r.eventLog.add(r.eventLog.SOURCE.ULTRAFUNK,r.eventLog.EVENT.RESUME_AUTOPLAY),ua(t,e)):e!==null&&e.autoplay?(y.log("resumeAutoplay(): Play first track"),r.eventLog.add(r.eventLog.SOURCE.ULTRAFUNK,r.eventLog.EVENT.RESUME_AUTOPLAY),M()):(y.log("resumeAutoplay(): Cue first track"),v())}function ya(e,t,a=!1){y.log(`cueOrPlaySingleTrackById() - playMedia: ${a}`),r.players.current.setIsCued(!1),r.players.current.setIsPlayable(!0),r.players.current.setSourceUid(t.uid),r.players.current.setArtistAndTitle(e.track_artist,e.track_title),r.players.current.setDuration(parseInt(e.track_duration)),r.players.current.setThumbnail(t),Ye(0),v(),a?r.players.current.playTrackById():r.players.current.cueTrackById()}function ae(e=!1){let t={isPlaying:k(),currentTrack:r.players.getCurrentTrackNum(),trackType:r.players.current.getTrackType(),position:0,numTracks:r.players.getNumTracks(),trackId:r.players.current.getTrackId(),trackElementId:r.players.current.getTrackId(),playerId:r.players.current.getIframeId()};return e?new Promise(a=>{r.players.current.getPosition(i=>{t.position=Math.round(i/1e3),a(t)})}):t}function ka(e,t){r.players.isCurrent(e)===!1&&r.players.current.getDuration()>0&&(y.log(`crossfadeToClick():
      fadeOut: ${r.players.current.getArtist()} - "${r.players.current.getTitle()}" (${r.players.current.getIframeId()})
      fadeIn.: ${r.players.playerFromIframeId(e).getArtist()} - "${r.players.playerFromIframeId(e).getTitle()}" (${e})`),o.playback.masterMute===!1&&o.playback.autoplay===!1&&r.players.current.getPosition(a=>{r.players.current.getDuration()-a/1e3>=yt.minCrossfadeToTime+yt.maxBufferingDelay&&Et(X.TRACK,t,e)}))}function Et(e,t,a=null){r.eventLog.add(r.eventLog.SOURCE.ULTRAFUNK,r.eventLog.EVENT.CROSSFADE_START),r.players.crossfade.init(e,t,a)&&(a===null?r.players.nextTrack()&&U(!0):r.players.gotoTrackNum(r.players.trackNumFromIframeId(a))&&U(!0,!1))}function ke(){y.log("onEmbeddedPlayersReady()"),we(gt,ft,Ee,mt),at(ya),p(s.PLAYBACK_READY,{resetProgressBar:!0}),p(s.RESUME_AUTOPLAY,null,{resumeAutoplay:pa})}function Q(){y.log("onMediaEnded()"),p(s.MEDIA_ENDED,ae()),Ee(!0)}function Z(){y.log("onAutoplayBlocked()"),p(s.AUTOPLAY_BLOCKED,null,{play:M})}function fe(e){y.log("onMediaUnavailable()"),y.log(e),p(s.MEDIA_UNAVAILABLE,e,{skipToTrack:da})}var fa=(()=>{let e={PLAY:1,PAUSE:2};return{STATE:e,sync:function a(i,u){y.log(`playbackState.sync() - previousTrack: ${r.players.getCurrentTrackNum()} - nextTrack: ${r.players.indexMap.get(i)+1} - syncState: ${y.getKeyForValue(e,u)}`),r.players.isCurrent(i)?u===e.PLAY?p(s.MEDIA_PLAYING,ae()):u===e.PAUSE&&p(s.MEDIA_PAUSED,ae()):(r.players.stop(),r.players.setPlayerIndex(r.players.indexMap.get(i)),v(),a(i,u))}}})();var se=g("screen-wakelock"),re={wakeLock:null};function Tt(){o.mobile.keepScreenOn&&document.addEventListener("click",bt)}function bt(){se.log("enableScreenWakeLock()"),document.removeEventListener("click",bt),ma(),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&o.mobile.keepScreenOn&&ga()})}function ga(){Pt()&&re.wakeLock===null&&St()}function Pt(){return"wakeLock"in navigator&&"request"in navigator.wakeLock}async function ma(){Pt()?document.visibilityState==="visible"&&await St()!==!0&&(se.log("enableWakeLock(): Screen Wake Lock request failed"),S({message:"Keep Screen On failed",duration:5,actionText:"Disable",actionClickCallback:()=>o.mobile.keepScreenOn=!1})):(se.log("enableWakeLock(): Screen Wake Lock is not supported"),S({message:"Keep Screen On is not supported",duration:5,actionText:"Disable",actionClickCallback:()=>o.mobile.keepScreenOn=!1}))}async function St(){try{return re.wakeLock=await navigator.wakeLock.request("screen"),re.wakeLock.addEventListener("release",()=>{re.wakeLock=null}),!0}catch(e){se.error(`requestWakeLock(): ${e.name} - ${e.message}`)}return!1}var w=g("playback-interaction"),R=new Ge(10),n={player:null,isPlaybackReady:!1,siteNavUiElements:null,trackNavUiElements:null,keyboardShortcuts:null,broadcastChannel:null};document.addEventListener("DOMContentLoaded",()=>{Se(),w.log("DOMContentLoaded"),Ae(),qe()?n.player=Te:Xe()&&(n.player=We),n.player!==null&&Ea(),et(n.player)});function Ea(){w.log("init()"),Me(),Ta(),n.player.init(),n.siteNavUiElements=new be("#site-navigation"),n.trackNavUiElements=new Pe("nav.single-track-nav .nav-links"),D.init(),n.keyboardShortcuts=De(o.playback.keyboardShortcuts),n.broadcastChannel=new BroadcastChannel("playbackStatus"),ba(),Tt()}function Ta(){c(s.PLAYBACK_READY,Ca),c(s.MEDIA_PLAYING,()=>n.broadcastChannel.postMessage(s.MEDIA_PLAYING)),c(s.MEDIA_CUE_TRACK,At),c(s.MEDIA_ENDED,At),c(s.MEDIA_TIME_REMAINING,La),c(s.MEDIA_PREV_TRACK,()=>Y(null,A.PREV,P.prevPage)),c(s.MEDIA_NEXT_TRACK,()=>Y(null,A.NEXT,P.nextPage))}function ba(){I(".playback-shuffle-button span","click",He),document.addEventListener("keydown",Pa),document.addEventListener("keydown",Sa),window.focus(),window.addEventListener("blur",()=>{setTimeout(()=>{document.activeElement instanceof HTMLIFrameElement&&window.focus()},250)}),n.broadcastChannel.addEventListener("message",e=>{w.log(`broadcastChannel('playbackStatus') message: ${e.data}`),e.data===s.MEDIA_PLAYING&&o.playback.pauseOnPlayerChange&&n.player.pause()}),ce()&&o.list.showLoadMoreTracks&&o.list.warnOnPageChange&&window.addEventListener("beforeunload",e=>{(n.player.getStatus().isPlaying||Be())&&(e.preventDefault(),e.returnValue=!0)})}function Pa(e){if(n.isPlaybackReady&&n.keyboardShortcuts.allow()&&e.ctrlKey===!1&&e.altKey===!1){switch(e.key){case"+":case"-":ue(e,n.player);break;case"ArrowUp":case"ArrowDown":e.shiftKey&&ue(e,n.player);break}if(e.repeat===!1){switch(e.code){case"Backquote":e.preventDefault(),N(n.player.getStatus().trackElementId);break}switch(e.key){case" ":e.preventDefault(),n.player.togglePlayPause();break;case"Home":case"End":case"PageUp":case"PageDown":Qe(e);break;case"ArrowLeft":Aa(e);break;case"ArrowRight":ha(e);break;case"A":de.toggle();break;case"f":case"F":e.preventDefault(),D.toggle(document.getElementById(n.player.getStatus().playerId));break;case"i":e.preventDefault(),x(document.getElementById(n.player.getStatus().trackElementId));break;case"I":e.preventDefault(),q(document.getElementById(n.player.getStatus().trackElementId));break;case"m":case"M":e.preventDefault(),n.player.toggleMute(),S({message:o.playback.masterMute?"<b>Muted</b> (<b>m</b> to Unmute)":"<b>Unmuted</b> (<b>m</b> to Mute)",duration:3});break;case"O":document.getElementById("select-local-files")?.click();break;case"p":case"P":Ze.toggle();break;case"r":case"R":S({message:`${xe().title} (<b>r</b> to change)`,duration:3});break;case"V":ze(n.player);break;case"x":case"X":je.toggle();break}}}}function Sa(e){if(n.isPlaybackReady&&n.keyboardShortcuts.allow())switch(e.key){case"MediaPlayPause":Ue===!1&&(w.log("documentEventMediaKeyDown(): MediaPlayPause"),e.preventDefault(),n.player.togglePlayPause());break;case"MediaTrackPrevious":w.log("documentEventMediaKeyDown(): MediaTrackPrevious"),e.preventDefault(),n.player.prevTrack();break;case"MediaTrackNext":w.log("documentEventMediaKeyDown(): MediaTrackNext"),e.preventDefault(),n.player.nextTrack();break}}function Aa(e){e.preventDefault(),e.shiftKey===!0?Y(null,A.PREV,P.prevPage):n.player.prevTrack()}function ha(e){e.preventDefault(),e.shiftKey===!0?Y(null,A.NEXT,P.nextPage):n.player.nextTrack()}function Y(e,t,a){e?.preventDefault(),B()&&n.player.getStatus().trackType===T.YOUTUBE?tt()===!1?$(t,n.player.getStatus().isPlaying):S({message:"Loading track, please wait...",duration:3}):Ct(null,a)}function Ca(){I(".playback-thumbnail-control","click",e=>ht(e)),I(".playback-thumbnail-control","contextmenu",e=>ht(e)),I(".playback-details-control","click",Ia),I(".playback-timer-control","click",va),n.isPlaybackReady=!0}function At(){let e=ie()&&n.player.getStatus().numTracks>1;(o.playback.autoExitFullscreen||e)&&D.exit()}function La(e){let t=e.data.timeRemainingSeconds<=o.playback.timeRemainingSeconds;o.playback.autoExitFsOnWarning&&t&&D.exit()}function Ia(){N(n.player.getStatus().trackElementId)}function ht(e){ie()?(R.add(R.SOURCE.MOUSE,R.EVENT.MOUSE_CLICK),R.doubleClicked(R.SOURCE.MOUSE,R.EVENT.MOUSE_CLICK,500)&&D.enter(document.getElementById(n.player.getStatus().playerId))):ce()&&(e.type==="contextmenu"?Ne(e)&&(e.preventDefault(),x(document.getElementById(n.player.getStatus().trackElementId))):N(0))}function va(){de.toggle()}var be=class extends V{elementClicked(t){Lt(t,this.event)}},Pe=class extends V{elementClicked(t){Lt(t,this.event)}};function Lt(e,t){switch(e){case"nav-prev-track":Y(t,A.PREV,P.prevPage);break;case"nav-next-track":Y(t,A.NEXT,P.nextPage);break}}function Ct(e,t){e?.preventDefault(),_(t,n.player.getStatus().isPlaying)}
//# sourceMappingURL=interaction.js.map
