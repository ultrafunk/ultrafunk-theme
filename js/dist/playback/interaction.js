import{$ as y,A as bt,Aa as wt,B as I,Ba as F,C as Pt,Ca as Bt,D as At,Da as Vt,E as St,Ea as $t,F as Ct,Fa as Kt,H as Lt,Ha as Ft,I as se,Ia as ve,Ja as Gt,Ka as G,La as M,M as ht,Ma as Wt,N as V,Na as Z,Oa as De,Pa as qt,Qa as Ht,Ra as ze,Sa as Xt,Ta as ie,Ua as Jt,V as Xe,Va as jt,Wa as ce,X as Ae,Y as It,Z as n,_ as E,a as kt,aa as m,b as Tt,ba as Je,c as d,ca as vt,d as S,da as Se,e as C,ea as Ce,f as He,fa as Dt,g as ne,ga as w,h as Te,ha as b,i as A,ia as Nt,j as fe,ja as Q,k as ft,ka as Le,la as he,ma as le,n as me,na as $,o as z,oa as x,pa as Ie,qa as Ut,ra as Yt,sa as Ot,t as v,ta as oe,u as o,ua as Rt,v as mt,va as _t,wa as je,x as f,xa as xt,y as be,ya as K,z as Pe,za as Mt}from"../chunk-UBGWAYPG.js";var Qe=A("eventlogger"),u={UNKNOWN:1e3,KEYBOARD:100,MOUSE:110,YOUTUBE:1,SOUNDCLOUD:2,ULTRAFUNK:50},p={UNKNOWN:-2e3,KEY_ARROW_LEFT:180,KEY_ARROW_RIGHT:181,MOUSE_CLICK:182,STATE_ERROR:-5,STATE_UNSTARTED:-1,STATE_ENDED:0,STATE_PLAYING:1,STATE_PAUSED:2,STATE_BUFFERING:3,STATE_CUED:5,RESUME_AUTOPLAY:50,PLAYER_ERROR:60,CROSSFADE_START:70},Ra={eventSource:u.UNKNOWN,eventType:p.UNKNOWN,uId:null,timeStamp:0},L,ue,W,R,Ne=class{constructor(t=10){S(this,L,[]);S(this,ue,0);S(this,W,0);S(this,R,0);C(this,ue,t)}add(t,a,s,c=Date.now()){let g=Object.create(Ra);g.eventSource=t,g.eventType=a,g.uId=s,g.timeStamp=c,d(this,L).length<d(this,ue)?d(this,L).push(g):(d(this,L).shift(),d(this,L).push(g))}clear(){C(this,L,[])}getLastPos(){return d(this,R)}initMatch(){C(this,R,d(this,L).length-1),C(this,W,0)}matchesEvent(t,a,s,c=null){d(this,L)[d(this,R)-t].eventSource===a&&d(this,L)[d(this,R)-t].eventType===s&&d(this,L)[d(this,R)-t].uId===c&&He(this,W)._++}matchesDelta(t,a){d(this,L)[d(this,R)].timeStamp-d(this,L)[d(this,R)-t].timeStamp<=a&&He(this,W)._++}isPatternMatch(t,a){return d(this,W)===t?(Qe.log(`MATCH for: ${a}`),Qe.logEventLog(d(this,L),u,p),!0):!1}};L=new WeakMap,ue=new WeakMap,W=new WeakMap,R=new WeakMap;var Ue=class extends Ne{doubleClicked(t,a,s){return this.initMatch(),this.getLastPos()>=1&&(this.matchesEvent(1,t,a),this.matchesEvent(0,t,a),this.matchesDelta(1,s)),this.isPatternMatch(3,`${Qe.getKeyForValue(u,t)} Double Clicked`)}},ee=class extends Ne{ytAutoplayBlocked(t,a){return this.initMatch(),this.getLastPos()>=3&&(this.matchesEvent(3,u.ULTRAFUNK,p.RESUME_AUTOPLAY,null),this.matchesEvent(2,u.YOUTUBE,p.STATE_UNSTARTED,t),this.matchesEvent(1,u.YOUTUBE,p.STATE_BUFFERING,t),this.matchesEvent(0,u.YOUTUBE,p.STATE_UNSTARTED,t),this.matchesDelta(3,a)),this.isPatternMatch(5,"YouTube Autoplay Blocked")}scAutoplayBlocked(t,a){return this.initMatch(),this.getLastPos()>=3&&(this.matchesEvent(3,u.ULTRAFUNK,p.RESUME_AUTOPLAY,null),this.matchesEvent(2,u.SOUNDCLOUD,p.STATE_PLAYING,t),this.matchesEvent(1,u.SOUNDCLOUD,p.STATE_PAUSED,t),this.matchesEvent(0,u.SOUNDCLOUD,p.STATE_PAUSED,t),this.matchesDelta(3,a)),this.isPatternMatch(5,"SoundCloud Autoplay Blocked")}scWidgetPlayBlocked(t,a){return this.initMatch(),this.getLastPos()>=2&&(this.matchesEvent(2,u.SOUNDCLOUD,p.STATE_PLAYING,t),this.matchesEvent(1,u.SOUNDCLOUD,p.STATE_PAUSED,t),this.matchesEvent(0,u.SOUNDCLOUD,p.STATE_PAUSED,t),this.matchesDelta(2,a)),this.isPatternMatch(4,"SoundCloud WidgetPlay Blocked")}scPlayDoubleTrigger(t,a){return this.initMatch(),this.getLastPos()>=2&&(this.matchesEvent(2,u.ULTRAFUNK,p.CROSSFADE_START,null),this.matchesEvent(1,u.SOUNDCLOUD,p.STATE_PLAYING,t),this.matchesEvent(0,u.SOUNDCLOUD,p.STATE_PLAYING,t),this.matchesDelta(1,a)),this.isPatternMatch(4,"SoundCloud Play Double Trigger")}};var st={};kt(st,{getStatus:()=>$e,init:()=>fr,nextTrack:()=>nt,prevTrack:()=>ua,toggleMute:()=>da,togglePlayPause:()=>Ve});var q,te,de,H=class{constructor(){S(this,q,-1);S(this,te,0);S(this,de,!0);Tt(this,"config",{updateTimerInterval:250,maxBufferingDelay:3})}init(){document.addEventListener("visibilitychange",()=>{C(this,de,document.visibilityState==="visible")})}updateProxy(){}start(){this.stop(),C(this,q,setInterval(()=>{d(this,de)&&this.updateProxy()},this.config.updateTimerInterval))}stop(){d(this,q)!==-1&&(clearInterval(d(this,q)),C(this,q,-1)),C(this,te,0),Le(!1)}updateTimeRemainingWarning(t,a){if(o.playback.autoplay===!1&&o.playback.timeRemainingWarning&&d(this,te)!==t){let s=a-t;C(this,te,t),s<=o.playback.timeRemainingSeconds?(Le(!0),y(n.MEDIA_TIME_REMAINING,{timeRemainingSeconds:s})):Le(!1)}}};q=new WeakMap,te=new WeakMap,de=new WeakMap;var X,pe,Oe,zt,Re,Qt,et=class extends H{constructor(){super(...arguments);S(this,Oe);S(this,Re);S(this,X,null);S(this,pe,null)}init(a,s){super.init(),C(this,X,a),C(this,pe,s)}updateProxy(){d(this,X).current.getPosition((a,s)=>ne(this,Oe,zt).call(this,a,s))}},Ze=et;X=new WeakMap,pe=new WeakMap,Oe=new WeakSet,zt=function(a,s=0){let c=Math.round(a/1e3);w(a,c,s),c>0&&s>0&&(Te(et.prototype,this,"updateTimeRemainingWarning").call(this,c,s),ne(this,Re,Qt).call(this,c,s))},Re=new WeakSet,Qt=function(a,s){o.playback.masterMute===!1&&o.playback.autoplay&&o.gallery.autoCrossfade&&s-a===o.gallery.autoCrossfadeLength+this.config.maxBufferingDelay&&d(this,X).getCurrentTrack()+1<=d(this,X).getNumTracks()&&d(this,pe).call(this,Pe.AUTO,{name:"Auto Crossfade",length:o.gallery.autoCrossfadeLength,curve:o.gallery.autoCrossfadeCurve})};var Y=new Ze;var P=A("embedded-players"),_=new ee(10),i={players:{},playbackState:null,embeddedEvent:null,loadEventsTotal:0,loadEventsCount:1},xa={maxPlaybackStartDelay:3};function ea(e,t,a){i.players=e,i.playbackState=t,i.embeddedEvent=a,i.loadEventsTotal=3+parseInt(document.body.getAttribute("data-gallery-track-count")),Ba(),Ja()}function _e(){return{loadingPercent:100*(i.loadEventsCount++/i.loadEventsTotal)}}function ta(){i.loadEventsCount>=i.loadEventsTotal?i.embeddedEvent(n.PLAYBACK_READY,{resetProgressBar:!0}):y(n.PLAYBACK_LOADING,_e())}function Ma(){let e=document.querySelectorAll("single-track, gallery-track");e.forEach(t=>{let a=parseInt(t.getAttribute("data-track-type")),s=t.querySelector("iframe"),c=null;if(a===I.YOUTUBE)e.length===1&&s===null?c=Zt("youtube-player",t,!0):c=Zt(s.id,t,!1);else if(a===I.SOUNDCLOUD){let g=SC.Widget(s.id);c=new At(t.id,s.id,g,s.src),g.bind(SC.Widget.Events.READY,()=>{c.setThumbnail(t),g.getDuration(U=>c.setDuration(Math.round(U/1e3))),ja(c,s.id)}),g.bind(SC.Widget.Events.PLAY,za),g.bind(SC.Widget.Events.PAUSE,Qa),g.bind(SC.Widget.Events.FINISH,Za),g.bind(SC.Widget.Events.ERROR,er)}c!==null&&(c.setArtistTitle(t.getAttribute("data-track-artist"),t.getAttribute("data-track-title")),i.players.add(c))})}function Zt(e,t,a=!1){let s=t.getAttribute("data-track-source-uid"),c=new YT.Player(e,{events:{onReady:U=>Va(U,e),onStateChange:U=>$a(U,e),onError:U=>Xa(U,e)},...a&&{videoId:s}}),g=new Pt(t.id,e,c,s);return g.setDuration(parseInt(t.getAttribute("data-track-duration"))),g}function Me(e,t){P.log("onPlayerError()"),P.log(e);let a=e.getTrackType()===I.YOUTUBE?u.YOUTUBE:u.SOUNDCLOUD;i.players.isCurrent(e.getUid())===!1&&i.players.stop(),_.add(a,p.PLAYER_ERROR,e.getUid()),i.embeddedEvent(n.MEDIA_UNAVAILABLE,wa(e,t))}function wa(e,t){let a=e.getArtist()||"N/A",s=e.getTitle()||"N/A";return{currentTrack:i.players.trackFromUid(e.getUid()),numTracks:i.players.getNumTracks(),trackId:e.getTrackId(),mediaTitle:`${a} - ${s}`,mediaUrl:t}}function Ba(){P.log("initYouTubeAPI()"),y(n.PLAYBACK_LOADING,_e()),window.onYouTubeIframeAPIReady=function(){P.log("onYouTubeIframeAPIReady()"),y(n.PLAYBACK_LOADING,_e()),Ma()};let e=document.createElement("script");e.id="youtube-iframe-api",e.src="https://www.youtube.com/iframe_api";let t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}function Va(e,t){let a=i.players.playerFromUid(t);P.log(`onYouTubePlayerReady(): ${t} => ${e.target.getVideoData().video_id} => ${a.getArtist()} - ${a.getTitle()}`),e.target.getPlayerState()===-1&&a.setIsPlayable(!1),ta()}function $a(e,t){switch(_.add(u.YOUTUBE,e.data,t),e.data){case YT.PlayerState.UNSTARTED:Ka(t);break;case YT.PlayerState.BUFFERING:Fa(t);break;case YT.PlayerState.PLAYING:Ga(t);break;case YT.PlayerState.PAUSED:Wa(t);break;case YT.PlayerState.CUED:qa(t);break;case YT.PlayerState.ENDED:Ha(t);break}}function Ka(e){P.log(`onYouTubePlayerStateChange: UNSTARTED (uID: ${e})`),_.ytAutoplayBlocked(e,3e3)&&i.embeddedEvent(n.AUTOPLAY_BLOCKED)}function Fa(e){if(P.log(`onYouTubePlayerStateChange: BUFFERING (uID: ${e})`),i.players.crossfade.isFading()===!1){let t=i.players.playerFromUid(e);t.mute(o.playback.masterMute),t.setVolume(o.playback.masterVolume),y(n.MEDIA_LOADING)}}function Ga(e){P.log(`onYouTubePlayerStateChange: PLAYING   (uID: ${e})`),i.playbackState.syncAll(e,i.playbackState.STATE.PLAY),Y.start()}function Wa(e){P.log(`onYouTubePlayerStateChange: PAUSED    (uID: ${e})`),i.players.isCurrent(e)?(i.playbackState.syncAll(e,i.playbackState.STATE.PAUSE),Y.stop()):i.players.crossfade.stop()}function qa(e){P.log(`onYouTubePlayerStateChange: CUED      (uID: ${e})`);let t=i.players.playerFromUid(e);"isNextSingleTrackCued"in t&&t.isNextSingleTrackCued&&(delete t.isNextSingleTrackCued,t.embedded.getDuration()===0&&t.setIsPlayable(!1),P.log(`onYouTubePlayerStateChange: CUED      Duration: ${t.embedded.getDuration()} - isPlayable: ${t.isPlayable()}`))}function Ha(e){P.log(`onYouTubePlayerStateChange: ENDED     (uID: ${e})`),i.players.isCurrent(e)?(Y.stop(),i.embeddedEvent(n.MEDIA_ENDED)):i.players.crossfade.stop()}function Xa(e,t){let a=i.players.playerFromUid(t);e.data!==null&&a.isPlayable()?(P.log("onYouTubePlayerError: "+e.data),a.setIsPlayable(!1),Me(a,e.target.getVideoUrl())):P.warn(`onYouTubePlayerError(): ${t} => ${e.target.getVideoData().video_id} => ${a.getArtist()} - ${a.getTitle()}
No YouTube API error given! ((event.data === null) && (isPlayable === false))`)}function Ja(){P.log("initSoundCloudAPI()"),y(n.PLAYBACK_LOADING,_e())}function ja(e,t){P.log(`onSCPlayerEventReady(): ${t} => ${e.getUid()} => ${e.getArtist()} - ${e.getTitle()}`),ta()}function za(e){P.log(`onSoundCloudPlayerEvent: PLAY   (uID: ${e.soundId})`),_.add(u.SOUNDCLOUD,p.STATE_PLAYING,e.soundId),i.players.crossfade.isFading()&&i.players.isCurrent(e.soundId)?_.scPlayDoubleTrigger(e.soundId,xa.maxPlaybackStartDelay*1e3)&&i.playbackState.syncAll(e.soundId,i.playbackState.STATE.PLAY):(i.playbackState.syncAll(e.soundId,i.playbackState.STATE.PLAY),i.players.current.mute(o.playback.masterMute),i.players.current.setVolume(o.playback.masterVolume)),Y.start()}function Qa(e){P.log(`onSoundCloudPlayerEvent: PAUSE  (uID: ${e.soundId})`),_.add(u.SOUNDCLOUD,p.STATE_PAUSED,e.soundId),_.scAutoplayBlocked(e.soundId,3e3)?(Y.stop(),i.embeddedEvent(n.AUTOPLAY_BLOCKED)):_.scWidgetPlayBlocked(e.soundId,3e4)?(Y.stop(),i.embeddedEvent(n.PLAYBACK_BLOCKED,{currentTrack:i.players.trackFromUid(e.soundId),numTracks:i.players.getNumTracks()})):i.players.isCurrent(e.soundId)?i.players.current.getPosition(t=>{t>0&&(i.playbackState.syncAll(e.soundId,i.playbackState.STATE.PAUSE),Y.stop())}):i.players.crossfade.stop()}function Za(e){P.log(`onSoundCloudPlayerEvent: FINISH (uID: ${e.soundId})`),i.players.isCurrent(e.soundId)?(Y.stop(),i.embeddedEvent(n.MEDIA_ENDED)):i.players.crossfade.stop()}function er(){this.getCurrentSound(e=>{let t=i.players.playerFromUid(e.id);P.log(`onSoundCloudPlayerEvent: ERROR for track: ${i.players.trackFromUid(e.id)}. ${t.getArtist()} - ${t.getTitle()} - [${t.getUid()} / ${t.getIframeId()}]`),t.setIsPlayable(!1)})}var O=A("gallery-events"),we={snackbarId:0,nowPlayingIcons:null},at={nowPlayingIconsSelector:"h2.track-title"};function aa(){O.log("init()"),we.nowPlayingIcons=document.querySelectorAll(at.nowPlayingIconsSelector),E(n.MEDIA_PLAYING,ar),E(n.MEDIA_PAUSED,rr),E(n.MEDIA_ENDED,nr),E(n.MEDIA_CUE_NEXT,sr),E(n.CONTINUE_AUTOPLAY,lr),E(n.RESUME_AUTOPLAY,or),E(n.AUTOPLAY_BLOCKED,ir),E(n.PLAYBACK_BLOCKED,cr),E(n.MEDIA_UNAVAILABLE,ur)}function ar(e){if(O.log(e),be(we.snackbarId),e.data.numTracks>1){let t=document.querySelector(`#${e.data.trackId} ${at.nowPlayingIconsSelector}`);ra(t),V(t,"playing-paused","now-playing-icon"),o.gallery.animateNowPlayingIcon&&t.classList.add("playing-animate")}}function rr(e){O.log(e),e.data.numTracks>1&&document.querySelector(`#${e.data.trackId} ${at.nowPlayingIconsSelector}`).classList.add("playing-paused")}function nr(e){O.log(e),e!==null&&e.data.numTracks>1&&ra()}function sr(e){O.log(e),e.data.scrollToMedia&&M(e.data.trackId)}function lr(e){O.log(e),ie()&&e.data.trackType===I.YOUTUBE?ce(!0):G(v.nextPage,!0)}function or(e){let t=JSON.parse(sessionStorage.getItem(z.UF_AUTOPLAY));if(sessionStorage.removeItem(z.UF_AUTOPLAY),O.log(e),O.log(`RESUME_AUTOPLAY: ${t!==null?JSON.stringify(t):"NO"}`),t!==null){let a=document.getElementById(t.trackId)?.querySelector("iframe").id;e.callback.resumeAutoplay(t,a)}}function ir(e){O.log(e),we.snackbarId=f("Autoplay blocked, Play to continue",0,"play",()=>e.callback.togglePlayPause())}function cr(e){O.log(e),f("Unable to play track, skipping to next",5,"Stop",()=>{},()=>tt(e))}function ur(e){O.log(e),dr(e.data.trackId)?f("YouTube Premium track, skipping",5,"help",()=>window.location.href="/channel/premium/",()=>tt(e)):(f("Unable to play track, skipping to next",5,"Stop",()=>{},()=>tt(e)),fe("EVENT_MEDIA_UNAVAILABLE",e.data))}function ra(e){we.nowPlayingIcons.forEach(t=>{t!==e&&t.classList.remove("now-playing-icon","playing-animate","playing-paused")})}function tt(e){e.data.currentTrack<e.data.numTracks?e.callback.skipToTrack(e.data.currentTrack+1,!0):ie()?ce(o.playback.autoplay):v.nextPage!==null&&G(v.nextPage,!0)}function dr(e){let t=document.getElementById(e);return t!==null?t.classList.contains("uf_channel-premium"):!1}var rt=A("crossfade-controls"),Be={players:{}},D={},J={crossfadePresetSelector:".crossfade-preset-control",crossfadePresetData:"data-crossfade-preset",crossfadeToSelector:".crossfade-fadeto-control"};function sa(e,t){rt.log("init()"),Be.players=e,D.crossfadePreset=Je(J.crossfadePresetSelector),D.crossfadeTo=Je(J.crossfadeToSelector),D.crossfadePreset.length>1&&D.crossfadeTo.length>1&&(D.crossfadePreset.forEach(a=>la(a,o.gallery.trackCrossfadeDefPreset)),D.crossfadeTo.clickCallback=t),E(n.PLAYBACK_READY,yr)}function yr(){rt.log("playbackReady()"),D.crossfadePreset.length>1&&D.crossfadeTo.length>1&&(D.crossfadePreset.forEach(e=>{e.addEventListener("click",gr),V(e,m.DISABLED.CLASS,m.ENABLED.CLASS)}),D.crossfadeTo.forEach(e=>e.addEventListener("click",Er)),E(n.MEDIA_PLAYING,na),E(n.MEDIA_PAUSED,na))}function la(e,t){e.setAttribute(J.crossfadePresetData,t),e.textContent=`${t+1}`,e.title=`Preset: ${me.crossfade[t].name}`}function gr(e){let t=parseInt(e.target.getAttribute(J.crossfadePresetData));la(e.target,t+1<me.crossfade.length?t+1:0)}function Er(e){if(b()&&Be.players.crossfade.isFading()===!1){let t=e.target.closest("gallery-track");if(t!==null){let a=t.querySelector("iframe"),s=parseInt(t.querySelector(J.crossfadePresetSelector).getAttribute(J.crossfadePresetData));V(t.querySelector(`div${J.crossfadeToSelector}`),m.ENABLED.CLASS,m.DISABLED.CLASS),D.crossfadeTo.clickCallback(Be.players.uIdFromIframeId(a.id),me.crossfade[s])}}}function na(){let e=b(),t=e?Be.players.getTrackData().currentTrack:-1;rt.log(`updateCrossfadeToState() - playingState: ${e} - currentTrack: ${t}`),D.crossfadeTo.forEach((a,s)=>{t===s+1?V(a,e?m.ENABLED.CLASS:m.DISABLED.CLASS,e?m.DISABLED.CLASS:m.ENABLED.CLASS):V(a,e?m.DISABLED.CLASS:m.ENABLED.CLASS,e?m.ENABLED.CLASS:m.DISABLED.CLASS)})}var oa=A("gallery-players"),ia=()=>{let e=null,t=null,a=[],s=new Map,c=0;return{indexMap:s,get crossfade(){return t},get current(){return a[c]},get next(){return a[c+1]},getPlayerIndex(){return c},setPlayerIndex(T){c=T},getTrackType(){return this.current.getTrackType()},getNumTracks(){return a.length},getCurrentTrack(){return c+1},playerFromUid(T){return a[s.get(T)]},trackFromUid(T){return s.get(T)+1},isCurrent(T){return T===this.current.getUid()},init:g,add:U,uIdFromIframeId:ke,stop:Ia,mute:va,getTrackData:Da,prevTrack:Na,nextTrack:Ua,jumpToTrack:Ya};function g(T){oa.log("init()"),e=T,t=bt(this),E(n.MEDIA_PLAYING,()=>t.start()),E(n.MEDIA_PAUSED,()=>t.stop())}function U(T){oa.log(T),a.push(T),s.set(T.getUid(),a.length-1)}function ke(T){return a.find(qe=>qe.getIframeId()===T).getUid()}function Ia(){this.current.stop(),t.stop()}function va(){this.current.mute(o.playback.masterMute),t.mute(o.playback.masterMute)}function Da(){return{currentTrack:this.getCurrentTrack(),numTracks:this.getNumTracks(),artist:this.current.getArtist(),title:this.current.getTitle(),duration:this.current.getDuration(),thumbnail:{src:this.current.getThumbnailSrc(),class:this.current.getThumbnailClass()}}}function Na(T){return c>0?(c--,e(T),!0):!1}function Ua(T){return c++,c<this.getNumTracks()?(e(T),!0):!1}function Ya(T,qe,Oa=!0){return T>0&&T<=this.getNumTracks()?(c=T-1,e(qe,Oa),!0):!1}};var h=A("gallery-playback"),r={eventLog:null,players:{}},ca={minCrossfadeToTime:5,maxBufferingDelay:3};function fr(){h.log("init()"),r.eventLog=_,aa(),r.players=ia(),r.players.init(pa),Se(r.players,br),sa(r.players,Cr),Y.init(r.players,ga),ea(r.players,Ea,Lr)}function Ve(){b()?(Q(),r.players.current.pause()):(Nt(),r.players.current.play(Me))}function ua(){h.log(`prevTrack() - prevTrack: ${r.players.getCurrentTrack()-1} - numTracks: ${r.players.getNumTracks()}`),r.players.getCurrentTrack()>0&&r.players.current.getPosition(e=>{e>5e3?(r.players.current.seekTo(0),w(0,0,r.players.current.getDuration())):(r.players.getCurrentTrack()>1&&r.players.stop(),r.players.prevTrack(b())&&le())})}function nt(e=!1){let t=r.players.getCurrentTrack()+1>r.players.getNumTracks();h.log(`nextTrack() - isMediaEnded: ${e} - isLastTrack: ${t} - autoplay: ${o.playback.autoplay}`),!mr(e,t)&&(t===!1?(r.players.stop(),e&&o.playback.autoplay===!1?Q():r.players.nextTrack(b())&&$()):e&&(Q(),o.playback.autoplay?y(n.CONTINUE_AUTOPLAY,{trackType:r.players.current.getTrackType()}):r.players.stop()))}function mr(e,t){if(e&&o.playback.autoplay){let a=Ie();if(h.log(`repeatPlayback(): ${h.getKeyForValue(x,a)}`),a===x.ONE)return r.players.current.seekTo(0),r.players.current.play(),!0;if(t&&a===x.ALL)return r.players.stop(),r.players.setPlayerIndex(0),pa(!0),!0}return!1}function br(e){r.players.current.seekTo(e)}function da(){o.playback.masterMute=o.playback.masterMute!==!0,r.players.mute()}function Pr(e,t=!0){h.log(`cueTrack(): ${e}`),r.players.setPlayerIndex(r.players.indexMap.get(e)),y(n.MEDIA_CUE_NEXT,{scrollToMedia:t,trackId:r.players.current.getTrackId()}),$()}function pa(e,t=!0){y(n.MEDIA_CUE_NEXT,{scrollToMedia:t,trackId:r.players.current.getTrackId()}),e&&r.players.current.play(Me)}function ya(e,t=!0){h.log(`skipToTrack(): ${e} - ${t}`),t===!0&&b()===!1&&(r.eventLog.add(u.ULTRAFUNK,p.RESUME_AUTOPLAY,null),r.players.jumpToTrack(e,t)&&$())}function Ar(e,t=null){h.log(`resumeAutoplay(): ${e.autoplay}${t!==null?" - "+t:""}`),t!==null?e.autoplay?ya(r.players.trackFromUid(t),!0):Pr(t):e.autoplay&&(r.eventLog.add(u.ULTRAFUNK,p.RESUME_AUTOPLAY,null),Ve())}function Sr(e,t,a=!1){h.log(`cueOrPlayNextSingleTrackById() - playMedia: ${a}`),r.players.current.setIsPlayable(!0),r.players.current.setArtistTitle(e.track_artist,e.track_title),r.players.current.setDuration(parseInt(e.track_duration)),r.players.current.setThumbnail(t),Dt(0),he(),a?(r.eventLog.add(u.ULTRAFUNK,p.RESUME_AUTOPLAY,null),r.players.current.playTrackById(t.uid)):(r.players.current.cueTrackById(t.uid),r.players.current.isNextSingleTrackCued=!0)}function $e(){return{isPlaying:b(),currentTrack:r.players.getCurrentTrack(),trackType:r.players.current.getTrackType(),position:0,numTracks:r.players.getNumTracks(),trackId:r.players.current.getTrackId(),iframeId:r.players.current.getIframeId()}}function Cr(e,t){r.players.isCurrent(e)===!1&&r.players.current.getDuration()>0&&(h.log(`crossfadeToClick():
      fadeOut: ${r.players.current.getArtist()} - "${r.players.current.getTitle()}" (${r.players.current.getUid()})
      fadeIn.: ${r.players.playerFromUid(e).getArtist()} - "${r.players.playerFromUid(e).getTitle()}" (${e})`),o.playback.masterMute===!1&&o.playback.autoplay===!1&&r.players.current.getPosition(a=>{r.players.current.getDuration()-a/1e3>=ca.minCrossfadeToTime+ca.maxBufferingDelay&&ga(Pe.TRACK,t,e)}))}function ga(e,t,a=null){r.eventLog.add(u.ULTRAFUNK,p.CROSSFADE_START,null);let s=r.players.crossfade.init(e,t,a);s!==null&&Ea.syncControls(s.fadeOutPlayer,s.fadeInPlayer)}function Lr(e,t=null){switch(h.log(`embeddedEventHandler() - event: ${h.getKeyForValue(n,e)}`),t!==null&&h.log(t),e){case n.MEDIA_ENDED:y(n.MEDIA_ENDED,$e()),nt(!0);break;case n.PLAYBACK_READY:Ce(ua,Ve,nt,da),jt(Sr),y(n.PLAYBACK_READY,t),y(n.RESUME_AUTOPLAY,null,{resumeAutoplay:Ar});break;case n.AUTOPLAY_BLOCKED:y(n.AUTOPLAY_BLOCKED,null,{togglePlayPause:Ve});break;case n.PLAYBACK_BLOCKED:case n.MEDIA_UNAVAILABLE:y(e,t,{skipToTrack:ya});break}}var Ea=(()=>{let e={PLAY:1,PAUSE:2},t=function s(c,g){if(h.log(`playbackState.syncAll() - previousTrack: ${r.players.getPlayerIndex()+1} - nextTrack: ${r.players.indexMap.get(c)+1} - syncState: ${h.getKeyForValue(e,g)}`),r.players.isCurrent(c))g===e.PLAY?y(n.MEDIA_PLAYING,$e()):g===e.PAUSE&&y(n.MEDIA_PAUSED,$e());else{let U=r.players.getPlayerIndex(),ke=r.players.indexMap.get(c);r.players.stop(),r.players.setPlayerIndex(ke),a(U,ke),s(c,g)}};function a(s,c){c>s?$():le()}return{STATE:e,syncAll:t,syncControls:a}})();var pt={};kt(pt,{getStatus:()=>Ur,init:()=>Ir,nextTrack:()=>ma,prevTrack:()=>fa,toggleMute:()=>ct,togglePlayPause:()=>dt});var ae,Ke,ka,it=class extends H{constructor(){super(...arguments);S(this,Ke);S(this,ae,null)}ready(a){super.init(),C(this,ae,a),E(n.MEDIA_PLAYING,()=>super.start())}updateProxy(){b()&&ne(this,Ke,ka).call(this,d(this,ae).embedded.getCurrentTime(),d(this,ae).getDuration())}},lt=it;ae=new WeakMap,Ke=new WeakSet,ka=function(a,s){if(a!==void 0){let c=Math.round(a);w(a*1e3,c,s),c>0&&s>0&&Te(it.prototype,this,"updateTimeRemainingWarning").call(this,c,s)}};var ot=new lt;var N=A("list-playback"),re=new ee(10),l={player:null,autoplayData:null,playerReady:!1,firstStatePlaying:!0,currentTrackId:null,currentSnackbarId:0},ut=`
  <p>The <b>List Player</b> only supports playing YouTube tracks, SoundCloud tracks will be automatically skipped over.</p>
  <p>SoundCloud tracks must be played using the <b>Gallery Player</b> or by clicking / tapping on the track <b>Artist + Title</b> text link in the <b>List Player</b>.</p>
  <p>To toggle between the <b>Gallery</b> and <b>List</b> players, please use the <b>Pref. Player: GALLERY / LIST</b> setting toggle button in the sites footer area.</p>`;function Ir(){N.log("init()"),Yt(j),vr()!==null?Yr():f("No playable YouTube tracks!",0,"help",()=>Ae("No playable tracks",ut))}function vr(){if(l.currentTrackId=K(),l.autoplayData=JSON.parse(sessionStorage.getItem(z.UF_AUTOPLAY)),sessionStorage.removeItem(z.UF_AUTOPLAY),l.currentTrackId!==null){if(l.autoplayData!==null&&l.autoplayData.trackId!==null){let e=l.autoplayData.trackId.match(Ct);if(e!==null){let t=oe(`[data-track-source-uid="${e[0]}"]`);t!==null&&(l.currentTrackId=t.id)}else if(l.autoplayData.trackId.match(/^track-(?!0)\d{1,9}$/i)!==null){let t=oe(`[data-track-id="${l.autoplayData.trackId}"]`);t!==null?je(t)===I.YOUTUBE?l.currentTrackId=t.id:f("Cannot play SoundCloud track",5,"help",()=>Ae("Cannot play SoundCloud track",ut)):f("Unable to cue track (not found)",5)}}Mt(l.currentTrackId)}return N.log(`cueInitialTrack() - currentTrackId: ${l.currentTrackId} - autoplayData: ${l.autoplayData!==null?JSON.stringify(l.autoplayData):"N/A"}`),l.currentTrackId}function j(e,t=!0,a=!1){let s=je(_t(e));if(N.log(`setCurrentTrack() - nextTrackType: ${N.getKeyForValue(I,s)} - nextTrackId: ${e} - playNextTrack: ${t} - isPointerClick: ${a}`),s===I.SOUNDCLOUD&&a){f("Cannot play SoundCloud track",5,"help",()=>Ae("Cannot play SoundCloud track",ut));return}e===l.currentTrackId?dt():(b()&&l.player.embedded.stopVideo(),l.currentTrackId=e,y(n.MEDIA_CUE_NEXT,{nextTrackId:e,isPointerClick:a}),Ta(t))}function Ta(e){let t=Vt();e?(l.player.embedded.loadVideoById(t),F(m.PLAYING),he()):(l.player.embedded.cueVideoById(t),F(m.PAUSED))}function dt(){l.currentTrackId===null?j(oe("div.track-entry.current").id):b()?l.player.embedded.pauseVideo():l.player.play(Fe)}function ct(e=!1){e===!1&&(o.playback.masterMute=o.playback.masterMute!==!0),o.playback.masterMute?l.player.embedded.mute():l.player.embedded.unMute()}function fa(){let e=xt(),t=l.player.embedded.getCurrentTime();e!==null&&t<=5?(j(e,b()),le()):t!==0&&(l.player.embedded.seekTo(0),w(0,0,l.player.getDuration()))}function ma(){let e=K();e!==null&&(j(e,b()),$())}async function ba(e=!1,t=!1){let a=t?x.OFF:Ie(),s=K();if(N.log(`advanceToNextTrack() autoplay: ${e} - isPlaybackError: ${t} - nextTrackId: ${s} - repeatMode: ${N.getKeyForValue(x,a)}`),e&&a===x.ONE)l.player.embedded.seekTo(0),l.player.play(Fe);else if(e&&s===null&&a===x.ALL)j(K(null)),M(0);else if(s===null)if(o.list.showLoadMoreTracks){let c=await wt();e&&c&&j(K())}else G(v.nextPage,e);else e?j(s):F(m.PAUSED)}function Dr(){b()===!1&&l.autoplayData!==null&&(re.add(u.ULTRAFUNK,p.RESUME_AUTOPLAY,null),re.add(u.YOUTUBE,-1,K())),b()===!1&&ba(!0,!0)}function Nr(){l.currentTrackId=null,F(m.PAUSED)}function Ur(){let e=oe("div.track-entry.current");if(e!==null){let t=Rt("div.track-entry"),a=Array.prototype.indexOf.call(t,e);return{isPlaying:b(),currentTrack:a+1,trackType:I.YOUTUBE,position:Math.ceil(l.player.embedded.getCurrentTime()),numTracks:l.player.getNumTracks(),trackId:t[a].getAttribute("data-track-id"),iframeId:"youtube-player"}}return{isPlaying:!1,currentTrack:1,position:0,trackId:0}}function Yr(){N.log("initYouTubeAPI()"),window.onYouTubeIframeAPIReady=function(){N.log("onYouTubeIframeAPIReady()");let a=new YT.Player("youtube-player",{events:{onReady:Or,onStateChange:Rr,onError:Fe}});l.player=new St(a),N.log(l.player),Se(l.player,s=>l.player.embedded.seekTo(s)),y(n.PLAYBACK_LOADING,{loadingPercent:33})};let e=document.createElement("script");e.id="youtube-iframe-api",e.src="https://www.youtube.com/iframe_api";let t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}function Or(){N.log("onYouTubePlayerReady()"),l.autoplayData?.autoplay===!0&&re.add(u.ULTRAFUNK,p.RESUME_AUTOPLAY,null),Ce(fa,dt,ma,ct),y(n.PLAYBACK_LOADING,{loadingPercent:66}),ot.ready(l.player),Ot(l.player),ct(!0),y(n.PLAYBACK_READY,{resetProgressBar:!1}),Ta(l.autoplayData?.autoplay===!0)}function Rr(e){switch(N.log(`onYouTubePlayerStateChange(): ${e.data} - trackId: ${l.currentTrackId}`),re.add(u.YOUTUBE,e.data,l.currentTrackId),e.data!==YT.PlayerState.PLAYING&&Q(),e.data){case YT.PlayerState.UNSTARTED:_r();break;case YT.PlayerState.CUED:l.player.setPlayerState(e.data);break;case YT.PlayerState.BUFFERING:y(n.MEDIA_LOADING);break;case YT.PlayerState.PLAYING:xr(),y(n.MEDIA_PLAYING);break;case YT.PlayerState.PAUSED:F(m.PAUSED);break;case YT.PlayerState.ENDED:ot.stop(),y(n.MEDIA_ENDED),ba(o.playback.autoplay);break}}function _r(){re.ytAutoplayBlocked(l.currentTrackId,3e3)&&(F(m.PAUSED),l.currentSnackbarId=f("Autoplay blocked, Play to continue",0,"play",()=>l.player.play(Fe))),l.playerReady===!1&&(l.playerReady=!0,y(n.PLAYBACK_LOADING,{loadingPercent:0}))}function xr(){be(l.currentSnackbarId),l.firstStatePlaying&&(l.firstStatePlaying=!1,l.autoplayData=null,setTimeout(()=>{o.playback.autoplay&&b()&&Math.round(window.pageYOffset)<=1&&ht(Lt.SITE_MAX_WIDTH_MOBILE)&&M(0)},6e3))}function Fe(e){N.log(`onYouTubePlayerError(): ${e.data} - trackId: ${l.currentTrackId}`),Bt("Error!"),re.add(u.YOUTUBE,p.PLAYER_ERROR,l.currentTrackId),f("Unable to play track, skipping to next",5,"Stop",Nr,Dr),fe("EVENT_MEDIA_UNAVAILABLE",{mediaUrl:l.player.embedded.getVideoUrl(),mediaTitle:`${l.player.getArtist()} - ${l.player.getTitle()}`})}var We=A("screen-wakelock"),Ge={wakeLock:null};function Pa(){o.mobile.keepScreenOn&&document.addEventListener("click",Aa)}function Aa(){We.log("enableScreenWakeLock()"),document.removeEventListener("click",Aa),wr(),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&o.mobile.keepScreenOn&&Mr()})}function Mr(){Sa()&&Ge.wakeLock===null&&Ca()}function Sa(){return"wakeLock"in navigator&&"request"in navigator.wakeLock}async function wr(){Sa()?document.visibilityState==="visible"&&await Ca()!==!0&&(We.log("enableWakeLock(): Screen Wake Lock request failed"),f("Keep Screen On failed",5,"Disable",()=>o.mobile.keepScreenOn=!1)):(We.log("enableWakeLock(): Screen Wake Lock is not supported"),f("Keep Screen On is not supported",5,"Disable",()=>o.mobile.keepScreenOn=!1))}async function Ca(){try{return Ge.wakeLock=await navigator.wakeLock.request("screen"),Ge.wakeLock.addEventListener("release",()=>{Ge.wakeLock=null}),!0}catch(e){We.error(`requestWakeLock(): ${e.name} - ${e.message}`)}return!1}var ye=A("playback-interaction"),La=new Ue(10),k={player:null,isPlaybackReady:!1,siteNavUiElements:null,trackNavUiElements:null},Br={doubleClickDelay:500};document.addEventListener("DOMContentLoaded",()=>{ft(),ye.log("DOMContentLoaded"),mt(),$t()?k.player=st:Kt()&&(k.player=pt),k.player!==null&&Vr(),Xt(k.player?.getStatus)});function Vr(){ye.log("initShared()"),vt(),$r(),k.player.init(),k.siteNavUiElements=new yt("#site-navigation"),k.trackNavUiElements=new gt("nav.single-track-nav .nav-links"),Z.init(),De.init(),Kr(),Pa()}function $r(){E(n.PLAYBACK_READY,Hr),E(n.MEDIA_CUE_NEXT,ha),E(n.MEDIA_ENDED,ha),E(n.MEDIA_TIME_REMAINING,Xr)}function Kr(){se(".playback-shuffle-control span","click",Gt),document.addEventListener("keydown",Fr),document.addEventListener("keydown",Gr),window.addEventListener("blur",Jr)}function Fr(e){if(k.isPlaybackReady&&De.allow()&&e.repeat===!1&&e.ctrlKey===!1&&e.altKey===!1){switch(e.code){case"Backquote":e.preventDefault(),M(k.player.getStatus().trackId);break}switch(e.key){case" ":e.preventDefault(),k.player.togglePlayPause();break;case"Home":case"End":case"PageUp":case"PageDown":Wt(e);break;case"ArrowLeft":Wr(e);break;case"ArrowRight":qr(e);break;case"A":ze.toggle();break;case"f":case"F":e.preventDefault(),Z.toggle(document.getElementById(k.player.getStatus().iframeId));break;case"m":case"M":e.preventDefault(),k.player.toggleMute(),f(o.playback.masterMute?"Volume is muted (<b>m</b> to unmute)":"Volume is unmuted (<b>m</b> to mute)",3);break;case"p":case"P":qt.toggle();break;case"r":case"R":f(`${Ut().title} (<b>r</b> to change)`,3);break;case"x":case"X":Ht.toggle();break}}}function Gr(e){if(k.isPlaybackReady&&De.allow())switch(e.key){case"MediaPlayPause":It===!1&&(ye.log("documentEventMediaKeyDown(): MediaPlayPause"),e.preventDefault(),k.player.togglePlayPause());break;case"MediaTrackPrevious":ye.log("documentEventMediaKeyDown(): MediaTrackPrevious"),e.preventDefault(),k.player.prevTrack();break;case"MediaTrackNext":ye.log("documentEventMediaKeyDown(): MediaTrackNext"),e.preventDefault(),k.player.nextTrack();break}}function Wr(e){e.preventDefault(),e.shiftKey===!0?Ee(null,v.prevPage):k.player.prevTrack()}function qr(e){e.preventDefault(),e.shiftKey===!0?Et(null):k.player.nextTrack()}function Et(e){e?.preventDefault(),ie()?k.player.getStatus().trackType===I.YOUTUBE?Jt()===!1?ce(k.player.getStatus().isPlaying):f("Loading next track, please wait...",3):Ee(null,v.nextPage):Ee(null,v.nextPage)}function Hr(){se(".playback-details-control","click",jr),se(".playback-thumbnail-control","click",zr),se(".playback-timer-control","click",Qr),k.isPlaybackReady=!0}function ha(){o.playback.autoExitFullscreen&&Z.exit()}function Xr(e){o.playback.autoExitFsOnWarning&&e.data.timeRemainingSeconds<=o.playback.timeRemainingSeconds&&Z.exit()}function Jr(){ve()||setTimeout(()=>{document.activeElement instanceof HTMLIFrameElement&&setTimeout(()=>{document.activeElement.blur(),document.activeElement instanceof HTMLIFrameElement&&document.activeElement.blur()},250)},0)}function jr(){M(k.player.getStatus().trackId),ve()&&o.list.showUpNextModal?ge("showUpNextModalHint","<b>Tip:</b> Click or tap Artist &amp; Title to show Up Next queue"):ge("showTrackDetailsHint","<b>Tip:</b> Click or tap Artist &amp; Title to show current track")}function zr(){Ft()?(La.add(u.MOUSE,p.MOUSE_CLICK,null),ge("showGalleryTrackThumbnailHint","<b>Tip:</b> Double click or tap Track Thumbnail for full screen"),La.doubleClicked(u.MOUSE,p.MOUSE_CLICK,Br.doubleClickDelay)&&Z.enter(document.getElementById(k.player.getStatus().iframeId))):ve()&&(M(0),ge("showListTrackThumbnailHint","<b>Tip:</b> Click or tap Track Thumbnail to show player"))}function Qr(){ze.toggle(),ge("showTrackTimerHint","<b>Tip:</b> Click or tap Track Timer to toggle Autoplay On / Off")}var yt=class extends Xe{elementClicked(){if(this.clicked("a.navbar-prev-link"))return Ee(this.event,v.prevPage);if(this.clicked("a.navbar-next-link"))return Et(this.event)}},gt=class extends Xe{elementClicked(){if(this.clicked("div.nav-previous a"))return Ee(this.event,v.prevPage);if(this.clicked("div.nav-next a"))return Et(this.event)}};function ge(e,t,a=0){o.tips[e]&&(f(t,a),o.tips[e]=!1)}function Ee(e,t){e?.preventDefault(),G(t,k.player.getStatus().isPlaying)}
//# sourceMappingURL=interaction.js.map
