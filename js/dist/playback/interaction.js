import{$ as ot,A as se,B as oe,C as W,D as O,E as k,F as He,G,H as ne,I as je,J as z,K as Y,L as v,M as le,N as Je,O as Xe,P as ze,Q,R as Qe,S as Ze,T as Le,U as et,V as x,W as tt,X as at,Y as M,Z as rt,_ as st,a as Fe,b as T,c as te,ca as ie,da as nt,e as ae,ea as lt,f as K,ga as it,ha as ce,ia as ct,ja as w,k as A,ka as N,l,la as ut,m as Ke,ma as ue,na as dt,oa as pt,p as m,pa as Ie,q as re,qa as yt,r as We,ra as gt,s as Ge,t as he,ta as Et,u as qe,ua as _,v as o,va as De,w as p,x as y,y as f,ya as ft,z as Ce,za as V}from"../chunk-3GSAMC3M.js";var ve=T("eventlogger"),c={UNKNOWN:1e3,KEYBOARD:100,MOUSE:110,YOUTUBE:1,SOUNDCLOUD:2,ULTRAFUNK:50},d={UNKNOWN:-2e3,KEY_ARROW_LEFT:180,KEY_ARROW_RIGHT:181,MOUSE_CLICK:182,STATE_ERROR:-5,STATE_UNSTARTED:-1,STATE_ENDED:0,STATE_PLAYING:1,STATE_PAUSED:2,STATE_BUFFERING:3,STATE_CUED:5,RESUME_AUTOPLAY:50,PLAYER_ERROR:60,CROSSFADE_START:70},Qt={eventSource:c.UNKNOWN,eventType:d.UNKNOWN,uId:null,timeStamp:0},de=class{constructor(t=10){this.log=[],this.maxEntries=t,this.lastPos=0,this.matchCount=0}add(t,a,s,u=Date.now()){let E=Object.create(Qt);E.eventSource=t,E.eventType=a,E.uId=s,E.timeStamp=u,this.log.length<this.maxEntries?this.log.push(E):(this.log.shift(),this.log.push(E))}clear(){this.log=[]}initMatch(){this.lastPos=this.log.length-1,this.matchCount=0}matchesEvent(t,a,s,u=null){this.log[this.lastPos-t].eventSource===a&&this.log[this.lastPos-t].eventType===s&&this.log[this.lastPos-t].uId===u&&this.matchCount++}matchesDelta(t,a){this.log[this.lastPos].timeStamp-this.log[this.lastPos-t].timeStamp<=a&&this.matchCount++}isPatternMatch(t,a){return this.matchCount===t?(ve.log(`MATCH for: ${a}`),ve.logEventLog(this.log,c,d),!0):!1}},pe=class extends de{constructor(t){super(t)}doubleClicked(t,a,s){return this.initMatch(),this.lastPos>=1&&(this.matchesEvent(1,t,a),this.matchesEvent(0,t,a),this.matchesDelta(1,s)),this.isPatternMatch(3,`${ve.getObjectKeyForValue(c,t)} Double Clicked`)}},q=class extends de{constructor(t){super(t)}ytAutoplayBlocked(t,a){return this.initMatch(),this.lastPos>=3&&(this.matchesEvent(3,c.ULTRAFUNK,d.RESUME_AUTOPLAY,null),this.matchesEvent(2,c.YOUTUBE,d.STATE_UNSTARTED,t),this.matchesEvent(1,c.YOUTUBE,d.STATE_BUFFERING,t),this.matchesEvent(0,c.YOUTUBE,d.STATE_UNSTARTED,t),this.matchesDelta(3,a)),this.isPatternMatch(5,"YouTube Autoplay Blocked")}scAutoplayBlocked(t,a){return this.initMatch(),this.lastPos>=3&&(this.matchesEvent(3,c.ULTRAFUNK,d.RESUME_AUTOPLAY,null),this.matchesEvent(2,c.SOUNDCLOUD,d.STATE_PLAYING,t),this.matchesEvent(1,c.SOUNDCLOUD,d.STATE_PAUSED,t),this.matchesEvent(0,c.SOUNDCLOUD,d.STATE_PAUSED,t),this.matchesDelta(3,a)),this.isPatternMatch(5,"SoundCloud Autoplay Blocked")}scWidgetPlayBlocked(t,a){return this.initMatch(),this.lastPos>=2&&(this.matchesEvent(2,c.SOUNDCLOUD,d.STATE_PLAYING,t),this.matchesEvent(1,c.SOUNDCLOUD,d.STATE_PAUSED,t),this.matchesEvent(0,c.SOUNDCLOUD,d.STATE_PAUSED,t),this.matchesDelta(2,a)),this.isPatternMatch(4,"SoundCloud WidgetPlay Blocked")}scPlayDoubleTrigger(t,a){return this.initMatch(),this.lastPos>=2&&(this.matchesEvent(2,c.ULTRAFUNK,d.CROSSFADE_START,null),this.matchesEvent(1,c.SOUNDCLOUD,d.STATE_PLAYING,t),this.matchesEvent(0,c.SOUNDCLOUD,d.STATE_PLAYING,t),this.matchesDelta(1,a)),this.isPatternMatch(4,"SoundCloud Play Double Trigger")}};var Me={};Fe(Me,{getStatus:()=>be,init:()=>xa,nextTrack:()=>xe,prevTrack:()=>It,toggleMute:()=>Dt,togglePlayPause:()=>me});var $=class{constructor(){this.intervalId=-1,this.lastPosSeconds=0,this.isVisible=!0,this.config={updateTimerInterval:250,maxBufferingDelay:3}}init(){document.addEventListener("visibilitychange",()=>{this.isVisible=document.visibilityState==="visible"})}start(){this.stop(),this.intervalId=setInterval(()=>{this.isVisible&&this.updateProxy()},this.config.updateTimerInterval)}stop(){this.intervalId!==-1&&(clearInterval(this.intervalId),this.intervalId=-1),this.lastPosSeconds=0,ne(!1)}updateTimeRemainingWarning(t,a){if(l.playback.autoplay===!1&&l.playback.timeRemainingWarning&&this.lastPosSeconds!==t){let s=a-t;this.lastPosSeconds=t,s<=l.playback.timeRemainingSeconds?(ne(!0),y(o.MEDIA_TIME_REMAINING,{timeRemainingSeconds:s})):ne(!1)}}};var Ne=class extends ${constructor(){super(),this.players=null,this.crossfadeInit=null}init(t,a){super.init(),this.players=t,this.crossfadeInit=a}updateProxy(){this.players.current.getPosition((t,a)=>this.updateCallback(t,a))}updateCallback(t,a=0){let s=Math.round(t/1e3);O(t,s,a),s>0&&a>0&&(super.updateTimeRemainingWarning(s,a),this.updateAutoCrossfade(s,a))}updateAutoCrossfade(t,a){l.playback.masterMute===!1&&l.playback.autoplay&&l.gallery.autoCrossfade&&a-t===l.gallery.autoCrossfadeLength+this.config.maxBufferingDelay&&this.players.getCurrentTrack()+1<=this.players.getNumTracks()&&this.crossfadeInit(ue.AUTO,{name:"Auto Crossfade",length:l.gallery.autoCrossfadeLength,curve:l.gallery.autoCrossfadeCurve})}},C=new Ne;var b=T("embedded-players"),D=new q(10),i={players:{},playbackState:null,embeddedEvent:null,loadEventsTotal:0,loadEventsCount:1},Ue={youTubeIframeIdRegEx:/youtube-uid/i,soundCloudIframeIdRegEx:/soundcloud-uid/i,maxPlaybackStartDelay:3};function kt(e,t,a){i.players=e,i.playbackState=t,i.embeddedEvent=a,i.loadEventsTotal=3+parseInt(document.body.getAttribute("data-gallery-track-count")),aa(),pa()}function ge(){return{loadingPercent:100*(i.loadEventsCount++/i.loadEventsTotal)}}function Tt(){i.loadEventsCount>=i.loadEventsTotal?i.embeddedEvent(o.READY,{resetProgressBar:!0}):y(o.LOADING,ge())}function ea(){document.querySelectorAll("single-track").forEach(t=>{let a=t.querySelector("iframe"),s=null;if(Ue.youTubeIframeIdRegEx.test(a.id)){let u=new YT.Player(a.id,{events:{onReady:E=>ra(E,a.id),onStateChange:E=>sa(E,a.id),onError:E=>da(E,a.id)}});s=new pt(t.id,a.id,u,t.getAttribute("data-track-source-data"))}else if(Ue.soundCloudIframeIdRegEx.test(a.id)){let u=SC.Widget(a.id);s=new Ie(t.id,a.id,u,a.src),u.bind(SC.Widget.Events.READY,()=>{s.setThumbnail(t.querySelector(".track-share-control span")),ya(s,a.id)}),u.bind(SC.Widget.Events.PLAY,ga),u.bind(SC.Widget.Events.PAUSE,Ea),u.bind(SC.Widget.Events.FINISH,fa),u.bind(SC.Widget.Events.ERROR,ka)}s!==null&&(s.setTitle(t.getAttribute("data-track-title")),s.setArtist(t.getAttribute("data-track-artist")),s.setDuration(parseInt(t.getAttribute("data-track-duration"))),i.players.add(s))})}function fe(e,t){b.log("onPlayerError()"),b.log(e);let a=e instanceof Ie?c.SOUNDCLOUD:c.YOUTUBE;i.players.isCurrent(e.getUid())===!1&&i.players.stop(),D.add(a,d.PLAYER_ERROR,e.getUid()),i.embeddedEvent(o.MEDIA_UNAVAILABLE,ta(e,t))}function ta(e,t){let a=e.getArtist()||"N/A",s=e.getTitle()||"N/A";return{currentTrack:i.players.trackFromUid(e.getUid()),numTracks:i.players.getNumTracks(),trackId:e.getTrackId(),mediaTitle:`${a} - ${s}`,mediaUrl:t}}function aa(){b.log("initYouTubeAPI()"),y(o.LOADING,ge()),window.onYouTubeIframeAPIReady=function(){b.log("onYouTubeIframeAPIReady()"),y(o.LOADING,ge()),ea()};let e=document.createElement("script");e.id="youtube-iframe-api",e.src="https://www.youtube.com/iframe_api";let t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}function ra(e,t){let a=i.players.playerFromUid(t);b.log(`onYouTubePlayerReady(): ${t} => ${e.target.getVideoData().video_id} => ${a.getArtist()} - ${a.getTitle()}`),Tt()}function sa(e,t){switch(D.add(c.YOUTUBE,e.data,t),e.data){case YT.PlayerState.UNSTARTED:oa(t);break;case YT.PlayerState.BUFFERING:na(t);break;case YT.PlayerState.PLAYING:la(e,t);break;case YT.PlayerState.PAUSED:ia(t);break;case YT.PlayerState.CUED:ca(t);break;case YT.PlayerState.ENDED:ua(t);break}}function oa(e){b.log(`onYouTubePlayerStateChange: UNSTARTED (uID: ${e})`),D.ytAutoplayBlocked(e,3e3)&&i.embeddedEvent(o.AUTOPLAY_BLOCKED)}function na(e){if(b.log(`onYouTubePlayerStateChange: BUFFERING (uID: ${e})`),i.players.crossfade.isFading()===!1){let t=i.players.playerFromUid(e);t.mute(l.playback.masterMute),t.setVolume(l.playback.masterVolume),y(o.MEDIA_LOADING)}}function la(e,t){b.log(`onYouTubePlayerStateChange: PLAYING   (uID: ${t})`),i.playbackState.syncAll(t,i.playbackState.STATE.PLAY),i.players.current.setDuration(Math.round(e.target.getDuration())),C.start()}function ia(e){b.log(`onYouTubePlayerStateChange: PAUSED    (uID: ${e})`),i.players.isCurrent(e)?(i.playbackState.syncAll(e,i.playbackState.STATE.PAUSE),C.stop()):i.players.crossfade.stop()}function ca(e){b.log(`onYouTubePlayerStateChange: CUED      (uID: ${e})`)}function ua(e){b.log(`onYouTubePlayerStateChange: ENDED     (uID: ${e})`),i.players.isCurrent(e)?(C.stop(),i.embeddedEvent(o.MEDIA_ENDED)):i.players.crossfade.stop()}function da(e,t){b.log("onYouTubePlayerError: "+e.data);let a=i.players.playerFromUid(t);a.setPlayable(!1),fe(a,e.target.getVideoUrl())}function pa(){b.log("initSoundCloudAPI()"),y(o.LOADING,ge())}function ya(e,t){b.log(`onSCPlayerEventReady(): ${t} => ${e.getUid()} => ${e.getArtist()} - ${e.getTitle()}`),Tt()}function ga(e){b.log(`onSoundCloudPlayerEvent: PLAY   (uID: ${e.soundId})`),D.add(c.SOUNDCLOUD,d.STATE_PLAYING,e.soundId),i.players.crossfade.isFading()&&i.players.isCurrent(e.soundId)?D.scPlayDoubleTrigger(e.soundId,Ue.maxPlaybackStartDelay*1e3)&&i.playbackState.syncAll(e.soundId,i.playbackState.STATE.PLAY):(i.playbackState.syncAll(e.soundId,i.playbackState.STATE.PLAY),i.players.current.mute(l.playback.masterMute),i.players.current.setVolume(l.playback.masterVolume)),i.players.current.getEmbeddedPlayer().getDuration(t=>{i.players.current.setDuration(Math.round(t/1e3)),C.start()})}function Ea(e){b.log(`onSoundCloudPlayerEvent: PAUSE  (uID: ${e.soundId})`),D.add(c.SOUNDCLOUD,d.STATE_PAUSED,e.soundId),D.scAutoplayBlocked(e.soundId,3e3)?(C.stop(),i.embeddedEvent(o.AUTOPLAY_BLOCKED)):D.scWidgetPlayBlocked(e.soundId,3e4)?(C.stop(),i.embeddedEvent(o.PLAYBACK_BLOCKED,{currentTrack:i.players.trackFromUid(e.soundId),numTracks:i.players.getNumTracks()})):i.players.isCurrent(e.soundId)?i.players.current.getPosition(t=>{t>0&&(i.playbackState.syncAll(e.soundId,i.playbackState.STATE.PAUSE),C.stop())}):i.players.crossfade.stop()}function fa(e){b.log(`onSoundCloudPlayerEvent: FINISH (uID: ${e.soundId})`),i.players.isCurrent(e.soundId)?(C.stop(),i.embeddedEvent(o.MEDIA_ENDED)):i.players.crossfade.stop()}function ka(){this.getCurrentSound(e=>{let t=i.players.playerFromUid(e.id);b.log(`onSoundCloudPlayerEvent: ERROR for track: ${i.players.trackFromUid(e.id)}. ${t.getArtist()} - ${t.getTitle()} - [${t.getUid()} / ${t.getIframeId()}]`),t.setPlayable(!1)})}var L=T("gallery-events"),ke={snackbarId:0,nowPlayingIcons:null},Re={nowPlayingIconsSelector:"h2.entry-title"};function mt(){L.log("init()"),ke.nowPlayingIcons=document.querySelectorAll(Re.nowPlayingIconsSelector),p(o.MEDIA_PLAYING,ma),p(o.MEDIA_PAUSED,ba),p(o.MEDIA_ENDED,Sa),p(o.MEDIA_SHOW,Pa),p(o.CONTINUE_AUTOPLAY,Aa),p(o.RESUME_AUTOPLAY,ha),p(o.AUTOPLAY_BLOCKED,Ca),p(o.PLAYBACK_BLOCKED,La),p(o.MEDIA_UNAVAILABLE,Ia)}function ma(e){if(L.log(e),re(ke.snackbarId),e.data.numTracks>1){let t=document.querySelector(`#${e.data.trackId} ${Re.nowPlayingIconsSelector}`);bt(t),V(t,"playing-paused","now-playing-icon"),l.gallery.animateNowPlayingIcon&&t.classList.add("playing-animate")}}function ba(e){L.log(e),e.data.numTracks>1&&document.querySelector(`#${e.data.trackId} ${Re.nowPlayingIconsSelector}`).classList.add("playing-paused")}function Sa(e){L.log(e),e!==null&&e.data.numTracks>1&&bt()}function Pa(e){L.log(e),W(0),e.data.scrollToMedia&&N(e.data.trackId)}function Aa(e){L.log(e),w(A.nextPage,!0)}function ha(e){let t=JSON.parse(sessionStorage.getItem(K.UF_AUTOPLAY));if(sessionStorage.removeItem(K.UF_AUTOPLAY),L.log(e),L.log(`RESUME_AUTOPLAY: ${t!==null?JSON.stringify(t):"NO"}`),t!==null){let a=document.getElementById(t.trackId)?.querySelector("iframe").id;e.callback.resumeAutoplay(t,a)}}function Ca(e){L.log(e),ke.snackbarId=m("Autoplay blocked, Play to continue",0,"play",()=>e.callback.togglePlayPause())}function La(e){L.log(e),m("Unable to play track, skipping to next",5,"Stop",()=>{},()=>Oe(e))}function Ia(e){L.log(e),Da(e.data.trackId)?m("YouTube Premium track, skipping",5,"help",()=>window.location.href="/channel/premium/",()=>Oe(e)):(m("Unable to play track, skipping to next",5,"Stop",()=>{},()=>Oe(e)),te("EVENT_MEDIA_UNAVAILABLE",e.data))}function bt(e){ke.nowPlayingIcons.forEach(t=>{t!==e&&t.classList.remove("now-playing-icon","playing-animate","playing-paused")})}function Oe(e){e.data.currentTrack<e.data.numTracks?e.callback.skipToTrack(e.data.currentTrack+1,!0):A.nextPage!==null&&w(A.nextPage,!0)}function Da(e){let t=document.getElementById(e);return t!==null?t.classList.contains("uf_channel-premium"):!1}var Ye=T("crossfade-controls"),Te={players:{}},h={},B={crossfadePresetSelector:".crossfade-preset-control",crossfadePresetData:"data-crossfade-preset",crossfadeToSelector:".crossfade-fadeto-control"};function Pt(e,t){Ye.log("init()"),Te.players=e,h.crossfadePreset=new Ce(B.crossfadePresetSelector),h.crossfadeTo=new Ce(B.crossfadeToSelector),h.crossfadePreset.length>1&&h.crossfadeTo.length>1&&(h.crossfadePreset.forEach(a=>At(a,l.gallery.trackCrossfadeDefPreset)),h.crossfadeTo.clickCallback=t),p(o.READY,Na)}function Na(){Ye.log("ready()"),h.crossfadePreset.length>1&&h.crossfadeTo.length>1&&(h.crossfadePreset.forEach(e=>{e.addEventListener("click",Ua),V(e,f.DISABLED.CLASS,f.ENABLED.CLASS)}),h.crossfadeTo.forEach(e=>e.addEventListener("click",Oa)),p(o.MEDIA_PLAYING,St),p(o.MEDIA_PAUSED,St))}function At(e,t){e.setAttribute(B.crossfadePresetData,t),e.textContent=`${t+1}`,e.title=`Preset: ${ae.crossfade[t].name}`}function Ua(e){let t=parseInt(e.target.getAttribute(B.crossfadePresetData));At(e.target,t+1<ae.crossfade.length?t+1:0)}function Oa(e){if(k()&&Te.players.crossfade.isFading()===!1){let t=e.target.closest("single-track");if(t!==null){let a=t.querySelector("iframe"),s=parseInt(t.querySelector(B.crossfadePresetSelector).getAttribute(B.crossfadePresetData));V(t.querySelector(`div${B.crossfadeToSelector}`),f.ENABLED.CLASS,f.DISABLED.CLASS),h.crossfadeTo.clickCallback(Te.players.uIdFromIframeId(a.id),ae.crossfade[s])}}}function St(){let e=k(),t=e?Te.players.getTrackData().currentTrack:-1;Ye.log(`updateCrossfadeToState() - playingState: ${e} - currentTrack: ${t}`),h.crossfadeTo.forEach((a,s)=>{t===s+1?V(a,e?f.ENABLED.CLASS:f.DISABLED.CLASS,e?f.DISABLED.CLASS:f.ENABLED.CLASS):V(a,e?f.DISABLED.CLASS:f.ENABLED.CLASS,e?f.ENABLED.CLASS:f.DISABLED.CLASS)})}var ht=T("gallery-players"),Ct=()=>{let e=null,t=null,a=[],s=new Map,u=0;return{indexMap:s,get crossfade(){return t},get current(){return a[u]},get next(){return a[u+1]},getPlayerIndex(){return u},setPlayerIndex(g){u=g},getNumTracks(){return a.length},getCurrentTrack(){return u+1},playerFromUid(g){return a[s.get(g)]},trackFromUid(g){return s.get(g)+1},isCurrent(g){return g===this.current.getUid()},init:E,add:X,uIdFromIframeId:U,stop:Gt,mute:qt,getTrackData:Ht,prevTrack:jt,nextTrack:Jt,jumpToTrack:Xt};function E(g){ht.log("init()"),e=g,t=dt(this),p(o.MEDIA_PLAYING,()=>t.start()),p(o.MEDIA_PAUSED,()=>t.stop())}function X(g){ht.log(g),a.push(g),s.set(g.getUid(),a.length-1)}function U(g){return a.find(Ae=>Ae.iframeId===g).getUid()}function Gt(){this.current.stop(),t.stop()}function qt(){this.current.mute(l.playback.masterMute),t.mute(l.playback.masterMute)}function Ht(){return{currentTrack:this.getCurrentTrack(),numTracks:this.getNumTracks(),artist:this.current.getArtist(),title:this.current.getTitle(),duration:this.current.getDuration(),thumbnail:{src:this.current.getThumbnailSrc(),class:this.current.getThumbnailClass()}}}function jt(g){return u>0?(u--,e(g),!0):!1}function Jt(g){return u++,u<this.getNumTracks()?(e(g),!0):!1}function Xt(g,Ae,zt=!0){return g>0&&g<=this.getNumTracks()?(u=g-1,e(Ae,zt),!0):!1}};var P=T("gallery-playback"),r={eventLog:null,players:{}},Lt={minCrossfadeToTime:5,maxBufferingDelay:3};function xa(){P.log("init()"),r.eventLog=D,mt(),r.players=Ct(),r.players.init(vt),se(r.players,wa),Pt(r.players,$a),C.init(r.players,Ut),kt(r.players,Ot,Ba)}function me(){k()?(G(),r.players.current.pause()):(He(),r.players.current.play(fe))}function It(){P.log(`prevTrack() - prevTrack: ${r.players.getCurrentTrack()-1} - numTracks: ${r.players.getNumTracks()}`),r.players.getCurrentTrack()>0&&r.players.current.getPosition(e=>{e>5e3?(r.players.current.seekTo(0),O(0,0,r.players.current.getDuration())):(r.players.getCurrentTrack()>1&&r.players.stop(),r.players.prevTrack(k())&&z())})}function xe(e=!1){let t=r.players.getCurrentTrack()+1>r.players.getNumTracks();P.log(`nextTrack() - isMediaEnded: ${e} - isLastTrack: ${t} - autoplay: ${l.playback.autoplay}`),!Ma(e,t)&&(t===!1?(r.players.stop(),e&&l.playback.autoplay===!1?G():r.players.nextTrack(k())&&Y()):e&&(G(),l.playback.autoplay?y(o.CONTINUE_AUTOPLAY):r.players.stop()))}function Ma(e,t){if(e&&l.playback.autoplay){let a=le();if(P.log(`repeatPlayback(): ${P.getObjectKeyForValue(v,a)}`),a===v.ONE)return r.players.current.seekTo(0),r.players.current.play(),!0;if(t&&a===v.ALL)return r.players.stop(),r.players.setPlayerIndex(0),vt(!0),!0}return!1}function wa(e){r.players.current.seekTo(e)}function Dt(){l.playback.masterMute=l.playback.masterMute!==!0,r.players.mute()}function _a(e,t=!0){P.log(`cueTrack(): ${e}`),r.players.setPlayerIndex(r.players.indexMap.get(e)),y(o.MEDIA_SHOW,{scrollToMedia:t,trackId:r.players.current.getTrackId()}),Y()}function vt(e,t=!0){y(o.MEDIA_SHOW,{scrollToMedia:t,trackId:r.players.current.getTrackId()}),e&&r.players.current.play(fe)}function Nt(e,t=!0){P.log(`skipToTrack(): ${e} - ${t}`),t===!0&&k()===!1&&(r.eventLog.clear(),r.eventLog.add(c.ULTRAFUNK,d.RESUME_AUTOPLAY,null),r.players.jumpToTrack(e,t)&&Y())}function Va(e,t=null){P.log(`resumeAutoplay(): ${e.autoplay}${t!==null?" - "+t:""}`),t!==null?e.autoplay?Nt(r.players.trackFromUid(t),!0):_a(t):e.autoplay&&(r.eventLog.add(c.ULTRAFUNK,d.RESUME_AUTOPLAY,null),me())}function be(){return{isPlaying:k(),currentTrack:r.players.getCurrentTrack(),position:0,numTracks:r.players.getNumTracks(),trackId:r.players.current.getTrackId(),iframeId:r.players.current.getIframeId()}}function $a(e,t){r.players.isCurrent(e)===!1&&r.players.current.getDuration()>0&&(P.log(`crossfadeToClick():
      fadeOut: ${r.players.current.getArtist()} - "${r.players.current.getTitle()}" (${r.players.current.getUid()})
      fadeIn.: ${r.players.playerFromUid(e).getArtist()} - "${r.players.playerFromUid(e).getTitle()}" (${e})`),l.playback.masterMute===!1&&l.playback.autoplay===!1&&r.players.current.getPosition(a=>{r.players.current.getDuration()-a/1e3>=Lt.minCrossfadeToTime+Lt.maxBufferingDelay&&Ut(ue.TRACK,t,e)}))}function Ut(e,t,a=null){r.eventLog.add(c.ULTRAFUNK,d.CROSSFADE_START,null);let s=r.players.crossfade.init(e,t,a);s!==null&&Ot.syncControls(s.fadeOutPlayer,s.fadeInPlayer)}function Ba(e,t=null){switch(P.log(`embeddedEventHandler() - event: ${P.getObjectKeyForValue(o,e)}`),t!==null&&P.log(t),e){case o.MEDIA_ENDED:y(o.MEDIA_ENDED,be()),xe(!0);break;case o.READY:oe(It,me,xe,Dt),y(o.READY,t),y(o.RESUME_AUTOPLAY,null,{resumeAutoplay:Va});break;case o.AUTOPLAY_BLOCKED:y(o.AUTOPLAY_BLOCKED,null,{togglePlayPause:me});break;case o.PLAYBACK_BLOCKED:case o.MEDIA_UNAVAILABLE:y(e,t,{skipToTrack:Nt});break}}var Ot=(()=>{let e={PLAY:1,PAUSE:2},t=function s(u,E){if(P.log(`playbackState.syncAll() - previousTrack: ${r.players.getPlayerIndex()+1} - nextTrack: ${r.players.indexMap.get(u)+1} - syncState: ${P.getObjectKeyForValue(e,E)}`),r.players.isCurrent(u))E===e.PLAY?y(o.MEDIA_PLAYING,be()):E===e.PAUSE&&y(o.MEDIA_PAUSED,be());else{let X=r.players.getPlayerIndex(),U=r.players.indexMap.get(u);r.players.stop(),r.players.setPlayerIndex(U),a(X,U),s(u,E)}};function a(s,u){u>s?Y():z()}return{STATE:e,syncAll:t,syncControls:a}})();var Be={};Fe(Be,{getStatus:()=>Ha,init:()=>Ka,nextTrack:()=>xt,prevTrack:()=>Yt,toggleMute:()=>Ve,togglePlayPause:()=>$e});var we=class extends ${constructor(){super(),this.player=null}ready(t){super.init(),this.player=t,p(o.MEDIA_PLAYING,()=>super.start())}updateProxy(){k()&&this.update(this.player.embedded.getCurrentTime(),this.player.getDuration())}update(t,a){if(t!==void 0){let s=Math.round(t);O(t*1e3,s,a),s>0&&a>0&&super.updateTimeRemainingWarning(s,a)}}},_e=new we;var I=T("list-playback"),H=new q(10),n={player:null,autoplayData:null,playerReady:!1,firstStatePlaying:!0,currentTrackId:null,currentSnackbarId:0};function Ka(){I.log("init()"),Xe(F),Wa()!==null?ja():m("No playable YouTube tracks!",0,"help",()=>window.location.href="/help/#list-player")}function Wa(){if(n.currentTrackId=x(),n.autoplayData=JSON.parse(sessionStorage.getItem(K.UF_AUTOPLAY)),sessionStorage.removeItem(K.UF_AUTOPLAY),n.currentTrackId!==null){if(n.autoplayData!==null&&n.autoplayData.trackId!==null){let e=n.autoplayData.trackId.match(gt);if(e!==null){let t=Q(`[data-track-source-uid="${e[0]}"]`);t!==null&&(n.currentTrackId=t.id)}else if(n.autoplayData.trackId.match(/^track-(?!0)\d{1,9}$/i)!==null){let t=Q(`[data-track-id="${n.autoplayData.trackId}"]`);t!==null?Le(t)===ie.YOUTUBE?n.currentTrackId=t.id:m("Cannot play SoundCloud track",5,"help",()=>window.location.href="/help/#list-player"):m("Unable to cue track (not found)",5)}}tt(n.currentTrackId)}return I.log(`cueInitialTrack() - currentTrackId: ${n.currentTrackId} - autoplayData: ${n.autoplayData!==null?JSON.stringify(n.autoplayData):"N/A"}`),n.currentTrackId}function F(e,t=!0,a=!1){let s=Le(Ze(e));if(I.log(`setCurrentTrack() - nextTrackType: ${I.getObjectKeyForValue(ie,s)} - nextTrackId: ${e} - playNextTrack: ${t} - isPointerClick: ${a}`),s===ie.SOUNDCLOUD&&a){m("Cannot play SoundCloud track",5,"help",()=>window.location.href="/help/#list-player");return}e===n.currentTrackId?$e():(k()&&n.player.embedded.stopVideo(),n.currentTrackId=e,rt(e,a),Rt(t))}function Rt(e){let t=ot();e?(n.player.embedded.loadVideoById(t),M(f.PLAYING),je()):(n.player.embedded.cueVideoById(t),M(f.PAUSED))}function $e(){n.currentTrackId===null?F(Q("div.track-entry.current").id):k()?n.player.embedded.pauseVideo():n.player.play(Se)}function Ve(e=!1){e===!1&&(l.playback.masterMute=l.playback.masterMute!==!0),l.playback.masterMute?n.player.embedded.mute():n.player.embedded.unMute()}function Yt(){let e=et(),t=n.player.embedded.getCurrentTime();e!==null&&t<=5?(F(e,k()),z()):t!==0&&(n.player.embedded.seekTo(0),O(0,0,n.player.getDuration()))}function xt(){let e=x();e!==null&&(F(e,k()),Y())}async function Mt(e=!1,t=!1){let a=t?v.OFF:le(),s=x();if(I.log(`advanceToNextTrack() autoplay: ${e} - isPlaybackError: ${t} - nextTrackId: ${s} - repeatMode: ${I.getObjectKeyForValue(v,a)}`),e&&a===v.ONE)n.player.embedded.seekTo(0),n.player.play(Se);else if(e&&s===null&&a===v.ALL)F(x(null)),N(0);else if(s===null)if(l.list.showLoadMoreTracks){let u=await at();e&&u&&F(x())}else w(A.nextPage,e);else e?F(s):M(f.PAUSED)}function Ga(){k()===!1&&n.autoplayData!==null&&(H.add(c.ULTRAFUNK,d.RESUME_AUTOPLAY,null),H.add(c.YOUTUBE,-1,x())),k()===!1&&Mt(!0,!0)}function qa(){n.currentTrackId=null,M(f.PAUSED)}function Ha(){let e=Q("div.track-entry.current");if(e!==null){let t=Qe("div.track-entry"),a=Array.prototype.indexOf.call(t,e);return{isPlaying:k(),currentTrack:a+1,position:Math.ceil(n.player.embedded.getCurrentTime()),numTracks:n.player.getNumTracks(),trackId:t[a].getAttribute("data-track-id"),iframeId:"youtube-player"}}return{isPlaying:!1,currentTrack:1,position:0,trackId:0}}function ja(){I.log("initYouTubeAPI()"),window.onYouTubeIframeAPIReady=function(){I.log("onYouTubeIframeAPIReady()");let a=new YT.Player("youtube-player",{events:{onReady:Ja,onStateChange:Xa,onError:Se}});n.player=new yt(a),se(n.player,s=>n.player.embedded.seekTo(s)),W(33)};let e=document.createElement("script");e.id="youtube-iframe-api",e.src="https://www.youtube.com/iframe_api";let t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}function Ja(){I.log("onYouTubePlayerReady()"),n.autoplayData?.autoplay===!0&&H.add(c.ULTRAFUNK,d.RESUME_AUTOPLAY,null),oe(Yt,$e,xt,Ve),W(66),_e.ready(n.player),ze(n.player),Ve(!0),y(o.READY,{resetProgressBar:!1}),Rt(n.autoplayData?.autoplay===!0)}function Xa(e){switch(I.log(`onYouTubePlayerStateChange(): ${e.data} - trackId: ${n.currentTrackId}`),H.add(c.YOUTUBE,e.data,n.currentTrackId),e.data!==YT.PlayerState.PLAYING&&G(),e.data){case YT.PlayerState.UNSTARTED:za();break;case YT.PlayerState.CUED:n.player.setPlayerState(e.data);break;case YT.PlayerState.BUFFERING:y(o.MEDIA_LOADING);break;case YT.PlayerState.PLAYING:Qa(e),y(o.MEDIA_PLAYING);break;case YT.PlayerState.PAUSED:M(f.PAUSED);break;case YT.PlayerState.ENDED:_e.stop(),y(o.MEDIA_ENDED),Mt(l.playback.autoplay);break}}function za(){H.ytAutoplayBlocked(n.currentTrackId,3e3)&&(M(f.PAUSED),n.currentSnackbarId=m("Autoplay blocked, Play to continue",0,"play",()=>n.player.play(Se))),n.playerReady===!1&&(n.playerReady=!0,W(0))}function Qa(e){re(n.currentSnackbarId),n.player.setDuration(Math.round(e.target.getDuration())),n.firstStatePlaying&&(n.firstStatePlaying=!1,n.autoplayData=null,setTimeout(()=>{l.playback.autoplay&&k()&&Math.round(window.pageYOffset)<=1&&ft(Et.SITE_MAX_WIDTH_MOBILE)&&N(0)},6e3))}function Se(e){I.log(`onYouTubePlayerError(): ${e.data} - trackId: ${n.currentTrackId}`),st("Error!"),H.add(c.YOUTUBE,d.PLAYER_ERROR,n.currentTrackId),m("Unable to play track, skipping to next",5,"Stop",qa,Ga),te("EVENT_MEDIA_UNAVAILABLE",{mediaUrl:n.player.embedded.getVideoUrl(),mediaTitle:`${n.player.getArtist()} - ${n.player.getTitle()}`})}var j=T("screen-wakelock"),Pe={wakeLock:null};function wt(){return"wakeLock"in navigator&&"request"in navigator.wakeLock}async function _t(){wt()?document.visibilityState==="visible"&&await $t()!==!0&&j.log("enable(): Screen Wake Lock request failed"):(j.log("enable(): Screen Wake Lock is not supported"),m("Keep Screen On is not supported",5,"Disable",()=>l.mobile.keepScreenOn=!1))}function Vt(){j.log("stateVisible()"),wt()&&Pe.wakeLock===null&&$t()}async function $t(){try{return Pe.wakeLock=await navigator.wakeLock.request("screen"),j.log("request(): Screen Wake Lock is Enabled"),Pe.wakeLock.addEventListener("release",()=>{j.log("request(): Screen Wake Lock was Released"),Pe.wakeLock=null}),!0}catch(e){j.error(`request(): ${e.name} - ${e.message}`)}return!1}var Kt=T("playback-interaction"),Bt=new pe(10),S={player:null,isPlaybackReady:!1},er={doubleClickDelay:500};document.addEventListener("DOMContentLoaded",()=>{Kt.log("DOMContentLoaded"),Ke(),nt()?S.player=Me:lt()&&(S.player=Be),S.player!==null&&tr(),qe(S.player?.getStatus)});function tr(){Kt.log("initShared()"),ar(),S.player.init(),ee.init(),Wt.init(),rr()}function ar(){p(o.READY,or),p(o.MEDIA_SHOW,Ft),p(o.MEDIA_ENDED,Ft),p(o.MEDIA_TIME_REMAINING,nr)}function rr(){_(".playback-shuffle-control span","click",ct),De("span.navbar-arrow-back","click",J,A.prevPage),De("span.navbar-arrow-fwd","click",J,A.nextPage),_("nav.track-navigation .nav-previous a","click",J,A.prevPage),_("nav.track-navigation .nav-next a","click",J,A.nextPage),document.addEventListener("keydown",sr),window.addEventListener("blur",lr)}function sr(e){if(S.isPlaybackReady&&Wt.allow()&&e.repeat===!1&&e.ctrlKey===!1&&e.altKey===!1){switch(e.code){case"Backquote":e.preventDefault(),N(S.player.getStatus().trackId);break}switch(e.key){case" ":e.preventDefault(),S.player.togglePlayPause();break;case"Home":case"End":case"PageUp":case"PageDown":ut(e);break;case"ArrowLeft":e.preventDefault(),e.shiftKey===!0?J(null,A.prevPage):S.player.prevTrack();break;case"ArrowRight":e.preventDefault(),e.shiftKey===!0?J(null,A.nextPage):S.player.nextTrack();break;case"A":he.toggle();break;case"f":case"F":e.preventDefault(),ee.toggle(document.getElementById(S.player.getStatus().iframeId));break;case"m":case"M":e.preventDefault(),S.player.toggleMute(),m(l.playback.masterMute?"Volume is muted (<b>m</b> to unmute)":"Volume is unmuted (<b>m</b> to mute)",3);break;case"p":case"P":We.toggle();break;case"r":case"R":m(`${Je().title} (<b>r</b> to change)`,3);break;case"x":case"X":Ge.toggle();break}}}function or(){_(".playback-details-control","click",ir),_(".playback-thumbnail-control","click",cr),_(".playback-timer-control","click",ur),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&l.mobile.keepScreenOn&&Vt()}),l.mobile.keepScreenOn&&_t(),S.isPlaybackReady=!0}function Ft(){l.playback.autoExitFullscreen&&ee.exit()}function nr(e){l.playback.autoExitFsOnWarning&&e.data.timeRemainingSeconds<=l.playback.timeRemainingSeconds&&ee.exit()}function lr(){ce()||setTimeout(()=>{document.activeElement instanceof HTMLIFrameElement&&setTimeout(()=>{document.activeElement.blur(),document.activeElement instanceof HTMLIFrameElement&&document.activeElement.blur()},250)},0)}function ir(){N(S.player.getStatus().trackId),ce()&&l.list.showUpNextModal?Z("showUpNextModalHint","<b>Tip:</b> Click or tap Artist &amp; Title to show Up Next queue"):Z("showTrackDetailsHint","<b>Tip:</b> Click or tap Artist &amp; Title to show current track")}function cr(){it()?(Bt.add(c.MOUSE,d.MOUSE_CLICK,null),Z("showGalleryTrackThumbnailHint","<b>Tip:</b> Double click or tap Track Thumbnail for full screen"),Bt.doubleClicked(c.MOUSE,d.MOUSE_CLICK,er.doubleClickDelay)&&ee.enter(document.getElementById(S.player.getStatus().iframeId))):ce()&&(N(0),Z("showListTrackThumbnailHint","<b>Tip:</b> Click or tap Track Thumbnail to show player"))}function ur(){he.toggle(),Z("showTrackTimerHint","<b>Tip:</b> Click or tap Track Timer to toggle Autoplay On / Off")}function Z(e,t,a=0){l.tips[e]&&(m(t,a),l.tips[e]=!1)}function J(e,t){e?.preventDefault(),w(t,S.player.getStatus().isPlaying)}var ee=(()=>{let e=new Event("fullscreenElement"),t=null;return{init:a,enter:u,exit:E,toggle:X};function a(){document.addEventListener("fullscreenchange",s),document.addEventListener("webkitfullscreenchange",s)}function s(){t=document.fullscreenElement!==null?document.fullscreenElement.id:null,e.fullscreenTarget=t,document.dispatchEvent(e)}function u(U){U.requestFullscreen()}function E(){t!==null&&(document.exitFullscreen(),t=null)}function X(U){t===null?u(U):E()}})(),Wt=(()=>{let e=!1;return{allow(){return e},init:t};function t(){e=l.playback.keyboardShortcuts,document.addEventListener("allowKeyboardShortcuts",()=>{l.playback.keyboardShortcuts&&(e=!0)}),document.addEventListener("denyKeyboardShortcuts",()=>{l.playback.keyboardShortcuts&&(e=!1)})}})();
//# sourceMappingURL=interaction.js.map
