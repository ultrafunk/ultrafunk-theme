import{$ as g,A as C,Aa as K,B as Xe,Ba as dt,C as Ce,Ca as yt,D as Je,Da as gt,E as je,Ea as Et,F as ze,G as j,Ga as kt,Ha as De,Ia as Tt,Ja as $,K as Qe,Ka as ce,L as w,La as O,Ma as ft,Na as q,Oa as mt,Pa as bt,Qa as Ie,Ra as At,Sa as L,T as Ze,Ta as z,Ua as Pt,Va as St,W as he,Wa as Q,Xa as Ct,Y as re,Z as et,_ as s,a as Ge,aa as d,ba as T,c as b,ca as Le,d as We,da as tt,ea as se,fa as oe,ga as at,ha as _,i as ee,ia as h,j as G,ja as f,ka as rt,la as W,ma as ne,na as Y,oa as le,pa as st,qa as ot,r as P,ra as nt,s as o,sa as ie,t as qe,ta as lt,ua as it,v as A,va as ve,wa as ct,x as te,xa as x,y as ae,ya as ut,z as He,za as pt}from"../chunk-3KCZMWDH.js";var Ue=b("eventlogger"),c={UNKNOWN:1e3,KEYBOARD:100,MOUSE:110,YOUTUBE:1,SOUNDCLOUD:2,ULTRAFUNK:50},u={UNKNOWN:-2e3,KEY_ARROW_LEFT:180,KEY_ARROW_RIGHT:181,MOUSE_CLICK:182,STATE_ERROR:-5,STATE_UNSTARTED:-1,STATE_ENDED:0,STATE_PLAYING:1,STATE_PAUSED:2,STATE_BUFFERING:3,STATE_CUED:5,RESUME_AUTOPLAY:50,PLAYER_ERROR:60,CROSSFADE_START:70,CUE_PLAY_SINGLE_TRACK:80},ia={eventSource:c.UNKNOWN,eventType:u.UNKNOWN,uId:null,timeStamp:0},ue=class{#e=[];#t=0;#r=0;#a=0;constructor(t=10){this.#t=t}add(t,a,l=null,p=Date.now()){let k=Object.create(ia);k.eventSource=t,k.eventType=a,k.uId=l,k.timeStamp=p,this.#e.length<this.#t?this.#e.push(k):(this.#e.shift(),this.#e.push(k))}clear(){this.#e=[]}getLastPos(){return this.#a}initMatch(){this.#a=this.#e.length-1,this.#r=0}matchesEvent(t,a,l,p=null){this.#e[this.#a-t].eventSource===a&&this.#e[this.#a-t].eventType===l&&this.#e[this.#a-t].uId===p&&this.#r++}matchesDelta(t,a){this.#e[this.#a].timeStamp-this.#e[this.#a-t].timeStamp<=a&&this.#r++}isPatternMatch(t,a){return this.#r===t?(Ue.log(`MATCH for: ${a}`),Ue.logEventLog(this.#e,c,u),!0):!1}},pe=class extends ue{doubleClicked(t,a,l){return this.initMatch(),this.getLastPos()>=1&&(this.matchesEvent(1,t,a),this.matchesEvent(0,t,a),this.matchesDelta(1,l)),this.isPatternMatch(3,`${Ue.getKeyForValue(c,t)} Double Clicked`)}},H=class extends ue{ytAutoplayBlocked(t,a){return this.initMatch(),this.getLastPos()>=3&&(this.matchesEvent(3,c.ULTRAFUNK,u.RESUME_AUTOPLAY,null),this.matchesEvent(2,c.YOUTUBE,u.STATE_UNSTARTED,t),this.matchesEvent(1,c.YOUTUBE,u.STATE_BUFFERING,t),this.matchesEvent(0,c.YOUTUBE,u.STATE_UNSTARTED,t),this.matchesDelta(3,a)),this.isPatternMatch(5,"YouTube Autoplay Blocked")}ytSingleTrackAutoplayBlocked(t,a){return this.initMatch(),this.getLastPos()>=3&&(this.matchesEvent(3,c.ULTRAFUNK,u.CUE_PLAY_SINGLE_TRACK,null),this.matchesEvent(2,c.ULTRAFUNK,u.RESUME_AUTOPLAY,null),this.matchesEvent(1,c.YOUTUBE,u.STATE_BUFFERING,t),this.matchesEvent(0,c.YOUTUBE,u.STATE_UNSTARTED,t),this.matchesDelta(3,a)),this.isPatternMatch(5,"YouTube Single Track Autoplay Blocked")}scAutoplayBlocked(t,a){return this.initMatch(),this.getLastPos()>=3&&(this.matchesEvent(3,c.ULTRAFUNK,u.RESUME_AUTOPLAY,null),this.matchesEvent(2,c.SOUNDCLOUD,u.STATE_PLAYING,t),this.matchesEvent(1,c.SOUNDCLOUD,u.STATE_PAUSED,t),this.matchesEvent(0,c.SOUNDCLOUD,u.STATE_PAUSED,t),this.matchesDelta(3,a)),this.isPatternMatch(5,"SoundCloud Autoplay Blocked")}scWidgetPlayBlocked(t,a){return this.initMatch(),this.getLastPos()>=2&&(this.matchesEvent(2,c.SOUNDCLOUD,u.STATE_PLAYING,t),this.matchesEvent(1,c.SOUNDCLOUD,u.STATE_PAUSED,t),this.matchesEvent(0,c.SOUNDCLOUD,u.STATE_PAUSED,t),this.matchesDelta(2,a)),this.isPatternMatch(4,"SoundCloud WidgetPlay Blocked")}scPlayDoubleTrigger(t,a){return this.initMatch(),this.getLastPos()>=2&&(this.matchesEvent(2,c.ULTRAFUNK,u.CROSSFADE_START,null),this.matchesEvent(1,c.SOUNDCLOUD,u.STATE_PLAYING,t),this.matchesEvent(0,c.SOUNDCLOUD,u.STATE_PLAYING,t),this.matchesDelta(1,a)),this.isPatternMatch(4,"SoundCloud Play Double Trigger")}};var _e={};Ge(_e,{getStatus:()=>me,init:()=>Wa,nextTrack:()=>Oe,prevTrack:()=>Vt,setVolume:()=>Xa,toggleMute:()=>Bt,togglePlayPause:()=>fe});var X=class{#e=-1;#t=0;isVisible=!0;config={updateTimerInterval:250,maxBufferingDelay:3};init(){document.addEventListener("visibilitychange",()=>{this.isVisible=document.visibilityState==="visible"})}updateTimer(){}updateVolumeMute(){}start(){this.stop(),this.#e=setInterval(()=>this.updateTimer(),this.config.updateTimerInterval)}stop(){this.#e!==-1&&(clearInterval(this.#e),this.#e=-1),this.#t=0,ne(!1)}updateOncePerSecond(t,a){if(this.#t!==t&&(this.#t=t,this.updateVolumeMute(),o.playback.autoplay===!1&&o.playback.timeRemainingWarning)){let l=a-t;l<=o.playback.timeRemainingSeconds?(ne(!0),d(s.MEDIA_TIME_REMAINING,{timeRemainingSeconds:l})):ne(!1)}}};var Ne=class extends X{#e=null;#t=null;#r(t,a=0){let l=Math.round(t/1e3);_(t,l,a),l>0&&a>0&&(super.updateOncePerSecond(l,a),this.#s(l,a))}#a(){return o.playback.autoplay&&o.gallery.autoCrossfade}#s(t,a){o.playback.masterMute===!1&&this.#a()&&a-t===o.gallery.autoCrossfadeLength+this.config.maxBufferingDelay&&this.#e.getCurrentTrack()+1<=this.#e.getNumTracks()&&this.#t(ae.AUTO,{name:"Auto Crossfade",length:o.gallery.autoCrossfadeLength,curve:o.gallery.autoCrossfadeCurve})}init(t,a){super.init(),this.#e=t,this.#t=a}updateTimer(){(this.isVisible||this.#a())&&this.#e.current.getPosition((t,a)=>this.#r(t,a))}updateVolumeMute(){this.#e.crossfade.isFading()===!1&&this.#e.current.getVolume(t=>ce(Math.round(t),this.#e.current.isMuted()))}},I=new Ne;var m=b("embedded-players"),U=new H(10),i={players:{},playbackState:null,embeddedEvent:null,loadEventsTotal:0,loadEventsCount:1},ua={maxPlaybackStartDelay:3};function Lt(e,t,a){i.players=e,i.playbackState=t,i.embeddedEvent=a,i.loadEventsTotal=3+parseInt(document.body.getAttribute("data-gallery-track-count")),ya(),Sa()}function ye(){return{loadingPercent:100*(i.loadEventsCount++/i.loadEventsTotal)}}function vt(){i.loadEventsCount>=i.loadEventsTotal?i.embeddedEvent(s.PLAYBACK_READY,{resetProgressBar:!0}):d(s.PLAYBACK_LOADING,ye())}function pa(){let e=document.querySelectorAll("single-track, gallery-track");e.forEach(t=>{let a=parseInt(t.getAttribute("data-track-type")),l=t.querySelector("iframe"),p=null;if(a===C.YOUTUBE)e.length===1&&l===null?p=ht("youtube-player",t,!0):p=ht(l.id,t,!1);else if(a===C.SOUNDCLOUD){let k=SC.Widget(l.id);p=new Je(t.id,l.id,k,l.src),k.bind(SC.Widget.Events.READY,()=>{p.setThumbnail(t),k.getDuration(R=>{p.setDuration(Math.round(R/1e3)),t.setAttribute("data-track-duration",p.getDuration())}),Ca(p,l.id)}),k.bind(SC.Widget.Events.PLAY,ha),k.bind(SC.Widget.Events.PAUSE,La),k.bind(SC.Widget.Events.FINISH,va),k.bind(SC.Widget.Events.ERROR,Da)}p!==null&&(p.setArtistTitle(t.getAttribute("data-track-artist"),t.getAttribute("data-track-title")),i.players.add(p))})}function ht(e,t,a=!1){let l=t.getAttribute("data-track-source-uid"),p=new YT.Player(e,{events:{onReady:R=>ga(R,e),onStateChange:R=>Ea(R,e),onError:R=>Pa(R,e)},...a&&{videoId:l}}),k=null;return a?k=new Ce(t.id,e,p,l):k=new Xe(t.id,e,p,l),k.setDuration(parseInt(t.getAttribute("data-track-duration"))),k}function Ee(e,t){m.log("onPlayerError()"),m.log(e);let a=e.getTrackType()===C.YOUTUBE?c.YOUTUBE:c.SOUNDCLOUD;i.players.isCurrent(e.getUid())===!1&&i.players.stop(),U.add(a,u.PLAYER_ERROR,e.getUid()),i.embeddedEvent(s.MEDIA_UNAVAILABLE,da(e,t))}function da(e,t){let a=e.getArtist()||"N/A",l=e.getTitle()||"N/A";return{currentTrack:i.players.trackFromUid(e.getUid()),numTracks:i.players.getNumTracks(),trackId:e.getTrackId(),mediaTitle:`${a} - ${l}`,mediaUrl:t}}function ya(){m.log("initYouTubeAPI()"),d(s.PLAYBACK_LOADING,ye()),window.onYouTubeIframeAPIReady=function(){m.log("onYouTubeIframeAPIReady()"),d(s.PLAYBACK_LOADING,ye()),pa()};let e=document.createElement("script");e.id="youtube-iframe-api",e.src="https://www.youtube.com/iframe_api";let t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}function ga(e,t){let a=i.players.playerFromUid(t);e.target.getPlayerState()===-1?(m.warn(`onYouTubePlayerReady() - MEDIA_UNAVAILABLE: ${t} => ${e.target.getVideoData().video_id} => ${a.getArtist()} - "${a.getTitle()}"`),a.setIsPlayable(!1)):m.log(`onYouTubePlayerReady(): ${t} => ${e.target.getVideoData().video_id} => ${a.getArtist()} - ${a.getTitle()}`),vt()}function Ea(e,t){switch(U.add(c.YOUTUBE,e.data,t),e.data){case YT.PlayerState.UNSTARTED:ka(t);break;case YT.PlayerState.BUFFERING:Ta(t);break;case YT.PlayerState.PLAYING:fa(t);break;case YT.PlayerState.PAUSED:ma(t);break;case YT.PlayerState.CUED:ba(t);break;case YT.PlayerState.ENDED:Aa(t);break}}function ka(e){m.log(`onYouTubePlayerStateChange: UNSTARTED (uID: ${e})`),(U.ytAutoplayBlocked(e,3e3)||U.ytSingleTrackAutoplayBlocked(e,3e3))&&i.embeddedEvent(s.AUTOPLAY_BLOCKED)}function Ta(e){if(m.log(`onYouTubePlayerStateChange: BUFFERING (uID: ${e})`),i.players.crossfade.isFading()===!1){let t=i.players.playerFromUid(e);t.mute(o.playback.masterMute),t.setVolume(o.playback.masterVolume),d(s.MEDIA_LOADING)}}function fa(e){m.log(`onYouTubePlayerStateChange: PLAYING   (uID: ${e})`),i.playbackState.sync(e,i.playbackState.STATE.PLAY),I.start()}function ma(e){m.log(`onYouTubePlayerStateChange: PAUSED    (uID: ${e})`),i.players.isCurrent(e)?(i.playbackState.sync(e,i.playbackState.STATE.PAUSE),I.stop()):i.players.crossfade.stop()}function ba(e){m.log(`onYouTubePlayerStateChange: CUED      (uID: ${e})`)}function Aa(e){m.log(`onYouTubePlayerStateChange: ENDED     (uID: ${e})`),i.players.isCurrent(e)?(I.stop(),i.embeddedEvent(s.MEDIA_ENDED)):i.players.crossfade.stop()}function Pa(e,t){let a=i.players.playerFromUid(t);e.data===150&&a instanceof Ce&&a.isCued()?(m.log("onYouTubePlayerError(150) - SingleTrack.isCued(): true"),a.setIsCued(!1),a.setIsPlayable(!1)):e.data!==null&&a.isPlayable()&&(m.log("onYouTubePlayerError: "+e.data),a.setIsPlayable(!1),Ee(a,e.target.getVideoUrl()))}function Sa(){m.log("initSoundCloudAPI()"),d(s.PLAYBACK_LOADING,ye())}function Ca(e,t){m.log(`onSCPlayerEventReady(): ${t} => ${e.getUid()} => ${e.getArtist()} - ${e.getTitle()}`),vt()}function ha(e){m.log(`onSoundCloudPlayerEvent: PLAY   (uID: ${e.soundId})`),U.add(c.SOUNDCLOUD,u.STATE_PLAYING,e.soundId),i.players.crossfade.isFading()&&i.players.isCurrent(e.soundId)?U.scPlayDoubleTrigger(e.soundId,ua.maxPlaybackStartDelay*1e3)&&i.playbackState.sync(e.soundId,i.playbackState.STATE.PLAY):(i.playbackState.sync(e.soundId,i.playbackState.STATE.PLAY),i.players.current.mute(o.playback.masterMute),i.players.current.setVolume(o.playback.masterVolume)),I.start()}function La(e){m.log(`onSoundCloudPlayerEvent: PAUSE  (uID: ${e.soundId})`),U.add(c.SOUNDCLOUD,u.STATE_PAUSED,e.soundId),U.scAutoplayBlocked(e.soundId,3e3)?(I.stop(),i.embeddedEvent(s.AUTOPLAY_BLOCKED)):U.scWidgetPlayBlocked(e.soundId,3e4)?(I.stop(),i.embeddedEvent(s.PLAYBACK_BLOCKED,{currentTrack:i.players.trackFromUid(e.soundId),numTracks:i.players.getNumTracks()})):i.players.isCurrent(e.soundId)?i.players.current.getPosition(t=>{t>0&&(i.playbackState.sync(e.soundId,i.playbackState.STATE.PAUSE),I.stop())}):i.players.crossfade.stop()}function va(e){m.log(`onSoundCloudPlayerEvent: FINISH (uID: ${e.soundId})`),i.players.isCurrent(e.soundId)?(I.stop(),i.embeddedEvent(s.MEDIA_ENDED)):i.players.crossfade.stop()}function Da(){this.getCurrentSound(e=>{let t=i.players.playerFromUid(e.id);m.log(`onSoundCloudPlayerEvent: ERROR for track: ${i.players.trackFromUid(e.id)}. ${t.getArtist()} - ${t.getTitle()} - [${t.getUid()} / ${t.getIframeId()}]`),t.setIsPlayable(!1)})}var N=b("gallery-events"),ke={snackbarId:0,nowPlayingIcons:null},Re={nowPlayingIconsSelector:"h2.track-artist-title"};function Dt(){N.log("init()"),ke.nowPlayingIcons=document.querySelectorAll(Re.nowPlayingIconsSelector),g(s.MEDIA_PLAYING,Ua),g(s.MEDIA_PAUSED,Na),g(s.MEDIA_ENDED,Ra),g(s.MEDIA_CUE_TRACK,Ya),g(s.CONTINUE_AUTOPLAY,Oa),g(s.RESUME_AUTOPLAY,_a),g(s.AUTOPLAY_BLOCKED,Ma),g(s.PLAYBACK_BLOCKED,Va),g(s.MEDIA_UNAVAILABLE,Ba)}function Ua(e){if(N.log(e),te(ke.snackbarId),e.data.numTracks>1){let t=document.querySelector(`#${e.data.trackId} ${Re.nowPlayingIconsSelector}`);It(t),w(t,"playing-paused","now-playing-icon"),o.gallery.animateNowPlayingIcon&&t.classList.add("playing-animate")}}function Na(e){N.log(e),e.data.numTracks>1&&document.querySelector(`#${e.data.trackId} ${Re.nowPlayingIconsSelector}`).classList.add("playing-paused")}function Ra(e){N.log(e),e!==null&&e.data.numTracks>1&&It()}function Ya(e){N.log(e),e.data.scrollToMedia&&O(e.data.trackId)}function Oa(e){N.log(e),z()&&e.data.trackType===C.YOUTUBE?Q(L.NEXT,!0):$(P.nextPage,!0)}function _a(e){let t=JSON.parse(sessionStorage.getItem(G.UF_AUTOPLAY));if(sessionStorage.removeItem(G.UF_AUTOPLAY),N.log(e),N.log(`RESUME_AUTOPLAY: ${t!==null?JSON.stringify(t):"NO"}`),t!==null){let a=document.getElementById(t.trackId)?.querySelector("iframe").id;e.callback.resumeAutoplay(t,a)}}function Ma(e){N.log(e),ke.snackbarId=A("Autoplay blocked, Play to continue",0,"play",()=>e.callback.togglePlayPause())}function Va(e){N.log(e),A("Unable to play track, skipping to next",5,"Stop",()=>{},()=>Ut(e))}function Ba(e){N.log(e),A("Unable to play track, skipping to next",5,"Stop",()=>{},()=>Ut(e))}function It(e){ke.nowPlayingIcons.forEach(t=>{t!==e&&t.classList.remove("now-playing-icon","playing-animate","playing-paused")})}function Ut(e){e.data.currentTrack<e.data.numTracks?e.callback.skipToTrack(e.data.currentTrack+1,!0):z()?Q(L.NEXT,o.playback.autoplay):P.nextPage!==null&&$(P.nextPage,!0)}var Ye=b("crossfade-controls"),Te={players:{}},v={},F={crossfadePresetSelector:".crossfade-preset-control",crossfadePresetData:"data-crossfade-preset",crossfadeToSelector:".crossfade-fadeto-control"};function Rt(e,t){Ye.log("init()"),Te.players=e,v.crossfadePreset=Le(F.crossfadePresetSelector),v.crossfadeTo=Le(F.crossfadeToSelector),v.crossfadePreset.length>1&&v.crossfadeTo.length>1&&(v.crossfadePreset.forEach(a=>Yt(a,o.gallery.trackCrossfadeDefPreset)),v.crossfadeTo.clickCallback=t),g(s.PLAYBACK_READY,xa)}function xa(){Ye.log("playbackReady()"),v.crossfadePreset.length>1&&v.crossfadeTo.length>1&&(v.crossfadePreset.forEach(e=>{e.addEventListener("click",Ka),w(e,T.DISABLED.CLASS,T.ENABLED.CLASS)}),v.crossfadeTo.forEach(e=>e.addEventListener("click",$a)),g(s.MEDIA_PLAYING,Nt),g(s.MEDIA_PAUSED,Nt))}function Yt(e,t){e.setAttribute(F.crossfadePresetData,t),e.textContent=`${t+1}`,e.title=`Preset: ${ee.crossfade[t].name}`}function Ka(e){let t=parseInt(e.target.getAttribute(F.crossfadePresetData));Yt(e.target,t+1<ee.crossfade.length?t+1:0)}function $a(e){if(f()&&Te.players.crossfade.isFading()===!1){let t=e.target.closest("gallery-track");if(t!==null){let a=t.querySelector("iframe"),l=parseInt(t.querySelector(F.crossfadePresetSelector).getAttribute(F.crossfadePresetData));w(t.querySelector(`div${F.crossfadeToSelector}`),T.ENABLED.CLASS,T.DISABLED.CLASS),v.crossfadeTo.clickCallback(Te.players.uIdFromIframeId(a.id),ee.crossfade[l])}}}function Nt(){let e=f(),t=e?Te.players.getTrackData().currentTrack:-1;Ye.log(`updateCrossfadeToState() - playingState: ${e} - currentTrack: ${t}`),v.crossfadeTo.forEach((a,l)=>{t===l+1?w(a,e?T.ENABLED.CLASS:T.DISABLED.CLASS,e?T.DISABLED.CLASS:T.ENABLED.CLASS):w(a,e?T.DISABLED.CLASS:T.ENABLED.CLASS,e?T.ENABLED.CLASS:T.DISABLED.CLASS)})}var Ot=b("gallery-players"),_t=()=>{let e=null,t=null,a=[],l=new Map,p=0;return{indexMap:l,get crossfade(){return t},get current(){return a[p]},get next(){return a[p+1]},getPlayerIndex(){return p},setPlayerIndex(E){p=E},getTrackType(){return this.current.getTrackType()},getNumTracks(){return a.length},getCurrentTrack(){return p+1},playerFromUid(E){return a[l.get(E)]},trackFromUid(E){return l.get(E)+1},isCurrent(E){return E===this.current.getUid()},init:k,add:R,uIdFromIframeId:ea,stop:ta,mute:aa,getTrackData:ra,prevTrack:sa,nextTrack:oa,jumpToTrack:na};function k(E){Ot.log("init()"),e=E,t=He(this),g(s.MEDIA_PLAYING,()=>t.start()),g(s.MEDIA_PAUSED,()=>t.stop())}function R(E){Ot.log(E),a.push(E),l.set(E.getUid(),a.length-1)}function ea(E){return a.find(Se=>Se.getIframeId()===E).getUid()}function ta(){this.current.stop(),t.stop()}function aa(){this.current.mute(o.playback.masterMute),t.mute(o.playback.masterMute)}function ra(){return{currentTrack:this.getCurrentTrack(),numTracks:this.getNumTracks(),artist:this.current.getArtist(),title:this.current.getTitle(),duration:this.current.getDuration(),thumbnail:{src:this.current.getThumbnailSrc(),class:this.current.getThumbnailClass()}}}function sa(E){return p>0?(p--,e(E),!0):!1}function oa(E){return p++,p<this.getNumTracks()?(e(E),!0):!1}function na(E,Se,la=!0){return E>0&&E<=this.getNumTracks()?(p=E-1,e(Se,la),!0):!1}};var S=b("gallery-playback"),r={eventLog:null,players:{}},Mt={minCrossfadeToTime:5,maxBufferingDelay:3};function Wa(){S.log("init()"),r.eventLog=U,Dt(),r.players=_t(),r.players.init(wt),se(r.players,Ha),Rt(r.players,Qa),I.init(r.players,Kt),Lt(r.players,er,Za)}function fe(){f()?(W(),r.players.current.pause()):(rt(),r.players.current.play(Ee))}function Vt(){S.log(`prevTrack() - prevTrack: ${r.players.getCurrentTrack()-1} - numTracks: ${r.players.getNumTracks()}`),r.players.getCurrentTrack()>0&&r.players.current.getPosition(e=>{e>5e3?(r.players.current.seekTo(0),_(0,0,r.players.current.getDuration())):(r.players.getCurrentTrack()>1&&r.players.stop(),r.players.prevTrack(f())?h():d(s.MEDIA_PREV_TRACK))})}function Oe(e=!1){let t=r.players.getCurrentTrack()+1>r.players.getNumTracks();S.log(`nextTrack() - isMediaEnded: ${e} - isLastTrack: ${t} - autoplay: ${o.playback.autoplay}`),!qa(e,t)&&(t===!1?(r.players.stop(),e&&o.playback.autoplay===!1?W():r.players.nextTrack(f())&&h()):t===!0&&e===!1?d(s.MEDIA_NEXT_TRACK):e&&(W(),o.playback.autoplay?d(s.CONTINUE_AUTOPLAY,{trackType:r.players.current.getTrackType()}):r.players.stop()))}function qa(e,t){if(e&&o.playback.autoplay){let a=le();if(S.log(`repeatPlayback(): ${S.getKeyForValue(Y,a)}`),a===Y.ONE)return r.players.current.seekTo(0),r.players.current.play(),!0;if(t&&a===Y.ALL)return r.players.stop(),r.players.setPlayerIndex(0),wt(!0),!0}return!1}function Ha(e){r.players.current.seekTo(e)}function Xa(){r.players.current.setVolume(o.playback.masterVolume)}function Bt(){o.playback.masterMute=o.playback.masterMute!==!0,r.players.mute()}function Ja(e,t=!0){S.log(`cueTrack(): ${e}`),r.players.setPlayerIndex(r.players.indexMap.get(e)),d(s.MEDIA_CUE_TRACK,{scrollToMedia:t,trackId:r.players.current.getTrackId()}),h()}function wt(e,t=!0){d(s.MEDIA_CUE_TRACK,{scrollToMedia:t,trackId:r.players.current.getTrackId()}),e&&r.players.current.play(Ee)}function xt(e,t=!0){S.log(`skipToTrack(): ${e} - ${t}`),t===!0&&f()===!1&&(r.eventLog.add(c.ULTRAFUNK,u.RESUME_AUTOPLAY),r.players.jumpToTrack(e,t)&&h())}function ja(e,t=null){S.log(`resumeAutoplay(): ${e.autoplay}${t!==null?" - "+t:""}`),t!==null?e.autoplay?xt(r.players.trackFromUid(t),!0):Ja(t):e.autoplay&&(r.eventLog.add(c.ULTRAFUNK,u.RESUME_AUTOPLAY),fe())}function za(e,t,a=!1){S.log(`cueOrPlaySingleTrackById() - playMedia: ${a}`),r.eventLog.add(c.ULTRAFUNK,u.CUE_PLAY_SINGLE_TRACK),r.players.current.setIsCued(!1),r.players.current.setIsPlayable(!0),r.players.current.setArtistTitle(e.track_artist,e.track_title),r.players.current.setDuration(parseInt(e.track_duration)),r.players.current.setThumbnail(t),at(0),h(),a?(r.eventLog.add(c.ULTRAFUNK,u.RESUME_AUTOPLAY),r.players.current.playTrackById(t.uid)):r.players.current.cueTrackById(t.uid)}function me(){return{isPlaying:f(),currentTrack:r.players.getCurrentTrack(),trackType:r.players.current.getTrackType(),position:0,numTracks:r.players.getNumTracks(),trackId:r.players.current.getTrackId(),iframeId:r.players.current.getIframeId()}}function Qa(e,t){r.players.isCurrent(e)===!1&&r.players.current.getDuration()>0&&(S.log(`crossfadeToClick():
      fadeOut: ${r.players.current.getArtist()} - "${r.players.current.getTitle()}" (${r.players.current.getUid()})
      fadeIn.: ${r.players.playerFromUid(e).getArtist()} - "${r.players.playerFromUid(e).getTitle()}" (${e})`),o.playback.masterMute===!1&&o.playback.autoplay===!1&&r.players.current.getPosition(a=>{r.players.current.getDuration()-a/1e3>=Mt.minCrossfadeToTime+Mt.maxBufferingDelay&&Kt(ae.TRACK,t,e)}))}function Kt(e,t,a=null){r.eventLog.add(c.ULTRAFUNK,u.CROSSFADE_START),r.players.crossfade.init(e,t,a)!==null&&h()}function Za(e,t=null){switch(S.log(`embeddedEventHandler() - event: ${S.getKeyForValue(s,e)}`),t!==null&&S.log(t),e){case s.MEDIA_ENDED:d(s.MEDIA_ENDED,me()),Oe(!0);break;case s.PLAYBACK_READY:oe(Vt,fe,Oe,Bt),St(za),d(s.PLAYBACK_READY,t),d(s.RESUME_AUTOPLAY,null,{resumeAutoplay:ja});break;case s.AUTOPLAY_BLOCKED:d(s.AUTOPLAY_BLOCKED,null,{togglePlayPause:fe});break;case s.PLAYBACK_BLOCKED:case s.MEDIA_UNAVAILABLE:d(e,t,{skipToTrack:xt});break}}var er=(()=>{let e={PLAY:1,PAUSE:2};return{STATE:e,sync:function a(l,p){S.log(`playbackState.sync() - previousTrack: ${r.players.getPlayerIndex()+1} - nextTrack: ${r.players.indexMap.get(l)+1} - syncState: ${S.getKeyForValue(e,p)}`),r.players.isCurrent(l)?p===e.PLAY?d(s.MEDIA_PLAYING,me()):p===e.PAUSE&&d(s.MEDIA_PAUSED,me()):(r.players.stop(),r.players.setPlayerIndex(r.players.indexMap.get(l)),h(),a(l,p))}}})();var Ke={};Ge(Ke,{getStatus:()=>lr,init:()=>ar,nextTrack:()=>Gt,prevTrack:()=>Ft,setVolume:()=>sr,toggleMute:()=>Be,togglePlayPause:()=>xe});var Me=class extends X{#e=null;#t(t,a){if(t!==void 0){let l=Math.round(t);_(t*1e3,l,a),l>0&&a>0&&super.updateOncePerSecond(l,a)}}ready(t){super.init(),this.#e=t,g(s.MEDIA_PLAYING,()=>super.start())}updateTimer(){this.isVisible&&f()&&this.#t(this.#e.embedded.getCurrentTime(),this.#e.getDuration())}updateVolumeMute(){ce(this.#e.embedded.getVolume(),this.#e.embedded.isMuted())}},Ve=new Me;var D=b("list-playback"),J=new H(10),n={player:null,autoplayData:null,playerReady:!1,firstStatePlaying:!0,currentTrackId:null,currentSnackbarId:0},we=`
  <p>The <b>List Player</b> only supports playing YouTube tracks, SoundCloud tracks will be automatically skipped over.</p>
  <p>SoundCloud tracks must be played using the <b>Gallery Player</b> or by clicking / tapping on the track <b>Artist + Title</b> text link in the <b>List Player</b>.</p>
  <p>To toggle between the <b>Gallery</b> and <b>List</b> players, please use the <b>Pref. Player: GALLERY / LIST</b> setting toggle button in the sites footer area.</p>`;function ar(){D.log("init()"),ot(V),Ct(V),rr()!==null?ir():A("No playable YouTube tracks!",0,"help",()=>re("No playable tracks",we))}function rr(){if(n.currentTrackId=x(),n.autoplayData=JSON.parse(sessionStorage.getItem(G.UF_AUTOPLAY)),sessionStorage.removeItem(G.UF_AUTOPLAY),n.currentTrackId!==null){if(n.autoplayData!==null&&n.autoplayData.trackId!==null){let e=ie(`[data-track-id="${n.autoplayData.trackId}"]`);e!==null?ve(e)===C.YOUTUBE?n.currentTrackId=e.id:A("Cannot play SoundCloud track",5,"help",()=>re("Cannot play SoundCloud track",we)):A("Unable to cue track (not found)",5)}ut(n.currentTrackId)}return D.log(`cueInitialTrack() - currentTrackId: ${n.currentTrackId} - autoplayData: ${n.autoplayData!==null?JSON.stringify(n.autoplayData):"N/A"}`),n.currentTrackId}function V(e,t=!0,a=!1){let l=ve(it(e));if(D.log(`setCurrentTrack() - nextTrackType: ${D.getKeyForValue(C,l)} - nextTrackId: ${e} - playNextTrack: ${t} - isPointerClick: ${a}`),l===C.SOUNDCLOUD&&a){A("Cannot play SoundCloud track",5,"help",()=>re("Cannot play SoundCloud track",we));return}e===n.currentTrackId?xe():(f()&&n.player.embedded.stopVideo(),n.currentTrackId=e,d(s.MEDIA_CUE_TRACK,{trackId:e,isPointerClick:a}),$t(t))}function $t(e){let t=yt();n.player.resetState(),e?(n.player.playTrackById(t),K(T.PLAYING),h()):(n.player.cueTrackById(t),K(T.PAUSED))}function xe(){n.currentTrackId===null?V(ie("div.track-entry.current").id):f()?n.player.embedded.pauseVideo():n.player.play(be)}function sr(){n.player.setVolume(o.playback.masterVolume)}function Be(e=!0){e&&(o.playback.masterMute=o.playback.masterMute!==!0),o.playback.masterMute?n.player.embedded.mute():n.player.embedded.unMute()}function Ft(){let e=ct(),t=n.player.embedded.getCurrentTime();e!==null&&t<=5?(V(e,f()),h()):t!==0&&(n.player.embedded.seekTo(0),_(0,0,n.player.getDuration()))}function Gt(){let e=x();e!==null&&(V(e,f()),h())}async function Wt(e=!1,t=!1){let a=t?Y.OFF:le(),l=x();if(D.log(`advanceToNextTrack() autoplay: ${e} - isPlaybackError: ${t} - nextTrackId: ${l} - repeatMode: ${D.getKeyForValue(Y,a)}`),e&&a===Y.ONE)n.player.embedded.seekTo(0),n.player.play(be);else if(e&&l===null&&a===Y.ALL)V(x(null)),O(0);else if(l===null)if(o.list.showLoadMoreTracks){let p=await pt();e&&p&&V(x())}else $(P.nextPage,e);else e?V(l):K(T.PAUSED)}function or(){f()===!1&&n.autoplayData!==null&&(J.add(c.ULTRAFUNK,u.RESUME_AUTOPLAY),J.add(c.YOUTUBE,-1,x())),f()===!1&&Wt(!0,!0)}function nr(){n.currentTrackId=null,K(T.PAUSED)}function lr(){let e=ie("div.track-entry.current");if(e!==null){let t=lt("div.track-entry"),a=Array.prototype.indexOf.call(t,e);return{isPlaying:f(),currentTrack:a+1,trackType:C.YOUTUBE,position:Math.ceil(n.player.embedded.getCurrentTime()),numTracks:1,trackId:t[a].getAttribute("data-track-id"),iframeId:"youtube-player"}}return{isPlaying:!1,currentTrack:1,position:0,trackId:0}}function ir(){D.log("initYouTubeAPI()"),window.onYouTubeIframeAPIReady=function(){D.log("onYouTubeIframeAPIReady()");let a=new YT.Player("youtube-player",{events:{onReady:cr,onStateChange:ur,onError:be}});n.player=new je(a),D.log(n.player),se(n.player,l=>n.player.embedded.seekTo(l)),d(s.PLAYBACK_LOADING,{loadingPercent:33})};let e=document.createElement("script");e.id="youtube-iframe-api",e.src="https://www.youtube.com/iframe_api";let t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}function cr(){D.log("onYouTubePlayerReady()"),n.autoplayData?.autoplay===!0&&J.add(c.ULTRAFUNK,u.RESUME_AUTOPLAY),oe(Ft,xe,Gt,Be),d(s.PLAYBACK_LOADING,{loadingPercent:66}),Ve.ready(n.player),nt(n.player),Be(!1),n.player.setVolume(o.playback.masterVolume),d(s.PLAYBACK_READY,{resetProgressBar:!1}),$t(n.autoplayData?.autoplay===!0)}function ur(e){switch(D.log(`onYouTubePlayerStateChange(): ${e.data} - trackId: ${n.currentTrackId}`),J.add(c.YOUTUBE,e.data,n.currentTrackId),e.data!==YT.PlayerState.PLAYING&&W(),e.data){case YT.PlayerState.UNSTARTED:pr();break;case YT.PlayerState.BUFFERING:d(s.MEDIA_LOADING);break;case YT.PlayerState.PLAYING:dr(),d(s.MEDIA_PLAYING);break;case YT.PlayerState.PAUSED:K(T.PAUSED);break;case YT.PlayerState.ENDED:Ve.stop(),d(s.MEDIA_ENDED),Wt(o.playback.autoplay);break}}function pr(){J.ytAutoplayBlocked(n.currentTrackId,3e3)&&(K(T.PAUSED),n.currentSnackbarId=A("Autoplay blocked, Play to continue",0,"play",()=>n.player.play(be))),n.playerReady===!1&&(n.playerReady=!0,d(s.PLAYBACK_LOADING,{loadingPercent:0}))}function dr(){te(n.currentSnackbarId),n.firstStatePlaying&&(n.firstStatePlaying=!1,n.autoplayData=null,setTimeout(()=>{o.playback.autoplay&&f()&&Math.round(window.pageYOffset)<=1&&Qe(ze.SITE_MAX_WIDTH_MOBILE)&&O(0)},6e3))}function be(e){D.log(`onYouTubePlayerError(): playerError: ${e.data} - currentTrackId: ${n.currentTrackId} - isTrackCued: ${n.player.isTrackCued()}`),n.player.setPlayerError(e.data),n.player.isTrackCued()===!1&&(dt("Error!"),J.add(c.YOUTUBE,u.PLAYER_ERROR,n.currentTrackId),A("Unable to play track, skipping to next",5,"Stop",nr,or))}var Pe=b("screen-wakelock"),Ae={wakeLock:null};function qt(){o.mobile.keepScreenOn&&document.addEventListener("click",Ht)}function Ht(){Pe.log("enableScreenWakeLock()"),document.removeEventListener("click",Ht),gr(),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&o.mobile.keepScreenOn&&yr()})}function yr(){Xt()&&Ae.wakeLock===null&&Jt()}function Xt(){return"wakeLock"in navigator&&"request"in navigator.wakeLock}async function gr(){Xt()?document.visibilityState==="visible"&&await Jt()!==!0&&(Pe.log("enableWakeLock(): Screen Wake Lock request failed"),A("Keep Screen On failed",5,"Disable",()=>o.mobile.keepScreenOn=!1)):(Pe.log("enableWakeLock(): Screen Wake Lock is not supported"),A("Keep Screen On is not supported",5,"Disable",()=>o.mobile.keepScreenOn=!1))}async function Jt(){try{return Ae.wakeLock=await navigator.wakeLock.request("screen"),Ae.wakeLock.addEventListener("release",()=>{Ae.wakeLock=null}),!0}catch(e){Pe.error(`requestWakeLock(): ${e.name} - ${e.message}`)}return!1}var Z=b("playback-interaction"),jt=new pe(10),y={player:null,isPlaybackReady:!1,siteNavUiElements:null,trackNavUiElements:null,keyboardShortcuts:null};document.addEventListener("DOMContentLoaded",()=>{We(),Z.log("DOMContentLoaded"),qe(),gt()?y.player=_e:Et()&&(y.player=Ke),y.player!==null&&Er(),At(y.player?.getStatus)});function Er(){Z.log("initCommon()"),tt(),kr(),y.player.init(),y.siteNavUiElements=new $e("#site-navigation"),y.trackNavUiElements=new Fe("nav.single-track-nav .nav-links"),q.init(),y.keyboardShortcuts=Ze(o.playback.keyboardShortcuts),Tr(),qt()}function kr(){g(s.PLAYBACK_READY,Pr),g(s.MEDIA_CUE_TRACK,Qt),g(s.MEDIA_ENDED,Qt),g(s.MEDIA_TIME_REMAINING,Sr),g(s.MEDIA_PREV_TRACK,()=>B(null,L.PREV,P.prevPage)),g(s.MEDIA_NEXT_TRACK,()=>B(null,L.NEXT,P.nextPage))}function Tr(){j(".playback-shuffle-control span","click",Tt),document.addEventListener("keydown",fr),document.addEventListener("keydown",mr),window.addEventListener("blur",Cr)}function fr(e){if(y.isPlaybackReady&&y.keyboardShortcuts.allow()&&e.ctrlKey===!1&&e.altKey===!1){switch(e.key){case"+":case"-":zt(e);break;case"ArrowUp":case"ArrowDown":e.shiftKey&&zt(e);break}if(e.repeat===!1){switch(e.code){case"Backquote":e.preventDefault(),O(y.player.getStatus().trackId);break}switch(e.key){case" ":e.preventDefault(),y.player.togglePlayPause();break;case"Home":case"End":case"PageUp":case"PageDown":ft(e);break;case"ArrowLeft":br(e);break;case"ArrowRight":Ar(e);break;case"A":Ie.toggle();break;case"f":case"F":e.preventDefault(),q.toggle(document.getElementById(y.player.getStatus().iframeId));break;case"m":case"M":e.preventDefault(),y.player.toggleMute(),A(o.playback.masterMute?"<b>Muted</b> (<b>m</b> to Unmute)":"<b>Unmuted</b> (<b>m</b> to Mute)",3);break;case"p":case"P":mt.toggle();break;case"r":case"R":A(`${st().title} (<b>r</b> to change)`,3);break;case"x":case"X":bt.toggle();break}}}}function mr(e){if(y.isPlaybackReady&&y.keyboardShortcuts.allow())switch(e.key){case"MediaPlayPause":et===!1&&(Z.log("documentEventMediaKeyDown(): MediaPlayPause"),e.preventDefault(),y.player.togglePlayPause());break;case"MediaTrackPrevious":Z.log("documentEventMediaKeyDown(): MediaTrackPrevious"),e.preventDefault(),y.player.prevTrack();break;case"MediaTrackNext":Z.log("documentEventMediaKeyDown(): MediaTrackNext"),e.preventDefault(),y.player.nextTrack();break}}function br(e){e.preventDefault(),e.shiftKey===!0?B(null,L.PREV,P.prevPage):y.player.prevTrack()}function Ar(e){e.preventDefault(),e.shiftKey===!0?B(null,L.NEXT,P.nextPage):y.player.nextTrack()}function B(e,t,a){e?.preventDefault(),z()&&y.player.getStatus().trackType===C.YOUTUBE?Pt()===!1?Q(t,y.player.getStatus().isPlaying):A("Loading track, please wait...",3):Zt(null,a)}function zt(e){e.preventDefault(),o.playback.masterVolume=e.key==="+"||e.key==="ArrowUp"?o.playback.masterVolume<100?o.playback.masterVolume+5:100:o.playback.masterVolume>5?o.playback.masterVolume-5:5,y.player.setVolume()}function Pr(){j(".playback-details-control","click",hr),j(".playback-thumbnail-control","click",Lr),j(".playback-timer-control","click",vr),y.isPlaybackReady=!0}function Qt(){o.playback.autoExitFullscreen&&q.exit()}function Sr(e){o.playback.autoExitFsOnWarning&&e.data.timeRemainingSeconds<=o.playback.timeRemainingSeconds&&q.exit()}function Cr(){De()||setTimeout(()=>{document.activeElement instanceof HTMLIFrameElement&&setTimeout(()=>{document.activeElement.blur(),document.activeElement instanceof HTMLIFrameElement&&document.activeElement.blur()},250)},0)}function hr(){O(y.player.getStatus().trackId)}function Lr(){kt()?(jt.add(c.MOUSE,u.MOUSE_CLICK),jt.doubleClicked(c.MOUSE,u.MOUSE_CLICK,500)&&q.enter(document.getElementById(y.player.getStatus().iframeId))):De()&&O(0)}function vr(){Ie.toggle()}var $e=class extends he{elementClicked(){if(this.clicked("a.navbar-prev-link"))return B(this.event,L.PREV,P.prevPage);if(this.clicked("a.navbar-next-link"))return B(this.event,L.NEXT,P.nextPage)}},Fe=class extends he{elementClicked(){if(this.clicked("div.nav-previous a"))return B(this.event,L.PREV,P.prevPage);if(this.clicked("div.nav-next a"))return B(this.event,L.NEXT,P.nextPage)}};function Zt(e,t){e?.preventDefault(),$(t,y.player.getStatus().isPlaying)}
//# sourceMappingURL=interaction.js.map
