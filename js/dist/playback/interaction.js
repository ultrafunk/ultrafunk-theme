import{$ as st,A as Ce,Aa as V,B as Xe,C as re,D as oe,E as O,F as f,G as Je,H as G,I as ne,J as ze,K as X,L as Y,M as D,N as se,O as Qe,Q as Ze,R as et,S as J,T as tt,U as at,V as Le,W as rt,X as M,Y as ot,Z as nt,_ as x,a as Ke,aa as lt,b,c as ee,ca as it,da as le,e as te,ea as ct,f as K,fa as ut,ha as dt,ia as ie,ja as pt,k as A,ka as w,l,la as N,m as Ge,ma as yt,na as ce,oa as gt,p as m,pa as Et,q as ae,qa as Ie,r as We,ra as kt,s as qe,sa as ft,t as he,u as He,ua as Tt,v as je,va as _,w as r,wa as ve,x as g,y as p,z as k,za as mt}from"../chunk-YHTBNYHP.js";var De=b("eventlogger"),u={UNKNOWN:1e3,KEYBOARD:100,MOUSE:110,YOUTUBE:1,SOUNDCLOUD:2,ULTRAFUNK:50},d={UNKNOWN:-2e3,KEY_ARROW_LEFT:180,KEY_ARROW_RIGHT:181,MOUSE_CLICK:182,STATE_ERROR:-5,STATE_UNSTARTED:-1,STATE_ENDED:0,STATE_PLAYING:1,STATE_PAUSED:2,STATE_BUFFERING:3,STATE_CUED:5,RESUME_AUTOPLAY:50,PLAYER_ERROR:60,CROSSFADE_START:70},Zt={eventSource:u.UNKNOWN,eventType:d.UNKNOWN,uId:null,timeStamp:0},ue=class{constructor(t=10){this.log=[],this.maxEntries=t,this.lastPos=0,this.matchCount=0}add(t,a,o,c=Date.now()){let y=Object.create(Zt);y.eventSource=t,y.eventType=a,y.uId=o,y.timeStamp=c,this.log.length<this.maxEntries?this.log.push(y):(this.log.shift(),this.log.push(y))}clear(){this.log=[]}initMatch(){this.lastPos=this.log.length-1,this.matchCount=0}matchesEvent(t,a,o,c=null){this.log[this.lastPos-t].eventSource===a&&this.log[this.lastPos-t].eventType===o&&this.log[this.lastPos-t].uId===c&&this.matchCount++}matchesDelta(t,a){this.log[this.lastPos].timeStamp-this.log[this.lastPos-t].timeStamp<=a&&this.matchCount++}isPatternMatch(t,a){return this.matchCount===t?(De.log(`MATCH for: ${a}`),De.logEventLog(this.log,u,d),!0):!1}},de=class extends ue{doubleClicked(t,a,o){return this.initMatch(),this.lastPos>=1&&(this.matchesEvent(1,t,a),this.matchesEvent(0,t,a),this.matchesDelta(1,o)),this.isPatternMatch(3,`${De.getObjectKeyForValue(u,t)} Double Clicked`)}},W=class extends ue{ytAutoplayBlocked(t,a){return this.initMatch(),this.lastPos>=3&&(this.matchesEvent(3,u.ULTRAFUNK,d.RESUME_AUTOPLAY,null),this.matchesEvent(2,u.YOUTUBE,d.STATE_UNSTARTED,t),this.matchesEvent(1,u.YOUTUBE,d.STATE_BUFFERING,t),this.matchesEvent(0,u.YOUTUBE,d.STATE_UNSTARTED,t),this.matchesDelta(3,a)),this.isPatternMatch(5,"YouTube Autoplay Blocked")}scAutoplayBlocked(t,a){return this.initMatch(),this.lastPos>=3&&(this.matchesEvent(3,u.ULTRAFUNK,d.RESUME_AUTOPLAY,null),this.matchesEvent(2,u.SOUNDCLOUD,d.STATE_PLAYING,t),this.matchesEvent(1,u.SOUNDCLOUD,d.STATE_PAUSED,t),this.matchesEvent(0,u.SOUNDCLOUD,d.STATE_PAUSED,t),this.matchesDelta(3,a)),this.isPatternMatch(5,"SoundCloud Autoplay Blocked")}scWidgetPlayBlocked(t,a){return this.initMatch(),this.lastPos>=2&&(this.matchesEvent(2,u.SOUNDCLOUD,d.STATE_PLAYING,t),this.matchesEvent(1,u.SOUNDCLOUD,d.STATE_PAUSED,t),this.matchesEvent(0,u.SOUNDCLOUD,d.STATE_PAUSED,t),this.matchesDelta(2,a)),this.isPatternMatch(4,"SoundCloud WidgetPlay Blocked")}scPlayDoubleTrigger(t,a){return this.initMatch(),this.lastPos>=2&&(this.matchesEvent(2,u.ULTRAFUNK,d.CROSSFADE_START,null),this.matchesEvent(1,u.SOUNDCLOUD,d.STATE_PLAYING,t),this.matchesEvent(0,u.SOUNDCLOUD,d.STATE_PLAYING,t),this.matchesDelta(1,a)),this.isPatternMatch(4,"SoundCloud Play Double Trigger")}};var xe={};Ke(xe,{getStatus:()=>me,init:()=>xa,nextTrack:()=>Me,prevTrack:()=>Nt,toggleMute:()=>Ut,togglePlayPause:()=>Te});var $=class{constructor(){this.intervalId=-1,this.lastPosSeconds=0,this.isVisible=!0,this.config={updateTimerInterval:250,maxBufferingDelay:3}}init(){document.addEventListener("visibilitychange",()=>{this.isVisible=document.visibilityState==="visible"})}start(){this.stop(),this.intervalId=setInterval(()=>{this.isVisible&&this.updateProxy()},this.config.updateTimerInterval)}stop(){this.intervalId!==-1&&(clearInterval(this.intervalId),this.intervalId=-1),this.lastPosSeconds=0,ne(!1)}updateTimeRemainingWarning(t,a){if(l.playback.autoplay===!1&&l.playback.timeRemainingWarning&&this.lastPosSeconds!==t){let o=a-t;this.lastPosSeconds=t,o<=l.playback.timeRemainingSeconds?(ne(!0),p(r.MEDIA_TIME_REMAINING,{timeRemainingSeconds:o})):ne(!1)}}};var Ne=class extends ${constructor(){super(),this.players=null,this.crossfadeInit=null}init(t,a){super.init(),this.players=t,this.crossfadeInit=a}updateProxy(){this.players.current.getPosition((t,a)=>this.updateCallback(t,a))}updateCallback(t,a=0){let o=Math.round(t/1e3);O(t,o,a),o>0&&a>0&&(super.updateTimeRemainingWarning(o,a),this.updateAutoCrossfade(o,a))}updateAutoCrossfade(t,a){l.playback.masterMute===!1&&l.playback.autoplay&&l.gallery.autoCrossfade&&a-t===l.gallery.autoCrossfadeLength+this.config.maxBufferingDelay&&this.players.getCurrentTrack()+1<=this.players.getNumTracks()&&this.crossfadeInit(ce.AUTO,{name:"Auto Crossfade",length:l.gallery.autoCrossfadeLength,curve:l.gallery.autoCrossfadeCurve})}},C=new Ne;var P=b("embedded-players"),v=new W(10),i={players:{},playbackState:null,embeddedEvent:null,loadEventsTotal:0,loadEventsCount:1},Ue={youTubeIframeIdRegEx:/youtube-uid/i,soundCloudIframeIdRegEx:/soundcloud-uid/i,maxPlaybackStartDelay:3};function bt(e,t,a){i.players=e,i.playbackState=t,i.embeddedEvent=a,i.loadEventsTotal=3+parseInt(document.body.getAttribute("data-gallery-track-count")),ra(),ya()}function ye(){return{loadingPercent:100*(i.loadEventsCount++/i.loadEventsTotal)}}function Pt(){i.loadEventsCount>=i.loadEventsTotal?i.embeddedEvent(r.READY,{resetProgressBar:!0}):p(r.LOADING,ye())}function ta(){document.querySelectorAll("single-track").forEach(t=>{let a=t.querySelector("iframe"),o=null;if(Ue.youTubeIframeIdRegEx.test(a.id)){let c=new YT.Player(a.id,{events:{onReady:y=>oa(y,a.id),onStateChange:y=>na(y,a.id),onError:y=>pa(y,a.id)}});o=new Et(t.id,a.id,c,t.getAttribute("data-track-source-data")),o.setDuration(parseInt(t.getAttribute("data-track-duration")))}else if(Ue.soundCloudIframeIdRegEx.test(a.id)){let c=SC.Widget(a.id);o=new Ie(t.id,a.id,c,a.src),c.bind(SC.Widget.Events.READY,()=>{o.setThumbnail(t.querySelector(".track-share-control span")),c.getDuration(y=>o.setDuration(Math.round(y/1e3))),ga(o,a.id)}),c.bind(SC.Widget.Events.PLAY,Ea),c.bind(SC.Widget.Events.PAUSE,ka),c.bind(SC.Widget.Events.FINISH,fa),c.bind(SC.Widget.Events.ERROR,Ta)}o!==null&&(o.setTitle(t.getAttribute("data-track-title")),o.setArtist(t.getAttribute("data-track-artist")),i.players.add(o))})}function Ee(e,t){P.log("onPlayerError()"),P.log(e);let a=e instanceof Ie?u.SOUNDCLOUD:u.YOUTUBE;i.players.isCurrent(e.getUid())===!1&&i.players.stop(),v.add(a,d.PLAYER_ERROR,e.getUid()),i.embeddedEvent(r.MEDIA_UNAVAILABLE,aa(e,t))}function aa(e,t){let a=e.getArtist()||"N/A",o=e.getTitle()||"N/A";return{currentTrack:i.players.trackFromUid(e.getUid()),numTracks:i.players.getNumTracks(),trackId:e.getTrackId(),mediaTitle:`${a} - ${o}`,mediaUrl:t}}function ra(){P.log("initYouTubeAPI()"),p(r.LOADING,ye()),window.onYouTubeIframeAPIReady=function(){P.log("onYouTubeIframeAPIReady()"),p(r.LOADING,ye()),ta()};let e=document.createElement("script");e.id="youtube-iframe-api",e.src="https://www.youtube.com/iframe_api";let t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}function oa(e,t){let a=i.players.playerFromUid(t);P.log(`onYouTubePlayerReady(): ${t} => ${e.target.getVideoData().video_id} => ${a.getArtist()} - ${a.getTitle()}`),Pt()}function na(e,t){switch(v.add(u.YOUTUBE,e.data,t),e.data){case YT.PlayerState.UNSTARTED:sa(t);break;case YT.PlayerState.BUFFERING:la(t);break;case YT.PlayerState.PLAYING:ia(e,t);break;case YT.PlayerState.PAUSED:ca(t);break;case YT.PlayerState.CUED:ua(t);break;case YT.PlayerState.ENDED:da(t);break}}function sa(e){P.log(`onYouTubePlayerStateChange: UNSTARTED (uID: ${e})`),v.ytAutoplayBlocked(e,3e3)&&i.embeddedEvent(r.AUTOPLAY_BLOCKED)}function la(e){if(P.log(`onYouTubePlayerStateChange: BUFFERING (uID: ${e})`),i.players.crossfade.isFading()===!1){let t=i.players.playerFromUid(e);t.mute(l.playback.masterMute),t.setVolume(l.playback.masterVolume),p(r.MEDIA_LOADING)}}function ia(e,t){P.log(`onYouTubePlayerStateChange: PLAYING   (uID: ${t})`),i.playbackState.syncAll(t,i.playbackState.STATE.PLAY),C.start()}function ca(e){P.log(`onYouTubePlayerStateChange: PAUSED    (uID: ${e})`),i.players.isCurrent(e)?(i.playbackState.syncAll(e,i.playbackState.STATE.PAUSE),C.stop()):i.players.crossfade.stop()}function ua(e){P.log(`onYouTubePlayerStateChange: CUED      (uID: ${e})`)}function da(e){P.log(`onYouTubePlayerStateChange: ENDED     (uID: ${e})`),i.players.isCurrent(e)?(C.stop(),i.embeddedEvent(r.MEDIA_ENDED)):i.players.crossfade.stop()}function pa(e,t){P.log("onYouTubePlayerError: "+e.data);let a=i.players.playerFromUid(t);a.setPlayable(!1),Ee(a,e.target.getVideoUrl())}function ya(){P.log("initSoundCloudAPI()"),p(r.LOADING,ye())}function ga(e,t){P.log(`onSCPlayerEventReady(): ${t} => ${e.getUid()} => ${e.getArtist()} - ${e.getTitle()}`),Pt()}function Ea(e){P.log(`onSoundCloudPlayerEvent: PLAY   (uID: ${e.soundId})`),v.add(u.SOUNDCLOUD,d.STATE_PLAYING,e.soundId),i.players.crossfade.isFading()&&i.players.isCurrent(e.soundId)?v.scPlayDoubleTrigger(e.soundId,Ue.maxPlaybackStartDelay*1e3)&&i.playbackState.syncAll(e.soundId,i.playbackState.STATE.PLAY):(i.playbackState.syncAll(e.soundId,i.playbackState.STATE.PLAY),i.players.current.mute(l.playback.masterMute),i.players.current.setVolume(l.playback.masterVolume)),C.start()}function ka(e){P.log(`onSoundCloudPlayerEvent: PAUSE  (uID: ${e.soundId})`),v.add(u.SOUNDCLOUD,d.STATE_PAUSED,e.soundId),v.scAutoplayBlocked(e.soundId,3e3)?(C.stop(),i.embeddedEvent(r.AUTOPLAY_BLOCKED)):v.scWidgetPlayBlocked(e.soundId,3e4)?(C.stop(),i.embeddedEvent(r.PLAYBACK_BLOCKED,{currentTrack:i.players.trackFromUid(e.soundId),numTracks:i.players.getNumTracks()})):i.players.isCurrent(e.soundId)?i.players.current.getPosition(t=>{t>0&&(i.playbackState.syncAll(e.soundId,i.playbackState.STATE.PAUSE),C.stop())}):i.players.crossfade.stop()}function fa(e){P.log(`onSoundCloudPlayerEvent: FINISH (uID: ${e.soundId})`),i.players.isCurrent(e.soundId)?(C.stop(),i.embeddedEvent(r.MEDIA_ENDED)):i.players.crossfade.stop()}function Ta(){this.getCurrentSound(e=>{let t=i.players.playerFromUid(e.id);P.log(`onSoundCloudPlayerEvent: ERROR for track: ${i.players.trackFromUid(e.id)}. ${t.getArtist()} - ${t.getTitle()} - [${t.getUid()} / ${t.getIframeId()}]`),t.setPlayable(!1)})}var L=b("gallery-events"),ke={snackbarId:0,nowPlayingIcons:null},Re={nowPlayingIconsSelector:"h2.entry-title"};function St(){L.log("init()"),ke.nowPlayingIcons=document.querySelectorAll(Re.nowPlayingIconsSelector),g(r.MEDIA_PLAYING,ba),g(r.MEDIA_PAUSED,Pa),g(r.MEDIA_ENDED,Sa),g(r.MEDIA_CUE_NEXT,Aa),g(r.CONTINUE_AUTOPLAY,ha),g(r.RESUME_AUTOPLAY,Ca),g(r.AUTOPLAY_BLOCKED,La),g(r.PLAYBACK_BLOCKED,Ia),g(r.MEDIA_UNAVAILABLE,va)}function ba(e){if(L.log(e),ae(ke.snackbarId),e.data.numTracks>1){let t=document.querySelector(`#${e.data.trackId} ${Re.nowPlayingIconsSelector}`);At(t),V(t,"playing-paused","now-playing-icon"),l.gallery.animateNowPlayingIcon&&t.classList.add("playing-animate")}}function Pa(e){L.log(e),e.data.numTracks>1&&document.querySelector(`#${e.data.trackId} ${Re.nowPlayingIconsSelector}`).classList.add("playing-paused")}function Sa(e){L.log(e),e!==null&&e.data.numTracks>1&&At()}function Aa(e){L.log(e),e.data.scrollToMedia&&N(e.data.trackId)}function ha(e){L.log(e),w(A.nextPage,!0)}function Ca(e){let t=JSON.parse(sessionStorage.getItem(K.UF_AUTOPLAY));if(sessionStorage.removeItem(K.UF_AUTOPLAY),L.log(e),L.log(`RESUME_AUTOPLAY: ${t!==null?JSON.stringify(t):"NO"}`),t!==null){let a=document.getElementById(t.trackId)?.querySelector("iframe").id;e.callback.resumeAutoplay(t,a)}}function La(e){L.log(e),ke.snackbarId=m("Autoplay blocked, Play to continue",0,"play",()=>e.callback.togglePlayPause())}function Ia(e){L.log(e),m("Unable to play track, skipping to next",5,"Stop",()=>{},()=>Oe(e))}function va(e){L.log(e),Da(e.data.trackId)?m("YouTube Premium track, skipping",5,"help",()=>window.location.href="/channel/premium/",()=>Oe(e)):(m("Unable to play track, skipping to next",5,"Stop",()=>{},()=>Oe(e)),ee("EVENT_MEDIA_UNAVAILABLE",e.data))}function At(e){ke.nowPlayingIcons.forEach(t=>{t!==e&&t.classList.remove("now-playing-icon","playing-animate","playing-paused")})}function Oe(e){e.data.currentTrack<e.data.numTracks?e.callback.skipToTrack(e.data.currentTrack+1,!0):A.nextPage!==null&&w(A.nextPage,!0)}function Da(e){let t=document.getElementById(e);return t!==null?t.classList.contains("uf_channel-premium"):!1}var Ye=b("crossfade-controls"),fe={players:{}},h={},B={crossfadePresetSelector:".crossfade-preset-control",crossfadePresetData:"data-crossfade-preset",crossfadeToSelector:".crossfade-fadeto-control"};function Ct(e,t){Ye.log("init()"),fe.players=e,h.crossfadePreset=new Ce(B.crossfadePresetSelector),h.crossfadeTo=new Ce(B.crossfadeToSelector),h.crossfadePreset.length>1&&h.crossfadeTo.length>1&&(h.crossfadePreset.forEach(a=>Lt(a,l.gallery.trackCrossfadeDefPreset)),h.crossfadeTo.clickCallback=t),g(r.READY,Ua)}function Ua(){Ye.log("ready()"),h.crossfadePreset.length>1&&h.crossfadeTo.length>1&&(h.crossfadePreset.forEach(e=>{e.addEventListener("click",Oa),V(e,k.DISABLED.CLASS,k.ENABLED.CLASS)}),h.crossfadeTo.forEach(e=>e.addEventListener("click",Ra)),g(r.MEDIA_PLAYING,ht),g(r.MEDIA_PAUSED,ht))}function Lt(e,t){e.setAttribute(B.crossfadePresetData,t),e.textContent=`${t+1}`,e.title=`Preset: ${te.crossfade[t].name}`}function Oa(e){let t=parseInt(e.target.getAttribute(B.crossfadePresetData));Lt(e.target,t+1<te.crossfade.length?t+1:0)}function Ra(e){if(f()&&fe.players.crossfade.isFading()===!1){let t=e.target.closest("single-track");if(t!==null){let a=t.querySelector("iframe"),o=parseInt(t.querySelector(B.crossfadePresetSelector).getAttribute(B.crossfadePresetData));V(t.querySelector(`div${B.crossfadeToSelector}`),k.ENABLED.CLASS,k.DISABLED.CLASS),h.crossfadeTo.clickCallback(fe.players.uIdFromIframeId(a.id),te.crossfade[o])}}}function ht(){let e=f(),t=e?fe.players.getTrackData().currentTrack:-1;Ye.log(`updateCrossfadeToState() - playingState: ${e} - currentTrack: ${t}`),h.crossfadeTo.forEach((a,o)=>{t===o+1?V(a,e?k.ENABLED.CLASS:k.DISABLED.CLASS,e?k.DISABLED.CLASS:k.ENABLED.CLASS):V(a,e?k.DISABLED.CLASS:k.ENABLED.CLASS,e?k.ENABLED.CLASS:k.DISABLED.CLASS)})}var It=b("gallery-players"),vt=()=>{let e=null,t=null,a=[],o=new Map,c=0;return{indexMap:o,get crossfade(){return t},get current(){return a[c]},get next(){return a[c+1]},getPlayerIndex(){return c},setPlayerIndex(E){c=E},getNumTracks(){return a.length},getCurrentTrack(){return c+1},playerFromUid(E){return a[o.get(E)]},trackFromUid(E){return o.get(E)+1},isCurrent(E){return E===this.current.getUid()},init:y,add:j,uIdFromIframeId:U,stop:qt,mute:Ht,getTrackData:jt,prevTrack:Xt,nextTrack:Jt,jumpToTrack:zt};function y(E){It.log("init()"),e=E,t=gt(this),g(r.MEDIA_PLAYING,()=>t.start()),g(r.MEDIA_PAUSED,()=>t.stop())}function j(E){It.log(E),a.push(E),o.set(E.getUid(),a.length-1)}function U(E){return a.find(Ae=>Ae.iframeId===E).getUid()}function qt(){this.current.stop(),t.stop()}function Ht(){this.current.mute(l.playback.masterMute),t.mute(l.playback.masterMute)}function jt(){return{currentTrack:this.getCurrentTrack(),numTracks:this.getNumTracks(),artist:this.current.getArtist(),title:this.current.getTitle(),duration:this.current.getDuration(),thumbnail:{src:this.current.getThumbnailSrc(),class:this.current.getThumbnailClass()}}}function Xt(E){return c>0?(c--,e(E),!0):!1}function Jt(E){return c++,c<this.getNumTracks()?(e(E),!0):!1}function zt(E,Ae,Qt=!0){return E>0&&E<=this.getNumTracks()?(c=E-1,e(Ae,Qt),!0):!1}};var S=b("gallery-playback"),n={eventLog:null,players:{}},Dt={minCrossfadeToTime:5,maxBufferingDelay:3};function xa(){S.log("init()"),n.eventLog=v,St(),n.players=vt(),n.players.init(Ot),re(n.players,_a),Ct(n.players,Ba),C.init(n.players,Yt),bt(n.players,Mt,Fa)}function Te(){f()?(G(),n.players.current.pause()):(Je(),n.players.current.play(Ee))}function Nt(){S.log(`prevTrack() - prevTrack: ${n.players.getCurrentTrack()-1} - numTracks: ${n.players.getNumTracks()}`),n.players.getCurrentTrack()>0&&n.players.current.getPosition(e=>{e>5e3?(n.players.current.seekTo(0),O(0,0,n.players.current.getDuration())):(n.players.getCurrentTrack()>1&&n.players.stop(),n.players.prevTrack(f())&&X())})}function Me(e=!1){let t=n.players.getCurrentTrack()+1>n.players.getNumTracks();S.log(`nextTrack() - isMediaEnded: ${e} - isLastTrack: ${t} - autoplay: ${l.playback.autoplay}`),!wa(e,t)&&(t===!1?(n.players.stop(),e&&l.playback.autoplay===!1?G():n.players.nextTrack(f())&&Y()):e&&(G(),l.playback.autoplay?p(r.CONTINUE_AUTOPLAY):n.players.stop()))}function wa(e,t){if(e&&l.playback.autoplay){let a=se();if(S.log(`repeatPlayback(): ${S.getObjectKeyForValue(D,a)}`),a===D.ONE)return n.players.current.seekTo(0),n.players.current.play(),!0;if(t&&a===D.ALL)return n.players.stop(),n.players.setPlayerIndex(0),Ot(!0),!0}return!1}function _a(e){n.players.current.seekTo(e)}function Ut(){l.playback.masterMute=l.playback.masterMute!==!0,n.players.mute()}function Va(e,t=!0){S.log(`cueTrack(): ${e}`),n.players.setPlayerIndex(n.players.indexMap.get(e)),p(r.MEDIA_CUE_NEXT,{scrollToMedia:t,trackId:n.players.current.getTrackId()}),Y()}function Ot(e,t=!0){p(r.MEDIA_CUE_NEXT,{scrollToMedia:t,trackId:n.players.current.getTrackId()}),e&&n.players.current.play(Ee)}function Rt(e,t=!0){S.log(`skipToTrack(): ${e} - ${t}`),t===!0&&f()===!1&&(n.eventLog.clear(),n.eventLog.add(u.ULTRAFUNK,d.RESUME_AUTOPLAY,null),n.players.jumpToTrack(e,t)&&Y())}function $a(e,t=null){S.log(`resumeAutoplay(): ${e.autoplay}${t!==null?" - "+t:""}`),t!==null?e.autoplay?Rt(n.players.trackFromUid(t),!0):Va(t):e.autoplay&&(n.eventLog.add(u.ULTRAFUNK,d.RESUME_AUTOPLAY,null),Te())}function me(){return{isPlaying:f(),currentTrack:n.players.getCurrentTrack(),position:0,numTracks:n.players.getNumTracks(),trackId:n.players.current.getTrackId(),iframeId:n.players.current.getIframeId()}}function Ba(e,t){n.players.isCurrent(e)===!1&&n.players.current.getDuration()>0&&(S.log(`crossfadeToClick():
      fadeOut: ${n.players.current.getArtist()} - "${n.players.current.getTitle()}" (${n.players.current.getUid()})
      fadeIn.: ${n.players.playerFromUid(e).getArtist()} - "${n.players.playerFromUid(e).getTitle()}" (${e})`),l.playback.masterMute===!1&&l.playback.autoplay===!1&&n.players.current.getPosition(a=>{n.players.current.getDuration()-a/1e3>=Dt.minCrossfadeToTime+Dt.maxBufferingDelay&&Yt(ce.TRACK,t,e)}))}function Yt(e,t,a=null){n.eventLog.add(u.ULTRAFUNK,d.CROSSFADE_START,null);let o=n.players.crossfade.init(e,t,a);o!==null&&Mt.syncControls(o.fadeOutPlayer,o.fadeInPlayer)}function Fa(e,t=null){switch(S.log(`embeddedEventHandler() - event: ${S.getObjectKeyForValue(r,e)}`),t!==null&&S.log(t),e){case r.MEDIA_ENDED:p(r.MEDIA_ENDED,me()),Me(!0);break;case r.READY:oe(Nt,Te,Me,Ut),p(r.READY,t),p(r.RESUME_AUTOPLAY,null,{resumeAutoplay:$a});break;case r.AUTOPLAY_BLOCKED:p(r.AUTOPLAY_BLOCKED,null,{togglePlayPause:Te});break;case r.PLAYBACK_BLOCKED:case r.MEDIA_UNAVAILABLE:p(e,t,{skipToTrack:Rt});break}}var Mt=(()=>{let e={PLAY:1,PAUSE:2},t=function o(c,y){if(S.log(`playbackState.syncAll() - previousTrack: ${n.players.getPlayerIndex()+1} - nextTrack: ${n.players.indexMap.get(c)+1} - syncState: ${S.getObjectKeyForValue(e,y)}`),n.players.isCurrent(c))y===e.PLAY?p(r.MEDIA_PLAYING,me()):y===e.PAUSE&&p(r.MEDIA_PAUSED,me());else{let j=n.players.getPlayerIndex(),U=n.players.indexMap.get(c);n.players.stop(),n.players.setPlayerIndex(U),a(j,U),o(c,y)}};function a(o,c){c>o?Y():X()}return{STATE:e,syncAll:t,syncControls:a}})();var Be={};Ke(Be,{getStatus:()=>Xa,init:()=>Wa,nextTrack:()=>_t,prevTrack:()=>wt,toggleMute:()=>Ve,togglePlayPause:()=>$e});var we=class extends ${constructor(){super(),this.player=null}ready(t){super.init(),this.player=t,g(r.MEDIA_PLAYING,()=>super.start())}updateProxy(){f()&&this.update(this.player.embedded.getCurrentTime(),this.player.getDuration())}update(t,a){if(t!==void 0){let o=Math.round(t);O(t*1e3,o,a),o>0&&a>0&&super.updateTimeRemainingWarning(o,a)}}},_e=new we;var I=b("list-playback"),q=new W(10),s={player:null,autoplayData:null,playerReady:!1,firstStatePlaying:!0,currentTrackId:null,currentSnackbarId:0},Ga=`
  <p>The <b>List Player</b> only supports playing YouTube tracks, SoundCloud tracks will be automatically skipped over.</p>
  <p>SoundCloud tracks must be played using the <b>Gallery Player</b> or by clicking / tapping on the track <b>Artist + Title</b> text link in the <b>List Player</b>.</p>
  <p>To toggle between the <b>Gallery</b> and <b>List</b> players, please use the <b>Pref. Player: GALLERY / LIST</b> setting toggle button in the sites footer area.</p>`;function Wa(){I.log("init()"),Ze(F),qa()!==null?Ja():m("No playable YouTube tracks!",0,"help",()=>it("No playable tracks error",Ga))}function qa(){if(s.currentTrackId=M(),s.autoplayData=JSON.parse(sessionStorage.getItem(K.UF_AUTOPLAY)),sessionStorage.removeItem(K.UF_AUTOPLAY),s.currentTrackId!==null){if(s.autoplayData!==null&&s.autoplayData.trackId!==null){let e=s.autoplayData.trackId.match(ft);if(e!==null){let t=J(`[data-track-source-uid="${e[0]}"]`);t!==null&&(s.currentTrackId=t.id)}else if(s.autoplayData.trackId.match(/^track-(?!0)\d{1,9}$/i)!==null){let t=J(`[data-track-id="${s.autoplayData.trackId}"]`);t!==null?Le(t)===le.YOUTUBE?s.currentTrackId=t.id:m("Cannot play SoundCloud track",5,"help",()=>window.location.href="/help/#list-player"):m("Unable to cue track (not found)",5)}}ot(s.currentTrackId)}return I.log(`cueInitialTrack() - currentTrackId: ${s.currentTrackId} - autoplayData: ${s.autoplayData!==null?JSON.stringify(s.autoplayData):"N/A"}`),s.currentTrackId}function F(e,t=!0,a=!1){let o=Le(at(e));if(I.log(`setCurrentTrack() - nextTrackType: ${I.getObjectKeyForValue(le,o)} - nextTrackId: ${e} - playNextTrack: ${t} - isPointerClick: ${a}`),o===le.SOUNDCLOUD&&a){m("Cannot play SoundCloud track",5,"help",()=>window.location.href="/help/#list-player");return}e===s.currentTrackId?$e():(f()&&s.player.embedded.stopVideo(),s.currentTrackId=e,p(r.MEDIA_CUE_NEXT,{nextTrackId:e,isPointerClick:a}),xt(t))}function xt(e){let t=lt();e?(s.player.embedded.loadVideoById(t),x(k.PLAYING),ze()):(s.player.embedded.cueVideoById(t),x(k.PAUSED))}function $e(){s.currentTrackId===null?F(J("div.track-entry.current").id):f()?s.player.embedded.pauseVideo():s.player.play(be)}function Ve(e=!1){e===!1&&(l.playback.masterMute=l.playback.masterMute!==!0),l.playback.masterMute?s.player.embedded.mute():s.player.embedded.unMute()}function wt(){let e=rt(),t=s.player.embedded.getCurrentTime();e!==null&&t<=5?(F(e,f()),X()):t!==0&&(s.player.embedded.seekTo(0),O(0,0,s.player.getDuration()))}function _t(){let e=M();e!==null&&(F(e,f()),Y())}async function Vt(e=!1,t=!1){let a=t?D.OFF:se(),o=M();if(I.log(`advanceToNextTrack() autoplay: ${e} - isPlaybackError: ${t} - nextTrackId: ${o} - repeatMode: ${I.getObjectKeyForValue(D,a)}`),e&&a===D.ONE)s.player.embedded.seekTo(0),s.player.play(be);else if(e&&o===null&&a===D.ALL)F(M(null)),N(0);else if(o===null)if(l.list.showLoadMoreTracks){let c=await nt();e&&c&&F(M())}else w(A.nextPage,e);else e?F(o):x(k.PAUSED)}function Ha(){f()===!1&&s.autoplayData!==null&&(q.add(u.ULTRAFUNK,d.RESUME_AUTOPLAY,null),q.add(u.YOUTUBE,-1,M())),f()===!1&&Vt(!0,!0)}function ja(){s.currentTrackId=null,x(k.PAUSED)}function Xa(){let e=J("div.track-entry.current");if(e!==null){let t=tt("div.track-entry"),a=Array.prototype.indexOf.call(t,e);return{isPlaying:f(),currentTrack:a+1,position:Math.ceil(s.player.embedded.getCurrentTime()),numTracks:s.player.getNumTracks(),trackId:t[a].getAttribute("data-track-id"),iframeId:"youtube-player"}}return{isPlaying:!1,currentTrack:1,position:0,trackId:0}}function Ja(){I.log("initYouTubeAPI()"),window.onYouTubeIframeAPIReady=function(){I.log("onYouTubeIframeAPIReady()");let a=new YT.Player("youtube-player",{events:{onReady:za,onStateChange:Qa,onError:be}});s.player=new kt(a),re(s.player,o=>s.player.embedded.seekTo(o)),p(r.LOADING,{loadingPercent:33})};let e=document.createElement("script");e.id="youtube-iframe-api",e.src="https://www.youtube.com/iframe_api";let t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}function za(){I.log("onYouTubePlayerReady()"),s.autoplayData?.autoplay===!0&&q.add(u.ULTRAFUNK,d.RESUME_AUTOPLAY,null),oe(wt,$e,_t,Ve),p(r.LOADING,{loadingPercent:66}),_e.ready(s.player),et(s.player),Ve(!0),p(r.READY,{resetProgressBar:!1}),xt(s.autoplayData?.autoplay===!0)}function Qa(e){switch(I.log(`onYouTubePlayerStateChange(): ${e.data} - trackId: ${s.currentTrackId}`),q.add(u.YOUTUBE,e.data,s.currentTrackId),e.data!==YT.PlayerState.PLAYING&&G(),e.data){case YT.PlayerState.UNSTARTED:Za();break;case YT.PlayerState.CUED:s.player.setPlayerState(e.data);break;case YT.PlayerState.BUFFERING:p(r.MEDIA_LOADING);break;case YT.PlayerState.PLAYING:er(e),p(r.MEDIA_PLAYING);break;case YT.PlayerState.PAUSED:x(k.PAUSED);break;case YT.PlayerState.ENDED:_e.stop(),p(r.MEDIA_ENDED),Vt(l.playback.autoplay);break}}function Za(){q.ytAutoplayBlocked(s.currentTrackId,3e3)&&(x(k.PAUSED),s.currentSnackbarId=m("Autoplay blocked, Play to continue",0,"play",()=>s.player.play(be))),s.playerReady===!1&&(s.playerReady=!0,p(r.LOADING,{loadingPercent:0}))}function er(e){ae(s.currentSnackbarId),s.player.setDuration(Math.round(e.target.getDuration())),s.firstStatePlaying&&(s.firstStatePlaying=!1,s.autoplayData=null,setTimeout(()=>{l.playback.autoplay&&f()&&Math.round(window.pageYOffset)<=1&&mt(Tt.SITE_MAX_WIDTH_MOBILE)&&N(0)},6e3))}function be(e){I.log(`onYouTubePlayerError(): ${e.data} - trackId: ${s.currentTrackId}`),st("Error!"),q.add(u.YOUTUBE,d.PLAYER_ERROR,s.currentTrackId),m("Unable to play track, skipping to next",5,"Stop",ja,Ha),ee("EVENT_MEDIA_UNAVAILABLE",{mediaUrl:s.player.embedded.getVideoUrl(),mediaTitle:`${s.player.getArtist()} - ${s.player.getTitle()}`})}var Se=b("screen-wakelock"),Pe={wakeLock:null};function $t(){l.mobile.keepScreenOn&&document.addEventListener("click",Bt)}function Bt(){Se.log("enableScreenWakeLock()"),document.removeEventListener("click",Bt),ar(),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&l.mobile.keepScreenOn&&tr()})}function tr(){Ft()&&Pe.wakeLock===null&&Kt()}function Ft(){return"wakeLock"in navigator&&"request"in navigator.wakeLock}async function ar(){Ft()?document.visibilityState==="visible"&&await Kt()!==!0&&(Se.log("enableWakeLock(): Screen Wake Lock request failed"),m("Keep Screen On failed",5,"Disable",()=>l.mobile.keepScreenOn=!1)):(Se.log("enableWakeLock(): Screen Wake Lock is not supported"),m("Keep Screen On is not supported",5,"Disable",()=>l.mobile.keepScreenOn=!1))}async function Kt(){try{return Pe.wakeLock=await navigator.wakeLock.request("screen"),Pe.wakeLock.addEventListener("release",()=>{Pe.wakeLock=null}),!0}catch(e){Se.error(`requestWakeLock(): ${e.name} - ${e.message}`)}return!1}var z=b("playback-interaction"),Gt=new de(10),T={player:null,isPlaybackReady:!1},rr={doubleClickDelay:500};document.addEventListener("DOMContentLoaded",()=>{z.log("DOMContentLoaded"),Ge(),ct()?T.player=xe:ut()&&(T.player=Be),T.player!==null&&or(),He(T.player?.getStatus)});function or(){z.log("initShared()"),Xe(),nr(),T.player.init(),Z.init(),Fe.init(),sr(),$t()}function nr(){g(r.READY,cr),g(r.MEDIA_CUE_NEXT,Wt),g(r.MEDIA_ENDED,Wt),g(r.MEDIA_TIME_REMAINING,ur)}function sr(){_(".playback-shuffle-control span","click",pt),ve("span.navbar-arrow-back","click",H,A.prevPage),ve("span.navbar-arrow-fwd","click",H,A.nextPage),_("nav.track-navigation .nav-previous a","click",H,A.prevPage),_("nav.track-navigation .nav-next a","click",H,A.nextPage),document.addEventListener("keydown",lr),document.addEventListener("keydown",ir),window.addEventListener("blur",dr)}function lr(e){if(T.isPlaybackReady&&Fe.allow()&&e.repeat===!1&&e.ctrlKey===!1&&e.altKey===!1){switch(e.code){case"Backquote":e.preventDefault(),N(T.player.getStatus().trackId);break}switch(e.key){case" ":e.preventDefault(),T.player.togglePlayPause();break;case"Home":case"End":case"PageUp":case"PageDown":yt(e);break;case"ArrowLeft":e.preventDefault(),e.shiftKey===!0?H(null,A.prevPage):T.player.prevTrack();break;case"ArrowRight":e.preventDefault(),e.shiftKey===!0?H(null,A.nextPage):T.player.nextTrack();break;case"A":he.toggle();break;case"f":case"F":e.preventDefault(),Z.toggle(document.getElementById(T.player.getStatus().iframeId));break;case"m":case"M":e.preventDefault(),T.player.toggleMute(),m(l.playback.masterMute?"Volume is muted (<b>m</b> to unmute)":"Volume is unmuted (<b>m</b> to mute)",3);break;case"p":case"P":We.toggle();break;case"r":case"R":m(`${Qe().title} (<b>r</b> to change)`,3);break;case"x":case"X":qe.toggle();break}}}function ir(e){if(T.isPlaybackReady&&Fe.allow())switch(e.key){case"MediaPlayPause":je===!1&&(z.log("documentEventMediaKeyDown(): MediaPlayPause"),e.preventDefault(),T.player.togglePlayPause());break;case"MediaTrackPrevious":z.log("documentEventMediaKeyDown(): MediaTrackPrevious"),e.preventDefault(),T.player.prevTrack();break;case"MediaTrackNext":z.log("documentEventMediaKeyDown(): MediaTrackNext"),e.preventDefault(),T.player.nextTrack();break}}function cr(){_(".playback-details-control","click",pr),_(".playback-thumbnail-control","click",yr),_(".playback-timer-control","click",gr),T.isPlaybackReady=!0}function Wt(){l.playback.autoExitFullscreen&&Z.exit()}function ur(e){l.playback.autoExitFsOnWarning&&e.data.timeRemainingSeconds<=l.playback.timeRemainingSeconds&&Z.exit()}function dr(){ie()||setTimeout(()=>{document.activeElement instanceof HTMLIFrameElement&&setTimeout(()=>{document.activeElement.blur(),document.activeElement instanceof HTMLIFrameElement&&document.activeElement.blur()},250)},0)}function pr(){N(T.player.getStatus().trackId),ie()&&l.list.showUpNextModal?Q("showUpNextModalHint","<b>Tip:</b> Click or tap Artist &amp; Title to show Up Next queue"):Q("showTrackDetailsHint","<b>Tip:</b> Click or tap Artist &amp; Title to show current track")}function yr(){dt()?(Gt.add(u.MOUSE,d.MOUSE_CLICK,null),Q("showGalleryTrackThumbnailHint","<b>Tip:</b> Double click or tap Track Thumbnail for full screen"),Gt.doubleClicked(u.MOUSE,d.MOUSE_CLICK,rr.doubleClickDelay)&&Z.enter(document.getElementById(T.player.getStatus().iframeId))):ie()&&(N(0),Q("showListTrackThumbnailHint","<b>Tip:</b> Click or tap Track Thumbnail to show player"))}function gr(){he.toggle(),Q("showTrackTimerHint","<b>Tip:</b> Click or tap Track Timer to toggle Autoplay On / Off")}function Q(e,t,a=0){l.tips[e]&&(m(t,a),l.tips[e]=!1)}function H(e,t){e?.preventDefault(),w(t,T.player.getStatus().isPlaying)}var Z=(()=>{let e=new Event("fullscreenElement"),t=null;return{init:a,enter:c,exit:y,toggle:j};function a(){document.addEventListener("fullscreenchange",o),document.addEventListener("webkitfullscreenchange",o)}function o(){t=document.fullscreenElement!==null?document.fullscreenElement.id:null,e.fullscreenTarget=t,document.dispatchEvent(e)}function c(U){U.requestFullscreen()}function y(){t!==null&&(document.exitFullscreen(),t=null)}function j(U){t===null?c(U):y()}})(),Fe=(()=>{let e=!1;return{allow(){return e},init:t};function t(){e=l.playback.keyboardShortcuts,document.addEventListener("allowKeyboardShortcuts",()=>{l.playback.keyboardShortcuts&&(e=!0)}),document.addEventListener("denyKeyboardShortcuts",()=>{l.playback.keyboardShortcuts&&(e=!1)})}})();
//# sourceMappingURL=interaction.js.map
