var DragDropTouch;(function(a){'use strict';var b=function(){function a(){this._dropEffect="move",this._effectAllowed="all",this._data={}}return Object.defineProperty(a.prototype,"dropEffect",{get:function(){return this._dropEffect},set:function(a){this._dropEffect=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"effectAllowed",{get:function(){return this._effectAllowed},set:function(a){this._effectAllowed=a},enumerable:!0,configurable:!0}),a}();a.DataTransfer=b;var c=function(){function a(){if(this._lastClick=0,a._instance)throw"DragDropTouch instance already created.";var b=!1;if(document.addEventListener("test",function(){},{get passive(){return b=!0,!0}}),navigator.maxTouchPoints){var c=document,d=this._touchstart.bind(this),e=this._touchmove.bind(this),f=this._touchend.bind(this),g=!!b&&{passive:!1,capture:!1};c.addEventListener("touchstart",d,g),c.addEventListener("touchmove",e,g),c.addEventListener("touchend",f),c.addEventListener("touchcancel",f)}}return a.getInstance=function(){return a._instance},a.prototype._touchstart=function(b){var c=this;if(this._shouldHandle(b)){if(Date.now()-this._lastClick<a._DBLCLICK&&this._dispatchEvent(b,"dblclick",b.target))return b.preventDefault(),void this._reset();this._reset();var d=this._closestDraggable(b.target);!d||this._dispatchEvent(b,"mousemove",b.target)||this._dispatchEvent(b,"mousedown",b.target)||(this._dragSource=d,this._ptDown=this._getPoint(b),this._lastTouch=b,this._dragElementXPos=d.getBoundingClientRect().x,b.preventDefault(),setTimeout(function(){c._dragSource==d&&null==c._img&&c._dispatchEvent(b,"contextmenu",d)&&c._reset()},a._CTXMENU),a._ISPRESSHOLDMODE&&(this._pressHoldInterval=setTimeout(function(){c._isDragEnabled=!0,c._touchmove(b)},a._PRESSHOLDAWAIT)))}},a.prototype._touchmove=function(a){if(this._shouldCancelPressHoldMove(a))return void this._reset();if(this._shouldHandleMove(a)||this._shouldHandlePressHoldMove(a)){var b=this._getTarget(a);if(this._dispatchEvent(a,"mousemove",b))return this._lastTouch=a,void a.preventDefault();this._dragSource&&!this._img&&this._shouldStartDragging(a)&&(this._dispatchEvent(a,"dragstart",this._dragSource),this._createImage(a),this._dispatchEvent(a,"dragenter",b)),this._img&&(this._lastTouch=a,a.preventDefault(),this._dispatchEvent(a,"drag",this._dragSource),b!=this._lastTarget&&(this._dispatchEvent(this._lastTouch,"dragleave",this._lastTarget),this._dispatchEvent(a,"dragenter",b),this._lastTarget=b),this._moveImage(a),this._isDropZone=this._dispatchEvent(a,"dragover",b))}},a.prototype._touchend=function(a){if(this._shouldHandle(a)){if(this._dispatchEvent(this._lastTouch,"mouseup",a.target))return void a.preventDefault();this._img||(this._dragSource=null,this._dispatchEvent(this._lastTouch,"click",a.target),this._lastClick=Date.now()),this._destroyImage(),this._dragSource&&(0>a.type.indexOf("cancel")&&this._isDropZone&&this._dispatchEvent(this._lastTouch,"drop",this._lastTarget),this._dispatchEvent(this._lastTouch,"dragend",this._dragSource),this._reset())}},a.prototype._shouldHandle=function(a){return a&&!a.defaultPrevented&&a.touches&&2>a.touches.length},a.prototype._shouldHandleMove=function(b){return!a._ISPRESSHOLDMODE&&this._shouldHandle(b)},a.prototype._shouldHandlePressHoldMove=function(b){return a._ISPRESSHOLDMODE&&this._isDragEnabled&&b&&b.touches&&b.touches.length},a.prototype._shouldCancelPressHoldMove=function(b){return a._ISPRESSHOLDMODE&&!this._isDragEnabled&&this._getDelta(b)>a._PRESSHOLDMARGIN},a.prototype._shouldStartDragging=function(b){var c=this._getDelta(b);return c>a._THRESHOLD||a._ISPRESSHOLDMODE&&c>=a._PRESSHOLDTHRESHOLD},a.prototype._reset=function(){this._destroyImage(),this._dragSource=null,this._lastTouch=null,this._lastTarget=null,this._ptDown=null,this._isDragEnabled=!1,this._isDropZone=!1,this._dataTransfer=new b,clearInterval(this._pressHoldInterval)},a.prototype._getPoint=function(a,b){return a&&a.touches&&(a=a.touches[0]),{x:b?a.pageX:a.clientX,y:b?a.pageY:a.clientY}},a.prototype._getDelta=function(b){if(a._ISPRESSHOLDMODE&&!this._ptDown)return 0;var c=this._getPoint(b);return Math.abs(c.x-this._ptDown.x)+Math.abs(c.y-this._ptDown.y)},a.prototype._getTarget=function(a){for(var b=this._getPoint(a),c=document.elementFromPoint(b.x,b.y);c&&"none"==getComputedStyle(c).pointerEvents;)c=c.parentElement;return c},a.prototype._createImage=function(b){this._img&&this._destroyImage();var c=this._imgCustom||this._dragSource;if(this._img=c.cloneNode(!0),this._copyStyle(c,this._img),this._img.style.top=this._img.style.left="-9999px",!this._imgCustom){var d=c.getBoundingClientRect(),e=this._getPoint(b);this._imgOffset={x:e.x-d.left,y:e.y-d.top},this._img.style.opacity=a._OPACITY.toString()}this._moveImage(b),document.body.appendChild(this._img)},a.prototype._destroyImage=function(){this._img&&this._img.parentElement&&this._img.parentElement.removeChild(this._img),this._img=null,this._imgCustom=null},a.prototype._moveImage=function(a){var b=this;requestAnimationFrame(function(){if(b._img){var c=b._getPoint(a,!0),d=b._img.style;d.position="absolute",d.pointerEvents="none",d.zIndex="999999",d.left=b._dragElementXPos+"px",d.top=Math.round(c.y-b._imgOffset.y)+"px"}})},a.prototype._copyProps=function(a,b,c){for(var d,e=0;e<c.length;e++)d=c[e],a[d]=b[d]},a.prototype._copyStyle=function(b,c){if(a._rmvAtts.forEach(function(a){c.removeAttribute(a)}),b instanceof HTMLCanvasElement){var d=b,e=c;e.width=d.width,e.height=d.height,e.getContext("2d").drawImage(d,0,0)}for(var f,g=getComputedStyle(b),h=0;h<g.length;h++)f=g[h],0>f.indexOf("transition")&&(c.style[f]=g[f]);c.style.pointerEvents="none";for(var h=0;h<b.children.length;h++)this._copyStyle(b.children[h],c.children[h])},a.prototype._dispatchEvent=function(b,c,d){if(b&&d){var e=document.createEvent("Event"),f=b.touches?b.touches[0]:b;return e.initEvent(c,!0,!0),e.button=0,e.which=e.buttons=1,this._copyProps(e,b,a._kbdProps),this._copyProps(e,f,a._ptProps),e.dataTransfer=this._dataTransfer,d.dispatchEvent(e),e.defaultPrevented}return!1},a.prototype._closestDraggable=function(a){for(;a;a=a.parentElement)if(a.hasAttribute("draggable")&&a.draggable)return a;return null},a}();c._instance=new c,c._THRESHOLD=5,c._OPACITY=.5,c._DBLCLICK=500,c._CTXMENU=900,c._ISPRESSHOLDMODE=!1,c._PRESSHOLDAWAIT=400,c._PRESSHOLDMARGIN=25,c._PRESSHOLDTHRESHOLD=0,c._rmvAtts=["id","class","style","draggable"],c._kbdProps=["altKey","ctrlKey","metaKey","shiftKey"],c._ptProps=["pageX","pageY","clientX","clientY","screenX","screenY","offsetX","offsetY"],a.DragDropTouch=c})(DragDropTouch||(DragDropTouch={}));